# Schemat Bazy Danych - System Intencji V2

Skopiuj poniższy kod SQL i wykonaj go w konsoli SQL Supabase, aby utworzyć wymagane tabele.

```sql
-- 1. Tabela rozmów
CREATE TABLE IF NOT EXISTS conversations (
    id TEXT PRIMARY KEY, -- sessionId (np. 'session-12345')
    user_id UUID, -- Opcjonalne powiązanie z users
    status VARCHAR(50) DEFAULT 'active', -- active, completed, dropped, error
    metadata JSONB DEFAULT '{}'::jsonb,
    summary TEXT,
    started_at TIMESTAMPTZ DEFAULT NOW(),
    ended_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX IF NOT EXISTS idx_conversations_started_at ON conversations(started_at DESC);

-- 2. Tabela zdarzeń
CREATE TABLE IF NOT EXISTS conversation_events (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    conversation_id TEXT REFERENCES conversations(id) ON DELETE CASCADE,
    step_order INT DEFAULT 0,
    event_type VARCHAR(100) NOT NULL, -- voice_start, intent_detected, action_executed, reply, error
    payload JSONB DEFAULT '{}'::jsonb,
    confidence FLOAT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX IF NOT EXISTS idx_events_conversation_id ON conversation_events(conversation_id);
```
