
> freeflow-backend@1.4.2 test:brain:e2e
> vitest run api/brain/tests/brainRouter.e2e.test.js --reporter=default


[7m[1m[36m RUN [39m[22m[27m [36mv1.6.1[39m [90mC:/Freeflow (Cursor vers. GITHUB)/freeflow-backend[39m

[90mstdout[2m | api\server-vercel.js:39:9[22m[39m
ðŸš€ Booting FreeFlow Serverless...

[90mstdout[2m | api\server-vercel.js:40:9[22m[39m
ðŸ§  ENV OK

[90mstdout[2m | api\server-vercel.js:41:9[22m[39m
ðŸ”‘ SUPABASE_URL: âœ…

[90mstdout[2m | api\server-vercel.js:42:9[22m[39m
ðŸ”‘ OPENAI_API_KEY: âœ…

[90mstdout[2m | Server.<anonymous> (C:\Freeflow (Cursor vers. GITHUB)\freeflow-backend\api\server-vercel.js:530:13)[22m[39m
ðŸ§  FreeFlow Brain running locally on http://localhost:3000

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mA. Intent find_nearby (Znajdowanie restauracji)[2m > [22m[2mpowinien znaleÅºÄ‡ restauracje w Piekarach ÅšlÄ…skich[22m[39m
âœ… Supabase client initialized (singleton mode)

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mA. Intent find_nearby (Znajdowanie restauracji)[2m > [22m[2mpowinien znaleÅºÄ‡ restauracje w Piekarach ÅšlÄ…skich[22m[39m
[brainRouter] ðŸš€ Handler called
[Supabase] Creating client with URL: https://ezemaacyyvbpjlagchds.supabase.co

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mA. Intent find_nearby (Znajdowanie restauracji)[2m > [22m[2mpowinien znaleÅºÄ‡ restauracje w Piekarach ÅšlÄ…skich[22m[39m
ðŸ§  [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  text: [32m'ZnajdÅº restauracjÄ™ w Piekarach ÅšlÄ…skich'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043893663'[39m,
    text: [32m'ZnajdÅº restauracjÄ™ w Piekarach ÅšlÄ…skich'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m39[39m
}
ðŸ§  [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  session: {
    expectedContext: [32m'neutral'[39m,
    lastIntent: [1mnull[22m,
    lastRestaurant: [1mnull[22m,
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: []
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'neutral'[39m,
  hasLastRestaurant: [33mfalse[39m,
  lastRestaurantName: [90mundefined[39m,
  hasLastLocation: [33mfalse[39m,
  lastLocation: [90mundefined[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [1mnull[22m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m
  ]
}
ðŸ§­ GeoContext Layer activated for: "Piekary ÅšlÄ…skie"

POST /api/brain 200 5715 - 1082.142 ms
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mA. Intent find_nearby (Znajdowanie restauracji)[2m > [22m[2mpowinien znaleÅºÄ‡ restauracje w Piekarach ÅšlÄ…skich[22m[39m
ðŸ—ºï¸ Found 9 restaurants in "Piekary ÅšlÄ…skie"
ðŸ’¾ Cache SAVED for location: "Piekary ÅšlÄ…skie"
ðŸš€ GeoContext: Direct request detected -> Skipping confirmation

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mA. Intent find_nearby (Znajdowanie restauracji)[2m > [22m[2mpowinien obsÅ‚uÅ¼yÄ‡ zapytanie "PokaÅ¼ restauracje w Piekarach ÅšlÄ…skich"[22m[39m
[brainRouter] ðŸš€ Handler called

POST /api/brain 200 5715 - 244.213 ms
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mA. Intent find_nearby (Znajdowanie restauracji)[2m > [22m[2mpowinien obsÅ‚uÅ¼yÄ‡ zapytanie "PokaÅ¼ restauracje w Piekarach ÅšlÄ…skich"[22m[39m
ðŸ§  [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  text: [32m'PokaÅ¼ restauracje w Piekarach ÅšlÄ…skich'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043893663'[39m,
    text: [32m'PokaÅ¼ restauracje w Piekarach ÅšlÄ…skich'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m38[39m
}
ðŸ§  [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  session: {
    expectedContext: [32m'select_restaurant'[39m,
    lastIntent: [32m'find_nearby'[39m,
    lastRestaurant: [1mnull[22m,
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary Å›lÄ…skie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ÅšlÄ…skie'[39m,
    lastUpdated: [33m1766043894771[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ]
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'select_restaurant'[39m,
  hasLastRestaurant: [33mfalse[39m,
  lastRestaurantName: [90mundefined[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ÅšlÄ…skie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'find_nearby'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m
  ]
}
ðŸ§­ GeoContext Layer activated for: "Piekary ÅšlÄ…skie"
ðŸ’¾ Cache HIT for location: "Piekary ÅšlÄ…skie" (age: 0s)
ðŸš€ GeoContext: Direct request detected -> Skipping confirmation

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Restauracja Stara Kamienica[22m[39m
[brainRouter] ðŸš€ Handler called

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Restauracja Stara Kamienica[22m[39m
ðŸ§  [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  text: [32m'PokaÅ¼ menu Restauracja Stara Kamienica'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043893663'[39m,
    text: [32m'PokaÅ¼ menu Restauracja Stara Kamienica'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m38[39m
}
ðŸ§  [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  session: {
    expectedContext: [32m'select_restaurant'[39m,
    lastIntent: [32m'find_nearby'[39m,
    lastRestaurant: [1mnull[22m,
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary Å›lÄ…skie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ÅšlÄ…skie'[39m,
    lastUpdated: [33m1766043895033[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ]
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'select_restaurant'[39m,
  hasLastRestaurant: [33mfalse[39m,
  lastRestaurantName: [90mundefined[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ÅšlÄ…skie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'find_nearby'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m
  ]
}
[brainRouter] ðŸ§  Calling detectIntent with: {
  text: [32m'PokaÅ¼ menu Restauracja Stara Kamienica'[39m,
  sessionId: [32m'e2e_piekary_1766043893663'[39m
}
[brainRouter] ðŸ§  Current session: {
  expectedContext: [32m'select_restaurant'[39m,
  lastIntent: [32m'find_nearby'[39m,
  lastRestaurant: [1mnull[22m,
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary Å›lÄ…skie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043894604[39m }
  },
  last_location: [32m'Piekary ÅšlÄ…skie'[39m,
  lastUpdated: [33m1766043895033[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'MiÄ™dzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'AmerykaÅ„ska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. KsiÄ™dza Piotra Skargi 3'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'DwÃ³r Hubertus'[39m,
      address: [32m'ul. InwalidÃ³w Wojennych 72'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'ÅšlÄ…ska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. StanisÅ‚awa Maczka 22'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ]
}
ðŸ”¬ Starting Smart Intent Layer...
[intent-router] ðŸš€ detectIntent called with: {
  text: [32m'PokaÅ¼ menu Restauracja Stara Kamienica'[39m,
  sessionId: [90mundefined[39m
}
[intent-router] ðŸ” Starting early dish detection for text: PokaÅ¼ menu Restauracja Stara Kamienica
[intent-router] ðŸ” Normalized text: pokaÅ¼ menu restauracja stara kamienica
[intent-router] ðŸ” Session restaurant: NONE
[intent-router] ðŸ” Restaurant indicators in text: true
[intent-router] ðŸ” Searching for restaurant in text (reason: no session restaurant)

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Restauracja Stara Kamienica[22m[39m
[intent-router] ðŸ” Checking 9 restaurants for fuzzy match
[intent-router] ðŸª Restaurant detected in text (exact): Restauracja Stara Kamienica
[loadMenuCatalog] ðŸ” Session: {
  lastRestaurant: {
    id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
    name: [32m'Restauracja Stara Kamienica'[39m
  }
}
[loadMenuCatalog] ðŸ” lastRestaurant: {
  id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
  name: [32m'Restauracja Stara Kamienica'[39m
}
[loadMenuCatalog] ðŸ” lastId: 1fc1e782-bac6-47b2-978a-f6f2b38000cd
[loadMenuCatalog] âœ… Loading menu for restaurant: 1fc1e782-bac6-47b2-978a-f6f2b38000cd (Restauracja Stara Kamienica)

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Restauracja Stara Kamienica[22m[39m
[loadMenuCatalog] âœ… Loaded 25 menu items from 1 restaurants
[loadMenuCatalog] âœ… Sample items: Zupa dnia, RosÃ³Å‚ z makaronem, Tradycyjny schabowy
[intent-router] Catalog loaded: 25 items
[intent-router] ðŸ” Calling parseOrderItems...
[intent-router] ðŸ” Catalog items: Zupa dnia, RosÃ³Å‚ z makaronem, Tradycyjny schabowy, Schab po beskidzku, NaleÅ›nik z kurczakiem i warzywami, NaleÅ›nik ze szpinakiem i serem feta, Lody z gorÄ…cymi malinami i bitÄ… Å›mietanÄ…, Fondant czekoladowy z lodami i bitÄ… Å›mietanÄ…, Coca-Cola, Fanta, Sprite, Cappy (200 ml), Woda mineralna (330 ml), Filet z kurczaka tradycyjny (panierowany), Filet z kurczaka po hawajsku, Grillowany filet z kurczaka, Kroket (z kapustÄ… i grzybami/bÄ…dÅº z miÄ™sem) 1 szt., Placki ziemniaczane 4 szt., Kluski Å›lÄ…skie 7 szt., Rolada woÅ‚owa (na zamÃ³wienie), PieczeÅ„ wieprzowa, WÄ…trÃ³bka drobiowa, Gulasz wieprzowy po wÄ™giersku, Pierogi (ruskie lub z miÄ™sem) 6 szt., Jajecznica z 2 szt. jaj, Placki po wÄ™giersku z gulaszem wieprzowym, NaleÅ›nik z dÅ¼emem truskawkowym lub wiÅ›niowym, NaleÅ›nik z nutellÄ…, bananami, bitÄ… Å›mietanÄ…
[parseOrderItems] ðŸ“Š Summary:
  - requestedNames: []
  - availableNames: []
  - unavailableNames: []
  - matched.length: 0
  - clarifications.length: 0
[intent-router] âœ… Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "pokaÅ¼ menu restauracja stara kamienica"
  ],
  "needsClarification": true,
  "unknownItems": [
    {
      "name": "pokaÅ¼ menu restauracja stara kamienica",
      "reason": "no_alias_match"
    }
  ]
}
[intent-router] ðŸ” parsed.any = false
[intent-router] ðŸ” parsed.groups.length = 0
âš ï¸ Unavailable items detected: pokaÅ¼ menu restauracja stara kamienica in tym menu
ðŸ” Checking if text contains restaurant name (using cached list): "pokaÅ¼ menu restauracja stara kamienica"
âœ… Text contains restaurant name: Restauracja Stara Kamienica â€” skipping clarify_order
[intent-router] âŒ No dishes matched in catalog (parsed.any = false)
[intent-router] âŒ Continuing to KROK 4 (targetRestaurant check)...

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Restauracja Stara Kamienica[22m[39m
[intent-router] ðŸ” KROK 4: Checking targetRestaurant: {
  id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
  name: [32m'Restauracja Stara Kamienica'[39m
}
[intent-router] ðŸª KROK 4: Restaurant found in early detection: Restauracja Stara Kamienica, checking keywords...
[intent-router] ðŸ” KROK 4: Lower text: "pokaz menu restauracja stara kamienica"
[intent-router] ðŸ” KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'pokaÅ¼ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta daÅ„'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ðŸ” KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] âš ï¸ KROK 4: Menu keyword found, returning menu_request
[intent-router] âš ï¸ KROK 4: This may override create_order from KROK 2!
ðŸ” Debug session updated: {
  intent: [32m'menu_request'[39m,
  restaurant: [32m'Restauracja Stara Kamienica'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}
âœ… SmartIntent Resolved: menu_request (0.00) via classic
ðŸ§  [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'menu_request'[39m,
  ruleConfidence: [33m0[39m,
  llmIntent: [1mnull[22m,
  llmConfidence: [33m0[39m,
  finalIntent: [32m'menu_request'[39m,
  finalConfidence: [33m0[39m,
  source: [32m'classic'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Restauracja Stara Kamienica'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
ðŸ§  [DEBUG] Calling boostIntent with: {
  text: [32m'PokaÅ¼ menu Restauracja Stara Kamienica'[39m,
  hybridIntent: [32m'menu_request'[39m,
  confidence: [33m0[39m,
  session: {
    expectedContext: [32m'select_restaurant'[39m,
    lastRestaurant: [90mundefined[39m,
    lastIntent: [32m'find_nearby'[39m
  }
}
ðŸ§  [DEBUG] boostIntent result: {
  originalIntent: [32m'menu_request'[39m,
  boostedIntent: [32m'menu_request'[39m,
  isContextLocked: [33mfalse[39m
}
ðŸ“‹ Parsed: { dish: [1mnull[22m, restaurant: [32m'Stara Kamienica'[39m }
ðŸ§  menu_request intent detected

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Restauracja Stara Kamienica[22m[39m
âœ… Matched restaurant: "Stara Kamienica" â†’ Restauracja Stara Kamienica
âœ… Restaurant set: Restauracja Stara Kamienica

POST /api/brain 200 13765 - 1206.541 ms
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Restauracja Stara Kamienica[22m[39m
âœ… Menu loaded: 25 items (showing 6) from Restauracja Stara Kamienica
âš ï¸ Skipping LLM reply generation (test mode or no key), using replyCore
âœ… Final response: intent=menu_request, confidence=0.9, fallback=false
ðŸ“¦ Final Response Preparation: MenuItems count = 6

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
[brainRouter] ðŸš€ Handler called

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
ðŸ§  [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  text: [32m'Jakie jest menu w Klaps Burgers?'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043893663'[39m,
    text: [32m'Jakie jest menu w Klaps Burgers?'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m32[39m
}
ðŸ§  [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastIntent: [32m'menu_request'[39m,
    lastRestaurant: {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary Å›lÄ…skie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ÅšlÄ…skie'[39m,
    lastUpdated: [33m1766043895967[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ]
  },
  hasExpectedContext: [33mfalse[39m,
  expectedContextValue: [1mnull[22m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Restauracja Stara Kamienica'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ÅšlÄ…skie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'menu_request'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m
  ]
}
ðŸ§­ GeoContext Layer activated for: "Klaps Burgers"

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
âš™ï¸ GeoContext: brak wynikÃ³w w "Klaps Burgers"
âš™ï¸ GeoContext: brak wynikÃ³w w "Klaps Burgers" â€” kontynuuj normalny flow

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
[brainRouter] ðŸ§  Calling detectIntent with: {
  text: [32m'Jakie jest menu w Klaps Burgers?'[39m,
  sessionId: [32m'e2e_piekary_1766043893663'[39m
}
[brainRouter] ðŸ§  Current session: {
  expectedContext: [1mnull[22m,
  lastIntent: [32m'menu_request'[39m,
  lastRestaurant: {
    id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
    name: [32m'Restauracja Stara Kamienica'[39m,
    address: [32m'ul. Bytomska 61'[39m,
    city: [32m'Piekary ÅšlÄ…skie'[39m,
    lat: [33m50.3856[39m,
    lng: [33m18.94886[39m
  },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary Å›lÄ…skie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043894604[39m }
  },
  last_location: [32m'Piekary ÅšlÄ…skie'[39m,
  lastUpdated: [33m1766043895967[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'MiÄ™dzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'AmerykaÅ„ska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. KsiÄ™dza Piotra Skargi 3'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'DwÃ³r Hubertus'[39m,
      address: [32m'ul. InwalidÃ³w Wojennych 72'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'ÅšlÄ…ska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. StanisÅ‚awa Maczka 22'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'8ed5ff4a-8f10-4b0b-bc6c-b6c801254f23'[39m,
      restaurant_id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Filet z kurczaka po hawajsku'[39m,
      description: [32m'Filet, ananas, ser, sos, ziemniaki, surÃ³wka'[39m,
      category: [32m'Danie gÅ‚Ã³wne'[39m,
      base_type: [32m'kurczak'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m19[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-26T15:49:25.550641+00:00'[39m
    },
    {
      id: [32m'739cdfe1-328f-45a7-bad7-a490761bb43c'[39m,
      restaurant_id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Filet z kurczaka tradycyjny (panierowany)'[39m,
      description: [32m'Filet drobiowy panierowany, ziemniaki, surÃ³wka'[39m,
      category: [32m'Danie gÅ‚Ã³wne'[39m,
      base_type: [32m'kurczak'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m15[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-26T15:49:25.550641+00:00'[39m
    },
    {
      id: [32m'e939262c-f11a-4f06-b513-204c82e2bf4c'[39m,
      restaurant_id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Fondant czekoladowy z lodami i bitÄ… Å›mietanÄ…'[39m,
      description: [32m'Fondant czekoladowy, lody, bita Å›mietana'[39m,
      category: [32m'Deser'[39m,
      base_type: [32m'fondant'[39m,
      meat_type: [32m'vege'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m22[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mtrue[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-26T15:45:53.945113+00:00'[39m
    },
    {
      id: [32m'2f1b8974-f6d0-46d8-8387-7679c54e9c28'[39m,
      restaurant_id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Grillowany filet z kurczaka'[39m,
      description: [32m'Grillowany filet, ziemniaki, surÃ³wka'[39m,
      category: [32m'Danie gÅ‚Ã³wne'[39m,
      base_type: [32m'kurczak'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m15[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-26T15:49:25.550641+00:00'[39m
    },
    {
      id: [32m'3b95bad4-976f-4d8b-a333-bc912d79886d'[39m,
      restaurant_id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Gulasz wieprzowy po wÄ™giersku'[39m,
      description: [32m'Gulasz, ziemniaki, zestaw surÃ³wek'[39m,
      category: [32m'Danie gÅ‚Ã³wne'[39m,
      base_type: [32m'gulasz'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m23[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-26T15:51:18.018618+00:00'[39m
    },
    {
      id: [32m'001a11cc-a541-4f59-8a56-c2c4eafe464d'[39m,
      restaurant_id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Jajecznica z 2 szt. jaj'[39m,
      description: [32m'Jajecznica, pieczywo'[39m,
      category: [32m'Åšniadanie'[39m,
      base_type: [32m'jajecznica'[39m,
      meat_type: [32m'vege'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m11[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mtrue[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-26T15:52:04.270001+00:00'[39m
    }
  ]
}
ðŸ”¬ Starting Smart Intent Layer...
[intent-router] ðŸš€ detectIntent called with: { text: [32m'Jakie jest menu w Klaps Burgers?'[39m, sessionId: [90mundefined[39m }
[intent-router] ðŸ” Starting early dish detection for text: Jakie jest menu w Klaps Burgers?
[intent-router] ðŸ” Normalized text: jakie jest menu w klaps burgers?
[intent-router] ðŸ” Session restaurant: NONE
[intent-router] ðŸ” Restaurant indicators in text: true
[intent-router] ðŸ” Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
[intent-router] ðŸ” Checking 9 restaurants for fuzzy match
[intent-router] ðŸª Restaurant detected in text (exact): Klaps Burgers
[loadMenuCatalog] ðŸ” Session: {
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
}
[loadMenuCatalog] ðŸ” lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[loadMenuCatalog] ðŸ” lastId: 569a7d29-57be-4224-bdf3-09c483415cea
[loadMenuCatalog] âœ… Loading menu for restaurant: 569a7d29-57be-4224-bdf3-09c483415cea (Klaps Burgers)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
[loadMenuCatalog] âœ… Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] âœ… Sample items: Kosmiczne Jaja Double, Wegetrix Double, Å»wirek i Muchomorek Standard
[intent-router] Catalog loaded: 21 items
[intent-router] ðŸ” Calling parseOrderItems...
[intent-router] ðŸ” Catalog items: Kosmiczne Jaja Double, Wegetrix Double, Å»wirek i Muchomorek Standard, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, GÅ‚odzilla, Kosmiczne Jaja Standard
[parseOrderItems] ðŸ“Š Summary:
  - requestedNames: [burger]
  - availableNames: []
  - unavailableNames: [burger]
  - matched.length: 0
  - clarifications.length: 0
[intent-router] âœ… Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "burger"
  ],
  "needsClarification": true,
  "unknownItems": []
}
[intent-router] ðŸ” parsed.any = false
[intent-router] ðŸ” parsed.groups.length = 0
âš ï¸ Unavailable items detected: burger in tym menu
ðŸ” Checking if text contains restaurant name (using cached list): "jakie jest menu w klaps burgers?"
âœ… Text contains restaurant name: Klaps Burgers â€” skipping clarify_order
[intent-router] âŒ No dishes matched in catalog (parsed.any = false)
[intent-router] âŒ Continuing to KROK 4 (targetRestaurant check)...

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
[intent-router] ðŸ” KROK 4: Checking targetRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[intent-router] ðŸª KROK 4: Restaurant found in early detection: Klaps Burgers, checking keywords...
[intent-router] ðŸ” KROK 4: Lower text: "jakie jest menu w klaps burgers"
[intent-router] ðŸ” KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'pokaÅ¼ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta daÅ„'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ðŸ” KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] âš ï¸ KROK 4: Menu keyword found, returning menu_request
[intent-router] âš ï¸ KROK 4: This may override create_order from KROK 2!
ðŸ” Debug session updated: {
  intent: [32m'menu_request'[39m,
  restaurant: [32m'Klaps Burgers'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
âœ… SmartIntent Resolved: show_menu (0.90) via llm
ðŸ§  [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'show_menu'[39m,
  ruleConfidence: [33m0.9[39m,
  llmIntent: [32m'show_menu'[39m,
  llmConfidence: [33m0.9[39m,
  finalIntent: [32m'show_menu'[39m,
  finalConfidence: [33m0.9[39m,
  source: [32m'llm'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Klaps Burgers'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
ðŸ§  [DEBUG] Calling boostIntent with: {
  text: [32m'Jakie jest menu w Klaps Burgers?'[39m,
  hybridIntent: [32m'show_menu'[39m,
  confidence: [33m0.9[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastRestaurant: [32m'Restauracja Stara Kamienica'[39m,
    lastIntent: [32m'menu_request'[39m
  }
}
ðŸ§  [DEBUG] boostIntent result: {
  originalIntent: [32m'show_menu'[39m,
  boostedIntent: [32m'show_menu'[39m,
  isContextLocked: [33mfalse[39m
}
ðŸ“‹ Parsed: { dish: [1mnull[22m, restaurant: [32m'Klaps Burgers'[39m }
ðŸ§  menu_request intent detected

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
âœ… Matched restaurant: "Klaps Burgers" â†’ Klaps Burgers
âœ… Restaurant set: Klaps Burgers

POST /api/brain 200 14275 - 3677.859 ms
[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Klaps Burgers[22m[39m
âœ… Menu loaded: 21 items (showing 6) from Klaps Burgers
âš ï¸ Skipping LLM reply generation (test mode or no key), using replyCore
âœ… Final response: intent=show_menu, confidence=0.9, fallback=false
ðŸ“¦ Final Response Preparation: MenuItems count = 6

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
[brainRouter] ðŸš€ Handler called

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
ðŸ§  [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  text: [32m'PokaÅ¼ menu w Pizzeria Monte Carlo'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043893663'[39m,
    text: [32m'PokaÅ¼ menu w Pizzeria Monte Carlo'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m33[39m
}
ðŸ§  [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastIntent: [32m'show_menu'[39m,
    lastRestaurant: {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary Å›lÄ…skie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ÅšlÄ…skie'[39m,
    lastUpdated: [33m1766043898953[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ]
  },
  hasExpectedContext: [33mfalse[39m,
  expectedContextValue: [1mnull[22m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Klaps Burgers'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ÅšlÄ…skie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'show_menu'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m
  ]
}
ðŸ§­ GeoContext Layer activated for: "Pizzeria Monte Carlo"

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
âš™ï¸ GeoContext: brak wynikÃ³w w "Pizzeria Monte Carlo"
âš™ï¸ GeoContext: brak wynikÃ³w w "Pizzeria Monte Carlo" â€” kontynuuj normalny flow

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
[brainRouter] ðŸ§  Calling detectIntent with: {
  text: [32m'PokaÅ¼ menu w Pizzeria Monte Carlo'[39m,
  sessionId: [32m'e2e_piekary_1766043893663'[39m
}
[brainRouter] ðŸ§  Current session: {
  expectedContext: [1mnull[22m,
  lastIntent: [32m'show_menu'[39m,
  lastRestaurant: {
    id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
    name: [32m'Klaps Burgers'[39m,
    address: [32m'ul. Piotra Skargi 15'[39m,
    city: [32m'Piekary ÅšlÄ…skie'[39m,
    lat: [33m50.38643[39m,
    lng: [33m18.95422[39m
  },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary Å›lÄ…skie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043894604[39m }
  },
  last_location: [32m'Piekary ÅšlÄ…skie'[39m,
  lastUpdated: [33m1766043898953[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'MiÄ™dzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'AmerykaÅ„ska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. KsiÄ™dza Piotra Skargi 3'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'DwÃ³r Hubertus'[39m,
      address: [32m'ul. InwalidÃ³w Wojennych 72'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'ÅšlÄ…ska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. StanisÅ‚awa Maczka 22'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'a1a67286-2aaf-4cb7-ae05-50573652391c'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Double'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 400g, ser cheddar, saÅ‚ata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m46[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'009797c9-808b-4b8a-89b4-79d8d9ece27a'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Standard'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 200g, ser cheddar, saÅ‚ata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m36[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'fecf6c54-17f4-4bb6-8a50-6a5944a11728'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'GÅ‚odzilla'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, 100% woÅ‚owina 200g, grillowany boczek, ser camembert, nachos, papryka, saÅ‚ata rzymska, czerwona cebula, sos mango, czosnek'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m59[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'108af5f7-ea9e-46f2-8d06-d7837e181dce'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Grzybiarz z Piekaryhill'[39m,
      description: [32m'BuÅ‚ka, woÅ‚owina, boczek, majonez, saÅ‚ata, marynowana cebula, ser cheddar, grzyby, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m40[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'b5bde246-f3e9-4854-8bcf-c60787647ca0'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Double'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 400g, ser cheddar, grillowana dynia w pomaraÅ„czy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m49[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'c6b011fa-882d-4894-a84f-9a41acae5dbc'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Standard'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 200g, ser cheddar, grillowana dynia w pomaraÅ„czy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m39[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    }
  ]
}
ðŸ”¬ Starting Smart Intent Layer...
[intent-router] ðŸš€ detectIntent called with: { text: [32m'PokaÅ¼ menu w Pizzeria Monte Carlo'[39m, sessionId: [90mundefined[39m }
[intent-router] ðŸ” Starting early dish detection for text: PokaÅ¼ menu w Pizzeria Monte Carlo
[intent-router] ðŸ” Normalized text: pokaÅ¼ menu w pizzeria monte carlo
[intent-router] ðŸ” Session restaurant: NONE
[intent-router] ðŸ” Restaurant indicators in text: true
[intent-router] ðŸ” Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
[intent-router] ðŸ” Checking 9 restaurants for fuzzy match
[intent-router] ðŸª Restaurant detected in text (exact): Pizzeria Monte Carlo
[loadMenuCatalog] ðŸ” Session: {
  lastRestaurant: {
    id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
    name: [32m'Pizzeria Monte Carlo'[39m
  }
}
[loadMenuCatalog] ðŸ” lastRestaurant: {
  id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
  name: [32m'Pizzeria Monte Carlo'[39m
}
[loadMenuCatalog] ðŸ” lastId: 83566974-1017-4408-90ee-2571ccc06978
[loadMenuCatalog] âœ… Loading menu for restaurant: 83566974-1017-4408-90ee-2571ccc06978 (Pizzeria Monte Carlo)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
[loadMenuCatalog] âœ… Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] âœ… Sample items: Hawajska, Coca-Cola, Coca-Cola Zero
[intent-router] Catalog loaded: 21 items
[intent-router] ðŸ” Calling parseOrderItems...
[intent-router] ðŸ” Catalog items: Hawajska, Coca-Cola, Coca-Cola Zero, Fanta PomaraÅ„czowa, Sprite, Cappy JabÅ‚ko, Cappy PomaraÅ„cza, Woda Mineralna, Tiramisu, Panna Cotta, Brownie, Lody waniliowe z sosem karmelowym, Margherita, Capricciosa, Diavola, Quattro Formaggi, Vegetariana, Prosciutto e Funghi, Salami, Pollo, Spinaci
[parseOrderItems] ðŸ“Š Summary:
  - requestedNames: []
  - availableNames: []
  - unavailableNames: []
  - matched.length: 0
  - clarifications.length: 0
[intent-router] âœ… Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "pokaÅ¼ menu w pizzeria monte carlo"
  ],
  "needsClarification": true,
  "unknownItems": [
    {
      "name": "pokaÅ¼ menu w pizzeria monte carlo",
      "reason": "no_alias_match"
    }
  ]
}
[intent-router] ðŸ” parsed.any = false
[intent-router] ðŸ” parsed.groups.length = 0
âš ï¸ Unavailable items detected: pokaÅ¼ menu w pizzeria monte carlo in tym menu
ðŸ” Checking if text contains restaurant name (using cached list): "pokaÅ¼ menu w pizzeria monte carlo"
âœ… Text contains restaurant name: Pizzeria Monte Carlo â€” skipping clarify_order
[intent-router] âŒ No dishes matched in catalog (parsed.any = false)
[intent-router] âŒ Continuing to KROK 4 (targetRestaurant check)...

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
[intent-router] ðŸ” KROK 4: Checking targetRestaurant: {
  id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
  name: [32m'Pizzeria Monte Carlo'[39m
}
[intent-router] ðŸª KROK 4: Restaurant found in early detection: Pizzeria Monte Carlo, checking keywords...
[intent-router] ðŸ” KROK 4: Lower text: "pokaz menu w pizzeria monte carlo"
[intent-router] ðŸ” KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'pokaÅ¼ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta daÅ„'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ðŸ” KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] âš ï¸ KROK 4: Menu keyword found, returning menu_request
[intent-router] âš ï¸ KROK 4: This may override create_order from KROK 2!
ðŸ” Debug session updated: {
  intent: [32m'menu_request'[39m,
  restaurant: [32m'Pizzeria Monte Carlo'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
âœ… SmartIntent Resolved: show_menu (0.90) via llm
ðŸ§  [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'show_menu'[39m,
  ruleConfidence: [33m0.9[39m,
  llmIntent: [32m'show_menu'[39m,
  llmConfidence: [33m0.9[39m,
  finalIntent: [32m'show_menu'[39m,
  finalConfidence: [33m0.9[39m,
  source: [32m'llm'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Pizzeria Monte Carlo'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
ðŸ§  [DEBUG] Calling boostIntent with: {
  text: [32m'PokaÅ¼ menu w Pizzeria Monte Carlo'[39m,
  hybridIntent: [32m'show_menu'[39m,
  confidence: [33m0.9[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastRestaurant: [32m'Klaps Burgers'[39m,
    lastIntent: [32m'show_menu'[39m
  }
}
ðŸ§  [DEBUG] boostIntent result: {
  originalIntent: [32m'show_menu'[39m,
  boostedIntent: [32m'show_menu'[39m,
  isContextLocked: [33mfalse[39m
}
ðŸ“‹ Parsed: { dish: [1mnull[22m, restaurant: [32m'Pizzeria Monte Carlo'[39m }
ðŸ§  menu_request intent detected

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
âœ… Matched restaurant: "Pizzeria Monte Carlo" â†’ Pizzeria Monte Carlo
âœ… Restaurant set: Pizzeria Monte Carlo

POST /api/brain 200 13045 - 2240.583 ms
[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokazaÄ‡ menu dla Pizzeria Monte Carlo[22m[39m
âœ… Menu loaded: 21 items (showing 6) from Pizzeria Monte Carlo
âš ï¸ Skipping LLM reply generation (test mode or no key), using replyCore
âœ… Final response: intent=show_menu, confidence=0.9, fallback=false
ðŸ“¦ Final Response Preparation: MenuItems count = 6

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
[brainRouter] ðŸš€ Handler called

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
ðŸ§  [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  text: [32m'Wybieram Pizzeria Monte Carlo'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043893663'[39m,
    text: [32m'Wybieram Pizzeria Monte Carlo'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m29[39m
}
ðŸ§  [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastIntent: [32m'show_menu'[39m,
    lastRestaurant: {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. StanisÅ‚awa Maczka 22'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary Å›lÄ…skie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ÅšlÄ…skie'[39m,
    lastUpdated: [33m1766043901835[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ]
  },
  hasExpectedContext: [33mfalse[39m,
  expectedContextValue: [1mnull[22m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Pizzeria Monte Carlo'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ÅšlÄ…skie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'show_menu'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m
  ]
}
ðŸ§­ GeoContext Layer activated for: "Wybieram Pizzeria Monte Carlo"

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
âš™ï¸ GeoContext: brak wynikÃ³w w "Wybieram Pizzeria Monte Carlo"
âš™ï¸ GeoContext: brak wynikÃ³w w "Wybieram Pizzeria Monte Carlo" â€” kontynuuj normalny flow

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
[brainRouter] ðŸ§  Calling detectIntent with: {
  text: [32m'Wybieram Pizzeria Monte Carlo'[39m,
  sessionId: [32m'e2e_piekary_1766043893663'[39m
}
[brainRouter] ðŸ§  Current session: {
  expectedContext: [1mnull[22m,
  lastIntent: [32m'show_menu'[39m,
  lastRestaurant: {
    id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
    name: [32m'Pizzeria Monte Carlo'[39m,
    address: [32m'Ul. StanisÅ‚awa Maczka 22'[39m,
    city: [32m'Piekary ÅšlÄ…skie'[39m,
    lat: [1mnull[22m,
    lng: [1mnull[22m
  },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary Å›lÄ…skie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043894604[39m }
  },
  last_location: [32m'Piekary ÅšlÄ…skie'[39m,
  lastUpdated: [33m1766043901835[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'MiÄ™dzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'AmerykaÅ„ska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. KsiÄ™dza Piotra Skargi 3'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'DwÃ³r Hubertus'[39m,
      address: [32m'ul. InwalidÃ³w Wojennych 72'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'ÅšlÄ…ska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. StanisÅ‚awa Maczka 22'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'e472c234-04d2-4872-a635-761f00f9853c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Brownie'[39m,
      description: [32m'Czekoladowe ciasto z orzechami wÅ‚oskimi'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m14[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'1a7eeba7-8c23-4fdb-a7c8-fcccbfa0008d'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Capricciosa'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, pieczarki'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m33[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'91088af5-2a2a-4bb3-96af-8907fcd4471e'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Diavola'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, pikantne salami, papryczki jalapeÃ±o'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m34[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'2346a6d2-4f63-4c47-b217-f752cfa02a9b'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Hawajska'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, ananas'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m32[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'03ce8a1a-be58-407c-87df-48ab33817f5c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Margherita'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, bazylia'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m28[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'8492d2e8-fc47-4381-af16-8ef4e1aa7b04'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Panna Cotta'[39m,
      description: [32m'Z musem truskawkowym'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m15[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    }
  ]
}
ðŸ”¬ Starting Smart Intent Layer...
[intent-router] ðŸš€ detectIntent called with: { text: [32m'Wybieram Pizzeria Monte Carlo'[39m, sessionId: [90mundefined[39m }
[intent-router] ðŸ” Starting early dish detection for text: Wybieram Pizzeria Monte Carlo
[intent-router] ðŸ” Normalized text: wybieram pizzeria monte carlo
[intent-router] ðŸ” Session restaurant: NONE
[intent-router] ðŸ” Restaurant indicators in text: true
[intent-router] ðŸ” Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
[intent-router] ðŸ” Checking 9 restaurants for fuzzy match
[intent-router] ðŸª Restaurant detected in text (exact): Pizzeria Monte Carlo
[loadMenuCatalog] ðŸ” Session: {
  lastRestaurant: {
    id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
    name: [32m'Pizzeria Monte Carlo'[39m
  }
}
[loadMenuCatalog] ðŸ” lastRestaurant: {
  id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
  name: [32m'Pizzeria Monte Carlo'[39m
}
[loadMenuCatalog] ðŸ” lastId: 83566974-1017-4408-90ee-2571ccc06978
[loadMenuCatalog] âœ… Loading menu for restaurant: 83566974-1017-4408-90ee-2571ccc06978 (Pizzeria Monte Carlo)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
[loadMenuCatalog] âœ… Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] âœ… Sample items: Hawajska, Coca-Cola, Coca-Cola Zero
[intent-router] Catalog loaded: 21 items
[intent-router] ðŸ” Calling parseOrderItems...
[intent-router] ðŸ” Catalog items: Hawajska, Coca-Cola, Coca-Cola Zero, Fanta PomaraÅ„czowa, Sprite, Cappy JabÅ‚ko, Cappy PomaraÅ„cza, Woda Mineralna, Tiramisu, Panna Cotta, Brownie, Lody waniliowe z sosem karmelowym, Margherita, Capricciosa, Diavola, Quattro Formaggi, Vegetariana, Prosciutto e Funghi, Salami, Pollo, Spinaci
[parseOrderItems] ðŸ“Š Summary:
  - requestedNames: []
  - availableNames: []
  - unavailableNames: []
  - matched.length: 0
  - clarifications.length: 0
[intent-router] âœ… Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "wybieram pizzeria monte carlo"
  ],
  "needsClarification": true,
  "unknownItems": [
    {
      "name": "wybieram pizzeria monte carlo",
      "reason": "no_alias_match"
    }
  ]
}
[intent-router] ðŸ” parsed.any = false
[intent-router] ðŸ” parsed.groups.length = 0
âš ï¸ Unavailable items detected: wybieram pizzeria monte carlo in tym menu
ðŸ” Checking if text contains restaurant name (using cached list): "wybieram pizzeria monte carlo"
âœ… Text contains restaurant name: Pizzeria Monte Carlo â€” skipping clarify_order
[intent-router] âŒ No dishes matched in catalog (parsed.any = false)
[intent-router] âŒ Continuing to KROK 4 (targetRestaurant check)...

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
[intent-router] ðŸ” KROK 4: Checking targetRestaurant: {
  id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
  name: [32m'Pizzeria Monte Carlo'[39m
}
[intent-router] ðŸª KROK 4: Restaurant found in early detection: Pizzeria Monte Carlo, checking keywords...
[intent-router] ðŸ” KROK 4: Lower text: "wybieram pizzeria monte carlo"
[intent-router] ðŸ” KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'pokaÅ¼ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta daÅ„'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ðŸ” KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] âœ… Order keyword found, returning create_order
ðŸ” Debug session updated: {
  intent: [32m'create_order'[39m,
  restaurant: [32m'Pizzeria Monte Carlo'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}

POST /api/brain 200 12743 - 4128.601 ms
[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
âœ… SmartIntent Resolved: confirm_order (0.90) via llm
ðŸ§  [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'confirm_order'[39m,
  ruleConfidence: [33m0.9[39m,
  llmIntent: [32m'confirm_order'[39m,
  llmConfidence: [33m0.9[39m,
  finalIntent: [32m'confirm_order'[39m,
  finalConfidence: [33m0.9[39m,
  source: [32m'llm'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Pizzeria Monte Carlo'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
ðŸ§  [DEBUG] Calling boostIntent with: {
  text: [32m'Wybieram Pizzeria Monte Carlo'[39m,
  hybridIntent: [32m'confirm_order'[39m,
  confidence: [33m0.9[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastRestaurant: [32m'Pizzeria Monte Carlo'[39m,
    lastIntent: [32m'show_menu'[39m
  }
}
ðŸ§  [DEBUG] boostIntent result: {
  originalIntent: [32m'confirm_order'[39m,
  boostedIntent: [32m'confirm_order'[39m,
  isContextLocked: [33mfalse[39m
}
ðŸ“‹ Parsed: { dish: [1mnull[22m, restaurant: [1mnull[22m }
âœ… confirm_order intent detected
âš ï¸ No pending order to commit
âš ï¸ Skipping LLM reply generation (test mode or no key), using replyCore
âœ… Final response: intent=confirm_order, confidence=0.9, fallback=false
ðŸ“¦ Final Response Preparation: MenuItems count = 6

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
[brainRouter] ðŸš€ Handler called

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
ðŸ§  [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  text: [32m'ZamÃ³w jednÄ… duÅ¼Ä… pizzÄ™ margherita'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043893663'[39m,
    text: [32m'ZamÃ³w jednÄ… duÅ¼Ä… pizzÄ™ margherita'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m33[39m
}
ðŸ§  [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastIntent: [32m'confirm_order'[39m,
    lastRestaurant: {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. StanisÅ‚awa Maczka 22'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary Å›lÄ…skie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ÅšlÄ…skie'[39m,
    lastUpdated: [33m1766043906309[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ]
  },
  hasExpectedContext: [33mfalse[39m,
  expectedContextValue: [1mnull[22m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Pizzeria Monte Carlo'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ÅšlÄ…skie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'confirm_order'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m
  ]
}
ðŸ§­ GeoContext Layer activated for: "jednÄ… duÅ¼Ä… pizzÄ™ margherita"

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
[brainRouter] ðŸ§  Calling detectIntent with: {
  text: [32m'ZamÃ³w jednÄ… duÅ¼Ä… pizzÄ™ margherita'[39m,
  sessionId: [32m'e2e_piekary_1766043893663'[39m
}
[brainRouter] ðŸ§  Current session: {
  expectedContext: [1mnull[22m,
  lastIntent: [32m'confirm_order'[39m,
  lastRestaurant: {
    id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
    name: [32m'Pizzeria Monte Carlo'[39m,
    address: [32m'Ul. StanisÅ‚awa Maczka 22'[39m,
    city: [32m'Piekary ÅšlÄ…skie'[39m,
    lat: [1mnull[22m,
    lng: [1mnull[22m
  },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary Å›lÄ…skie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043894604[39m }
  },
  last_location: [32m'Piekary ÅšlÄ…skie'[39m,
  lastUpdated: [33m1766043906309[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'MiÄ™dzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'AmerykaÅ„ska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. KsiÄ™dza Piotra Skargi 3'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'DwÃ³r Hubertus'[39m,
      address: [32m'ul. InwalidÃ³w Wojennych 72'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'ÅšlÄ…ska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. StanisÅ‚awa Maczka 22'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'e472c234-04d2-4872-a635-761f00f9853c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Brownie'[39m,
      description: [32m'Czekoladowe ciasto z orzechami wÅ‚oskimi'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m14[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'1a7eeba7-8c23-4fdb-a7c8-fcccbfa0008d'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Capricciosa'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, pieczarki'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m33[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'91088af5-2a2a-4bb3-96af-8907fcd4471e'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Diavola'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, pikantne salami, papryczki jalapeÃ±o'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m34[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'2346a6d2-4f63-4c47-b217-f752cfa02a9b'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Hawajska'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, ananas'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m32[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'03ce8a1a-be58-407c-87df-48ab33817f5c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Margherita'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, bazylia'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m28[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'8492d2e8-fc47-4381-af16-8ef4e1aa7b04'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Panna Cotta'[39m,
      description: [32m'Z musem truskawkowym'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m15[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    }
  ]
}
ðŸ”¬ Starting Smart Intent Layer...
[intent-router] ðŸš€ detectIntent called with: { text: [32m'ZamÃ³w jednÄ… duÅ¼Ä… pizzÄ™ margherita'[39m, sessionId: [90mundefined[39m }
[intent-router] ðŸ” Starting early dish detection for text: ZamÃ³w jednÄ… duÅ¼Ä… pizzÄ™ margherita
[intent-router] ðŸ” Normalized text: zamÃ³w jednÄ… duÅ¼Ä… pizzÄ™ margherita
[intent-router] ðŸ” Session restaurant: NONE
[intent-router] ðŸ” Restaurant indicators in text: true
[intent-router] ðŸ” Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
âš™ï¸ GeoContext: brak wynikÃ³w w "jednÄ… duÅ¼Ä… pizzÄ™ margherita"
âš™ï¸ GeoContext: brak wynikÃ³w w "jednÄ… duÅ¼Ä… pizzÄ™ margherita" â€” kontynuuj normalny flow

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
[intent-router] ðŸ” Checking 9 restaurants for fuzzy match
[loadMenuCatalog] ðŸ” Session: default
[loadMenuCatalog] ðŸ” lastRestaurant: [90mundefined[39m
[loadMenuCatalog] ðŸ” lastId: [90mundefined[39m
[loadMenuCatalog] âš ï¸ Loading all menu items (no restaurant in session)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
[loadMenuCatalog] âœ… Loaded 246 menu items from 9 restaurants
[loadMenuCatalog] âœ… Sample items: Pizza Å unkovÃ¡, Pizza Ekkluzivne, Pizza LÃ¡ska NebeskÃ¡
[intent-router] Catalog loaded: 246 items
[intent-router] ðŸ” Calling parseOrderItems...
[intent-router] ðŸ” Catalog items: Pizza Å unkovÃ¡, Pizza Ekkluzivne, Pizza LÃ¡ska NebeskÃ¡, Rumcajsowy Burger, Golonka confit, SaÅ‚atka z halloumi, Zupa pomidorowa, Kofola klasyczna, Hawajska, Coca-Cola, Coca-Cola Zero, Fanta PomaraÅ„czowa, Sprite, Coca-Cola, Fanta, Piwo Tyskie, Pizza Margherita 33cm, Pizza Pepperoni 33cm, Pizza Hawajska 33cm, Pizza Capricciosa 33cm, Pizza Vege 33cm, Bacon Burger, Better Than Drwal - WoÅ‚owina, Cheddar Burger, Vege Burger, Spicy Burger, Bowl Gyros-Halloumi, Bowl z DyniÄ…, Bowl Kurczak Zapiekany z Serem, Filet Grillowany, Pulled Pork Bowl Pikantny, Zapiekaniec, Cappy JabÅ‚ko, Krem z Cebuli i Czosnku, SaÅ‚atka Cezar Callzone, SaÅ‚atka Grillowany Kurczak, SaÅ‚atka Halloumi, SaÅ‚atka z Serem Camembert, SaÅ‚atka z Serem Feta, SaÅ‚atka z DyniÄ…, Szarlotka, Sernik z Musem Malinowym, Ciasto Marchewkowe, Pepsi 0.85L, Kawa Czarna, Kawa BiaÅ‚a, Flat White, Cappuccino, Latte, Sos Tzatziki, Sos Pikantny, Sos Jogurtowy, GÄ™sie Å¼oÅ‚Ä…dki, Camembert z Å¼urawinÄ…, Deska zakÄ…sek dla dwojga, Wodzionka, Å»ur Å›lÄ…ski w chlebie, Å»ur Å›lÄ…ski na talerzu, Krem borowikowy, Zupa pomidorowa, Barszcz z tortellini, Flaki z indyka, Burger woÅ‚owy z frytkami i surÃ³wkÄ…, Burger wegetariaÅ„ski z Camembertem, frytkami oraz zestawem surÃ³wek, Gyros z frytkami i tzatziki, Å»eberka wieprzowe z frytkami, Kotlety czopskie, Dzikie placki, WÄ…trÃ³bka drobiowa, Grillowany filet z kurczaka, Kurczak po parysku, Ä†wiartka kaczki, Rolada wieprzowa, Kotlet schabowy, PolÄ™dwica wieprzowa, Kotlet po szwajcarsku, Rolada woÅ‚owa, OzÃ³r woÅ‚owy, Miruna w panierce, Zupa z kaczki, Zupa Won Ton, Tagliatelle ze szpinakiem, suszonymi pomidorami i pÅ‚atkami migdaÅ‚Ã³w, RosÃ³Å‚ z makaronem, NaleÅ›niki z serem na sÅ‚odko z bitÄ… Å›mietanÄ…, Carbonara a'la Hubertus, Filet z Å‚ososia na szpinaku, Stek z halibuta smaÅ¼ony na maÅ›le, PstrÄ…g na zioÅ‚owo, Pierogi z miÄ™sem, Pierogi ruskie, Kluski z sosem pieczeniowym, SaÅ‚atka Hubertusa z pieczywem czosnkowym, SaÅ‚atka grecka z pieczywem czosnkowym, Kluski Å›lÄ…skie, Ziemniaki z wody, Bratkartoffel, Kapusta modra, Kapusta zasmaÅ¼ana, Nuggetsy z frytkami oraz surÃ³wkÄ… z marchewki, Cappy PomaraÅ„cza, Woda Mineralna, Tiramisu, Panna Cotta, Brownie, Lody waniliowe z sosem karmelowym, Kosmiczne Jaja Double, Wegetrix Double, Å»wirek i Muchomorek Standard, Zupa krabowa, Sajgonki 3 szt., Sajgonki z ryÅ¼em, Sajgonki z surÃ³wkÄ…, Sajgonki z ryÅ¼em i surÃ³wkÄ…, Pierogi Ho Cao z ryÅ¼em i surÃ³wkÄ…, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Krem z dyni z biaÅ‚Ä… czekoladÄ…, Siekany tatar z polÄ™dwicy woÅ‚owej, WÄ™dzony pstrÄ…g, Carpaccio z kaczki marynowanej w grzaÅ„cu, BUFFAL, Kartacze z dzikiem, SaÅ‚atka z dyniÄ… marynowanÄ… w musztardzie, Grzanka z krupniokiem, Tagliatelle z krewetkami, Makaron ryÅ¼owy z warzywami, Zupa dnia, RosÃ³Å‚ z makaronem, Tradycyjny schabowy, Schab po beskidzku, NaleÅ›nik z kurczakiem i warzywami, NaleÅ›nik ze szpinakiem i serem feta, Lody z gorÄ…cymi malinami i bitÄ… Å›mietanÄ…, Fondant czekoladowy z lodami i bitÄ… Å›mietanÄ…, Coca-Cola, Fanta, Sprite, Cappy (200 ml), Woda mineralna (330 ml), Filet z kurczaka tradycyjny (panierowany), Filet z kurczaka po hawajsku, Grillowany filet z kurczaka, Kroket (z kapustÄ… i grzybami/bÄ…dÅº z miÄ™sem) 1 szt., Placki ziemniaczane 4 szt., Kluski Å›lÄ…skie 7 szt., Rolada woÅ‚owa (na zamÃ³wienie), PieczeÅ„ wieprzowa, WÄ…trÃ³bka drobiowa, Gulasz wieprzowy po wÄ™giersku, Pierogi (ruskie lub z miÄ™sem) 6 szt., Jajecznica z 2 szt. jaj, Placki po wÄ™giersku z gulaszem wieprzowym, NaleÅ›nik z dÅ¼emem truskawkowym lub wiÅ›niowym, NaleÅ›nik z nutellÄ…, bananami, bitÄ… Å›mietanÄ…, Margherita, Capricciosa, Diavola, Quattro Formaggi, Vegetariana, Prosciutto e Funghi, Salami, Pollo, Spinaci, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, GÅ‚odzilla, Kosmiczne Jaja Standard, Zupa wietnamska, Zupa z kurczakiem, Zupa Å‚ajska, Pierogi SiuMai z ryÅ¼em i surÃ³wkÄ…, Kurczak z warzywami, Kurczak sÅ‚odko-kwaÅ›ny, Kurczak pikantny, Kurczak po chiÅ„sku, Kurczak po tajsku, Kurczak na gorÄ…cym pÃ³Å‚misku, Kurczak w cieÅ›cie sÅ‚odko-kwaÅ›ny, Kurczak w cieÅ›cie pikantny, Kurczak w cieÅ›cie curry, Kurczak w cieÅ›cie piÄ™ciu smakÃ³w, Wieprzowina z warzywami, Wieprzowina sÅ‚odko-kwaÅ›na, Wieprzowina pikantna, Wieprzowina Curry, Wieprzowina piÄ™ciu smakÃ³w, Wieprzowina po tajsku, WoÅ‚owina z warzywami, WoÅ‚owina pikantna, WoÅ‚owina Curry, WoÅ‚owina 5 smakÃ³w, WoÅ‚owina po tajsku, WoÅ‚owina na gorÄ…cym pÃ³Å‚misku, Kaczka z warzywami, Kaczka pikantna, Kaczka sÅ‚odko-kwaÅ›na, Kaczka po chiÅ„sku, Kaczka po tajsku, Kaczka na gorÄ…cym pÃ³Å‚misku, Krewetki z warzywami, Krewetki pikantne, Krewetki Curry, Krewetki po tajsku, Krewetki na gorÄ…cym pÃ³Å‚misku, Kalmary chrupiÄ…ce sÅ‚odko-kwaÅ›ne, Kalmary chrupiÄ…ce pikantne, Kalmary chrupiÄ…ce Curry, Kalmary chrupiÄ…ce w piÄ™ciu smakach, Kalmary po tajsku, Kalmary na gorÄ…cym pÃ³Å‚misku, Pita Rollo, Pita Rollo z serem, Pita Rollo same miÄ™so, Tortilla kebab, Tortilla kebab z serem, Kebab amerykaÅ„ski, Kebab box, Kebab box z serem, Nuggets box, Kebab talerz, Kebab w buÅ‚ce, Falafel, Frytki z serem, Frytki z Indii masala, SaÅ‚atka grecka, Sos, Baklava, Sok Cappy, Coca-Cola 0,85l, Coca-Cola 0,5l, Coca-Cola 0,3l, Pepsi / Mirinda / 7up, Monster Energy Drink, Ayran Turecki, Mango Sok, Oshee, Burn
[parseOrderItems] ðŸ“Š Summary:
  - requestedNames: [pizza margherita]
  - availableNames: [pizza margherita 33cm, zupa dnia, margherita]
  - unavailableNames: []
  - matched.length: 3
  - clarifications.length: 0
[intent-router] âœ… Parsed result: {
  "any": true,
  "groups": [
    {
      "restaurant_id": "bd9f2244-7618-4071-aa96-52616a7b4c70",
      "restaurant_name": "Callzone",
      "items": [
        {
          "menuItemId": "e0825375-5306-47c9-9786-cb8ed45884ba",
          "name": "Pizza Margherita 33cm",
          "price": 33,
          "quantity": 1
        }
      ]
    },
    {
      "restaurant_id": "1fc1e782-bac6-47b2-978a-f6f2b38000cd",
      "restaurant_name": "Restauracja Stara Kamienica",
      "items": [
        {
          "menuItemId": "8dcb0a80-df84-4c1e-9035-ed3570ce66a8",
          "name": "Zupa dnia",
          "price": 9,
          "quantity": 1
        }
      ]
    },
    {
      "restaurant_id": "83566974-1017-4408-90ee-2571ccc06978",
      "restaurant_name": "Pizzeria Monte Carlo",
      "items": [
        {
          "menuItemId": "03ce8a1a-be58-407c-87df-48ab33817f5c",
          "name": "Margherita",
          "price": 28,
          "quantity": 1
        }
      ]
    }
  ],
  "clarify": [],
  "available": [
    {
      "menuItemId": "e0825375-5306-47c9-9786-cb8ed45884ba",
      "name": "Pizza Margherita 33cm",
      "price": 33,
      "quantity": 1,
      "restaurant_id": "bd9f2244-7618-4071-aa96-52616a7b4c70",
      "restaurant_name": "Callzone",
      "matchScore": 1
    },
    {
      "menuItemId": "8dcb0a80-df84-4c1e-9035-ed3570ce66a8",
      "name": "Zupa dnia",
      "price": 9,
      "quantity": 1,
      "restaurant_id": "1fc1e782-bac6-47b2-978a-f6f2b38000cd",
      "restaurant_name": "Restauracja Stara Kamienica",
      "matchScore": 1
    },
    {
      "menuItemId": "03ce8a1a-be58-407c-87df-48ab33817f5c",
      "name": "Margherita",
      "price": 28,
      "quantity": 1,
      "restaurant_id": "83566974-1017-4408-90ee-2571ccc06978",
      "restaurant_name": "Pizzeria Monte Carlo",
      "matchScore": 1
    }
  ],
  "unavailable": [],
  "needsClarification": false,
  "unknownItems": []
}
[intent-router] ðŸ” parsed.any = true
[intent-router] ðŸ” parsed.groups.length = 3
ðŸ½ï¸ âœ… EARLY DISH DETECTION SUCCESS! Dish detected: Pizza Margherita 33cm | Zupa dnia | Margherita
ðŸ½ï¸ âœ… Returning create_order immediately (HIGHEST PRIORITY)
ðŸ½ï¸ âœ… parsedOrder: {
  "any": true,
  "groups": [
    {
      "restaurant_id": "bd9f2244-7618-4071-aa96-52616a7b4c70",
      "restaurant_name": "Callzone",
      "items": [
        {
          "menuItemId": "e0825375-5306-47c9-9786-cb8ed45884ba",
          "name": "Pizza Margherita 33cm",
          "price": 33,
          "quantity": 1
        }
      ]
    },
    {
      "restaurant_id": "1fc1e782-bac6-47b2-978a-f6f2b38000cd",
      "restaurant_name": "Restauracja Stara Kamienica",
      "items": [
        {
          "menuItemId": "8dcb0a80-df84-4c1e-9035-ed3570ce66a8",
          "name": "Zupa dnia",
          "price": 9,
          "quantity": 1
        }
      ]
    },
    {
      "restaurant_id": "83566974-1017-4408-90ee-2571ccc06978",
      "restaurant_name": "Pizzeria Monte Carlo",
      "items": [
        {
          "menuItemId": "03ce8a1a-be58-407c-87df-48ab33817f5c",
          "name": "Margherita",
          "price": 28,
          "quantity": 1
        }
      ]
    }
  ],
  "clarify": [],
  "available": [
    {
      "menuItemId": "e0825375-5306-47c9-9786-cb8ed45884ba",
      "name": "Pizza Margherita 33cm",
      "price": 33,
      "quantity": 1,
      "restaurant_id": "bd9f2244-7618-4071-aa96-52616a7b4c70",
      "restaurant_name": "Callzone",
      "matchScore": 1
    },
    {
      "menuItemId": "8dcb0a80-df84-4c1e-9035-ed3570ce66a8",
      "name": "Zupa dnia",
      "price": 9,
      "quantity": 1,
      "restaurant_id": "1fc1e782-bac6-47b2-978a-f6f2b38000cd",
      "restaurant_name": "Restauracja Stara Kamienica",
      "matchScore": 1
    },
    {
      "menuItemId": "03ce8a1a-be58-407c-87df-48ab33817f5c",
      "name": "Margherita",
      "price": 28,
      "quantity": 1,
      "restaurant_id": "83566974-1017-4408-90ee-2571ccc06978",
      "restaurant_name": "Pizzeria Monte Carlo",
      "matchScore": 1
    }
  ],
  "unavailable": [],
  "needsClarification": false,
  "unknownItems": []
}
ðŸ” Debug session updated: {
  intent: [32m'create_order'[39m,
  restaurant: [32m'Callzone'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.85[39m
}
âœ… SmartIntent Resolved: create_order (0.85) via classic
ðŸ§  [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'create_order'[39m,
  ruleConfidence: [33m0.85[39m,
  llmIntent: [1mnull[22m,
  llmConfidence: [33m0[39m,
  finalIntent: [32m'create_order'[39m,
  finalConfidence: [33m0.85[39m,
  source: [32m'classic'[39m,
  hasRestaurant: [33mfalse[39m,
  restaurantName: [90mundefined[39m,
  hasParsedOrder: [33mtrue[39m,
  parsedOrderDetails: {
    any: [33mtrue[39m,
    groupsCount: [33m3[39m,
    groups: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ]
  }
}
ðŸ”’ SmartContext: skipping boost (parsedOrder exists)
ðŸ“‹ Parsed: { dish: [32m'jednÄ… duÅ¼Ä… pizzÄ™ margherita'[39m, restaurant: [1mnull[22m }
ðŸ§  create_order intent detected
âœ… Using parsedOrder from detectIntent()

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
âœ… Matched restaurant: "Callzone" â†’ Callzone

POST /api/brain 200 12997 - 1163.346 ms
[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ pizzÄ™ margheritÄ™ do zamÃ³wienia w Pizzeria Monte Carlo[22m[39m
ðŸ” [create_order] Loaded 35 items for validation
ðŸ§  Saved/merged pending order to session: {
  items: [
    {
      id: [32m'e0825375-5306-47c9-9786-cb8ed45884ba'[39m,
      name: [32m'Pizza Margherita 33cm'[39m,
      price_pln: [33m33[39m,
      qty: [33m1[39m
    }
  ],
  restaurant: [32m'Callzone'[39m,
  restaurant_id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
  total: [32m'33.00'[39m
}
âœ… Pending order saved to session:
   - expectedContext: confirm_order
   - pendingOrder items count: [33m1[39m
   - pendingOrder items: 1x Pizza Margherita 33cm
   - total: 33.00 zÅ‚
   - items details: [
  {
    "id": "e0825375-5306-47c9-9786-cb8ed45884ba",
    "name": "Pizza Margherita 33cm",
    "price": 33,
    "quantity": 1
  }
]
â³ Waiting for user confirmation (expecting "tak", "dodaj", etc.)
âš ï¸ Skipping LLM reply generation (test mode or no key), using replyCore
âœ… Final response: intent=create_order, confidence=0.9, fallback=false
ðŸ“¦ Final Response Preparation: MenuItems count = 6

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
[brainRouter] ðŸš€ Handler called

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
ðŸ§  [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  text: [32m'ChcÄ™ zamÃ³wiÄ‡ w Klaps Burgers'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043893663'[39m,
    text: [32m'ChcÄ™ zamÃ³wiÄ‡ w Klaps Burgers'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m28[39m
}
ðŸ§  [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  session: {
    expectedContext: [32m'confirm_order'[39m,
    lastIntent: [32m'create_order'[39m,
    lastRestaurant: {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. KsiÄ™dza Piotra Skargi 3'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary Å›lÄ…skie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ÅšlÄ…skie'[39m,
    lastUpdated: [33m1766043907078[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ],
    pendingOrder: { restaurant: [36m[Object][39m, items: [36m[Array][39m, total: [33m33[39m }
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'confirm_order'[39m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Callzone'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ÅšlÄ…skie'[39m,
  hasPendingOrder: [33mtrue[39m,
  lastIntent: [32m'create_order'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m,
    [32m'pendingOrder'[39m
  ]
}
ðŸ§­ GeoContext Layer activated for: "Klaps Burgers"

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
âš™ï¸ GeoContext: brak wynikÃ³w w "Klaps Burgers"
âš™ï¸ GeoContext: brak wynikÃ³w w "Klaps Burgers" â€” kontynuuj normalny flow

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
[brainRouter] ðŸ§  Calling detectIntent with: {
  text: [32m'ChcÄ™ zamÃ³wiÄ‡ w Klaps Burgers'[39m,
  sessionId: [32m'e2e_piekary_1766043893663'[39m
}
[brainRouter] ðŸ§  Current session: {
  expectedContext: [32m'confirm_order'[39m,
  lastIntent: [32m'create_order'[39m,
  lastRestaurant: {
    id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
    name: [32m'Callzone'[39m,
    address: [32m'ul. KsiÄ™dza Piotra Skargi 3'[39m,
    city: [32m'Piekary ÅšlÄ…skie'[39m,
    lat: [33m50.38594[39m,
    lng: [33m18.95647[39m
  },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary Å›lÄ…skie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043894604[39m }
  },
  last_location: [32m'Piekary ÅšlÄ…skie'[39m,
  lastUpdated: [33m1766043907078[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'MiÄ™dzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'AmerykaÅ„ska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. KsiÄ™dza Piotra Skargi 3'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'DwÃ³r Hubertus'[39m,
      address: [32m'ul. InwalidÃ³w Wojennych 72'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'ÅšlÄ…ska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. StanisÅ‚awa Maczka 22'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'e472c234-04d2-4872-a635-761f00f9853c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Brownie'[39m,
      description: [32m'Czekoladowe ciasto z orzechami wÅ‚oskimi'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m14[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'1a7eeba7-8c23-4fdb-a7c8-fcccbfa0008d'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Capricciosa'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, pieczarki'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m33[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'91088af5-2a2a-4bb3-96af-8907fcd4471e'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Diavola'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, pikantne salami, papryczki jalapeÃ±o'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m34[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'2346a6d2-4f63-4c47-b217-f752cfa02a9b'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Hawajska'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, ananas'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m32[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'03ce8a1a-be58-407c-87df-48ab33817f5c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Margherita'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, bazylia'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m28[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'8492d2e8-fc47-4381-af16-8ef4e1aa7b04'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Panna Cotta'[39m,
      description: [32m'Z musem truskawkowym'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m15[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    }
  ],
  pendingOrder: {
    restaurant: {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m
    },
    items: [ [36m[Object][39m ],
    total: [33m33[39m
  }
}
ðŸ”¬ Starting Smart Intent Layer...
[intent-router] ðŸš€ detectIntent called with: { text: [32m'ChcÄ™ zamÃ³wiÄ‡ w Klaps Burgers'[39m, sessionId: [90mundefined[39m }
[intent-router] ðŸ” Starting early dish detection for text: ChcÄ™ zamÃ³wiÄ‡ w Klaps Burgers
[intent-router] ðŸ” Normalized text: chcÄ™ zamÃ³wiÄ‡ w klaps burgers
[intent-router] ðŸ” Session restaurant: NONE
[intent-router] ðŸ” Restaurant indicators in text: true
[intent-router] ðŸ” Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
[intent-router] ðŸ” Checking 9 restaurants for fuzzy match
[intent-router] ðŸª Restaurant detected in text (exact): Klaps Burgers
[loadMenuCatalog] ðŸ” Session: {
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
}
[loadMenuCatalog] ðŸ” lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[loadMenuCatalog] ðŸ” lastId: 569a7d29-57be-4224-bdf3-09c483415cea
[loadMenuCatalog] âœ… Loading menu for restaurant: 569a7d29-57be-4224-bdf3-09c483415cea (Klaps Burgers)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
[loadMenuCatalog] âœ… Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] âœ… Sample items: Kosmiczne Jaja Double, Wegetrix Double, Å»wirek i Muchomorek Standard
[intent-router] Catalog loaded: 21 items
[intent-router] ðŸ” Calling parseOrderItems...
[intent-router] ðŸ” Catalog items: Kosmiczne Jaja Double, Wegetrix Double, Å»wirek i Muchomorek Standard, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, GÅ‚odzilla, Kosmiczne Jaja Standard
[parseOrderItems] ðŸ“Š Summary:
  - requestedNames: [burger]
  - availableNames: []
  - unavailableNames: [burger]
  - matched.length: 0
  - clarifications.length: 0
[intent-router] âœ… Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "burger"
  ],
  "needsClarification": true,
  "unknownItems": []
}
[intent-router] ðŸ” parsed.any = false
[intent-router] ðŸ” parsed.groups.length = 0
âš ï¸ Unavailable items detected: burger in tym menu
ðŸ” Checking if text contains restaurant name (using cached list): "chcÄ™ zamÃ³wiÄ‡ w klaps burgers"
âœ… Text contains restaurant name: Klaps Burgers â€” skipping clarify_order
[intent-router] âŒ No dishes matched in catalog (parsed.any = false)
[intent-router] âŒ Continuing to KROK 4 (targetRestaurant check)...

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
[intent-router] ðŸ” KROK 4: Checking targetRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[intent-router] ðŸª KROK 4: Restaurant found in early detection: Klaps Burgers, checking keywords...
[intent-router] ðŸ” KROK 4: Lower text: "chce zamowic w klaps burgers"
[intent-router] ðŸ” KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'pokaÅ¼ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta daÅ„'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ðŸ” KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] âœ… Order keyword found, returning create_order
ðŸ” Debug session updated: {
  intent: [32m'create_order'[39m,
  restaurant: [32m'Klaps Burgers'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}
âœ… SmartIntent Resolved: create_order (0.00) via classic
ðŸ§  [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'create_order'[39m,
  ruleConfidence: [33m0[39m,
  llmIntent: [1mnull[22m,
  llmConfidence: [33m0[39m,
  finalIntent: [32m'create_order'[39m,
  finalConfidence: [33m0[39m,
  source: [32m'classic'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Klaps Burgers'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
ðŸ§  [DEBUG] Calling boostIntent with: {
  text: [32m'ChcÄ™ zamÃ³wiÄ‡ w Klaps Burgers'[39m,
  hybridIntent: [32m'create_order'[39m,
  confidence: [33m0[39m,
  session: {
    expectedContext: [32m'confirm_order'[39m,
    lastRestaurant: [32m'Callzone'[39m,
    lastIntent: [32m'create_order'[39m
  }
}
â„¹ï¸ boostIntent: Skipping boost, already detected order intent: create_order
ðŸ§  [DEBUG] boostIntent result: {
  originalIntent: [32m'create_order'[39m,
  boostedIntent: [32m'create_order'[39m,
  isContextLocked: [33mfalse[39m
}
ðŸ“‹ Parsed: { dish: [32m'zamÃ³wiÄ‡ w Klaps Burgers'[39m, restaurant: [1mnull[22m }
ðŸ§  create_order intent detected
âœ… Restaurant set: Klaps Burgers
ðŸ›’ Parsing order items from: "ChcÄ™ zamÃ³wiÄ‡ w Klaps Burgers" with 2-Phase Parsing

POST /api/brain 200 13195 - 1194.562 ms
[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
âœ… Found dish (Phase 1): Hot-dog by KLAPS (qty: 1)
âœ… Found dish (Phase 1): Klaps Fiction Standard (qty: 1)
âœ… Found dish (Phase 1): Klaps Fiction Double (qty: 1)
ðŸ›’ Parsed 3 items: [
  {
    id: [32m'497b708c-d521-4567-92d3-b9459b358cef'[39m,
    name: [32m'Hot-dog by KLAPS'[39m,
    price: [33m39[39m,
    quantity: [33m1[39m
  },
  {
    id: [32m'e40452f2-0b66-45ef-a414-15f41d2c1688'[39m,
    name: [32m'Klaps Fiction Standard'[39m,
    price: [33m32[39m,
    quantity: [33m1[39m
  },
  {
    id: [32m'e8496674-8134-4072-90bb-e01d245b3777'[39m,
    name: [32m'Klaps Fiction Double'[39m,
    price: [33m42[39m,
    quantity: [33m1[39m
  }
]
âœ… Parsed order: [
  {
    id: [32m'497b708c-d521-4567-92d3-b9459b358cef'[39m,
    name: [32m'Hot-dog by KLAPS'[39m,
    price: [33m39[39m,
    quantity: [33m1[39m
  },
  {
    id: [32m'e40452f2-0b66-45ef-a414-15f41d2c1688'[39m,
    name: [32m'Klaps Fiction Standard'[39m,
    price: [33m32[39m,
    quantity: [33m1[39m
  },
  {
    id: [32m'e8496674-8134-4072-90bb-e01d245b3777'[39m,
    name: [32m'Klaps Fiction Double'[39m,
    price: [33m42[39m,
    quantity: [33m1[39m
  }
]
âœ… Pending order saved to session (fallback path):
   - expectedContext: confirm_order
   - pendingOrder items count: [33m3[39m
   - pendingOrder items: 1x Hot-dog by KLAPS, 1x Klaps Fiction Standard, 1x Klaps Fiction Double
   - total: 113.00 zÅ‚
   - items details: [
  {
    "id": "497b708c-d521-4567-92d3-b9459b358cef",
    "name": "Hot-dog by KLAPS",
    "price": 39,
    "quantity": 1
  },
  {
    "id": "e40452f2-0b66-45ef-a414-15f41d2c1688",
    "name": "Klaps Fiction Standard",
    "price": 32,
    "quantity": 1
  },
  {
    "id": "e8496674-8134-4072-90bb-e01d245b3777",
    "name": "Klaps Fiction Double",
    "price": 42,
    "quantity": 1
  }
]
â³ Waiting for user confirmation (expecting "tak", "dodaj", etc.)
âš ï¸ Skipping LLM reply generation (test mode or no key), using replyCore
âœ… Final response: intent=create_order, confidence=0.9, fallback=false
ðŸ“¦ Final Response Preparation: MenuItems count = 6

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
[brainRouter] ðŸš€ Handler called

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
ðŸ§  [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  text: [32m'ChcÄ™ dwa burgery'[39m,
  method: [32m'POST'[39m,
  body: { sessionId: [32m'e2e_piekary_1766043893663'[39m, text: [32m'ChcÄ™ dwa burgery'[39m },
  hasText: [33mtrue[39m,
  textLength: [33m16[39m
}
ðŸ§  [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043893663'[39m,
  session: {
    expectedContext: [32m'confirm_order'[39m,
    lastIntent: [32m'create_order'[39m,
    lastRestaurant: {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary Å›lÄ…skie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ÅšlÄ…skie'[39m,
    lastUpdated: [33m1766043908434[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ],
    pendingOrder: { restaurant: [36m[Object][39m, items: [36m[Array][39m, total: [33m113[39m }
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'confirm_order'[39m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Klaps Burgers'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ÅšlÄ…skie'[39m,
  hasPendingOrder: [33mtrue[39m,
  lastIntent: [32m'create_order'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m,
    [32m'pendingOrder'[39m
  ]
}
ðŸ§­ GeoContext Layer activated for: "Chc"

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
[brainRouter] ðŸ§  Calling detectIntent with: { text: [32m'ChcÄ™ dwa burgery'[39m, sessionId: [32m'e2e_piekary_1766043893663'[39m }
[brainRouter] ðŸ§  Current session: {
  expectedContext: [32m'confirm_order'[39m,
  lastIntent: [32m'create_order'[39m,
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary Å›lÄ…skie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043894604[39m }
  },
  last_location: [32m'Piekary ÅšlÄ…skie'[39m,
  lastUpdated: [33m1766043908434[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'MiÄ™dzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'AmerykaÅ„ska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. KsiÄ™dza Piotra Skargi 3'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'DwÃ³r Hubertus'[39m,
      address: [32m'ul. InwalidÃ³w Wojennych 72'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'ÅšlÄ…ska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. StanisÅ‚awa Maczka 22'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'e472c234-04d2-4872-a635-761f00f9853c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Brownie'[39m,
      description: [32m'Czekoladowe ciasto z orzechami wÅ‚oskimi'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m14[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'1a7eeba7-8c23-4fdb-a7c8-fcccbfa0008d'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Capricciosa'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, pieczarki'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m33[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'91088af5-2a2a-4bb3-96af-8907fcd4471e'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Diavola'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, pikantne salami, papryczki jalapeÃ±o'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m34[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'2346a6d2-4f63-4c47-b217-f752cfa02a9b'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Hawajska'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, ananas'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m32[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'03ce8a1a-be58-407c-87df-48ab33817f5c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Margherita'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, bazylia'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m28[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'8492d2e8-fc47-4381-af16-8ef4e1aa7b04'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Panna Cotta'[39m,
      description: [32m'Z musem truskawkowym'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m15[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    }
  ],
  pendingOrder: {
    restaurant: {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      city: [90mundefined[39m
    },
    items: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ],
    total: [33m113[39m
  }
}
ðŸ”¬ Starting Smart Intent Layer...
[intent-router] ðŸš€ detectIntent called with: { text: [32m'ChcÄ™ dwa burgery'[39m, sessionId: [90mundefined[39m }
[intent-router] ðŸ” Starting early dish detection for text: ChcÄ™ dwa burgery
[intent-router] ðŸ” Normalized text: chcÄ™ dwa burgery
[intent-router] ðŸ” Session restaurant: NONE
[intent-router] ðŸ” Restaurant indicators in text: false
[intent-router] ðŸ” Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
âš™ï¸ GeoContext: brak wynikÃ³w w "Chc"
âš™ï¸ GeoContext: brak wynikÃ³w w "Chc" â€” kontynuuj normalny flow

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
[intent-router] ðŸ” Checking 9 restaurants for fuzzy match
[intent-router] ðŸª Restaurant detected in text (fuzzy): Klaps Burgers (matched: 1/2)
[loadMenuCatalog] ðŸ” Session: {
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
}
[loadMenuCatalog] ðŸ” lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[loadMenuCatalog] ðŸ” lastId: 569a7d29-57be-4224-bdf3-09c483415cea
[loadMenuCatalog] âœ… Loading menu for restaurant: 569a7d29-57be-4224-bdf3-09c483415cea (Klaps Burgers)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
[loadMenuCatalog] âœ… Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] âœ… Sample items: Kosmiczne Jaja Double, Wegetrix Double, Å»wirek i Muchomorek Standard
[intent-router] Catalog loaded: 21 items
[intent-router] ðŸ” Calling parseOrderItems...
[intent-router] ðŸ” Catalog items: Kosmiczne Jaja Double, Wegetrix Double, Å»wirek i Muchomorek Standard, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, GÅ‚odzilla, Kosmiczne Jaja Standard
[parseOrderItems] ðŸ“Š Summary:
  - requestedNames: [burger]
  - availableNames: []
  - unavailableNames: [burger]
  - matched.length: 0
  - clarifications.length: 0
[intent-router] âœ… Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "burger"
  ],
  "needsClarification": true,
  "unknownItems": []
}
[intent-router] ðŸ” parsed.any = false
[intent-router] ðŸ” parsed.groups.length = 0
âš ï¸ Unavailable items detected: burger in tym menu
ðŸ” Checking if text contains restaurant name (using cached list): "chcÄ™ dwa burgery"
âœ… Text contains restaurant name: Klaps Burgers â€” skipping clarify_order
[intent-router] âŒ No dishes matched in catalog (parsed.any = false)
[intent-router] âŒ Continuing to KROK 4 (targetRestaurant check)...

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
[intent-router] ðŸ” KROK 4: Checking targetRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[intent-router] ðŸª KROK 4: Restaurant found in early detection: Klaps Burgers, checking keywords...
[intent-router] ðŸ” KROK 4: Lower text: "chce dwa burgery"
[intent-router] ðŸ” KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'pokaÅ¼ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta daÅ„'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ðŸ” KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] âœ… No specific keywords, returning select_restaurant
ðŸ” Debug session updated: {
  intent: [32m'select_restaurant'[39m,
  restaurant: [32m'Klaps Burgers'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}
âœ… SmartIntent Resolved: select_restaurant (0.00) via classic
ðŸ§  [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'select_restaurant'[39m,
  ruleConfidence: [33m0[39m,
  llmIntent: [1mnull[22m,
  llmConfidence: [33m0[39m,
  finalIntent: [32m'select_restaurant'[39m,
  finalConfidence: [33m0[39m,
  source: [32m'classic'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Klaps Burgers'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
ðŸ§  [DEBUG] Calling boostIntent with: {
  text: [32m'ChcÄ™ dwa burgery'[39m,
  hybridIntent: [32m'select_restaurant'[39m,
  confidence: [33m0[39m,
  session: {
    expectedContext: [32m'confirm_order'[39m,
    lastRestaurant: [32m'Klaps Burgers'[39m,
    lastIntent: [32m'create_order'[39m
  }
}
ðŸ§  [DEBUG] boostIntent result: {
  originalIntent: [32m'select_restaurant'[39m,
  boostedIntent: [32m'select_restaurant'[39m,
  isContextLocked: [33mfalse[39m
}
ðŸ“‹ Parsed: { dish: [32m'burgery'[39m, restaurant: [1mnull[22m }
ðŸ§  select_restaurant intent detected
ðŸ§  Hybrid Selection: no match (method: none)
âœ… Using restaurant from detectIntent: Klaps Burgers
âœ… Auto-showing menu for: Klaps Burgers

POST /api/brain 200 14128 - 1143.775 ms
[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22m[2mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[22m[39m
âš ï¸ Skipping LLM reply generation (test mode or no key), using replyCore
âœ… Final response: intent=select_restaurant, confidence=0.9, fallback=false
ðŸ“¦ Final Response Preparation: MenuItems count = 6

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
[brainRouter] ðŸš€ Handler called

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
ðŸ§  [DEBUG] Handler called with: {
  sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m,
  text: [32m'PokaÅ¼ restauracje w Piekarach ÅšlÄ…skich'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m,
    text: [32m'PokaÅ¼ restauracje w Piekarach ÅšlÄ…skich'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m38[39m
}
ðŸ§  [DEBUG] Current session state: {
  sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m,
  session: {
    expectedContext: [32m'neutral'[39m,
    lastIntent: [1mnull[22m,
    lastRestaurant: [1mnull[22m,
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: []
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'neutral'[39m,
  hasLastRestaurant: [33mfalse[39m,
  lastRestaurantName: [90mundefined[39m,
  hasLastLocation: [33mfalse[39m,
  lastLocation: [90mundefined[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [1mnull[22m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m
  ]
}
ðŸ§­ GeoContext Layer activated for: "Piekary ÅšlÄ…skie"

POST /api/brain 200 5715 - 197.395 ms
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
ðŸ—ºï¸ Found 9 restaurants in "Piekary ÅšlÄ…skie"
ðŸ’¾ Cache SAVED for location: "Piekary ÅšlÄ…skie"
ðŸš€ GeoContext: Direct request detected -> Skipping confirmation

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
[brainRouter] ðŸš€ Handler called

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
ðŸ§  [DEBUG] Handler called with: {
  sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m,
  text: [32m'Wybierz Klaps Burgers'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m,
    text: [32m'Wybierz Klaps Burgers'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m21[39m
}
ðŸ§  [DEBUG] Current session state: {
  sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m,
  session: {
    expectedContext: [32m'select_restaurant'[39m,
    lastIntent: [32m'find_nearby'[39m,
    lastRestaurant: [1mnull[22m,
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary Å›lÄ…skie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ÅšlÄ…skie'[39m,
    lastUpdated: [33m1766043910038[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ]
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'select_restaurant'[39m,
  hasLastRestaurant: [33mfalse[39m,
  lastRestaurantName: [90mundefined[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ÅšlÄ…skie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'find_nearby'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m
  ]
}
ðŸ§­ GeoContext Layer activated for: "Wybierz Klaps Burgers"

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
âš™ï¸ GeoContext: brak wynikÃ³w w "Wybierz Klaps Burgers"
âš™ï¸ GeoContext: brak wynikÃ³w w "Wybierz Klaps Burgers" â€” kontynuuj normalny flow

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
[brainRouter] ðŸ§  Calling detectIntent with: {
  text: [32m'Wybierz Klaps Burgers'[39m,
  sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m
}
[brainRouter] ðŸ§  Current session: {
  expectedContext: [32m'select_restaurant'[39m,
  lastIntent: [32m'find_nearby'[39m,
  lastRestaurant: [1mnull[22m,
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary Å›lÄ…skie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043909942[39m }
  },
  last_location: [32m'Piekary ÅšlÄ…skie'[39m,
  lastUpdated: [33m1766043910038[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'MiÄ™dzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'AmerykaÅ„ska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. KsiÄ™dza Piotra Skargi 3'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'DwÃ³r Hubertus'[39m,
      address: [32m'ul. InwalidÃ³w Wojennych 72'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'ÅšlÄ…ska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. StanisÅ‚awa Maczka 22'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ]
}
ðŸ”¬ Starting Smart Intent Layer...
[intent-router] ðŸš€ detectIntent called with: { text: [32m'Wybierz Klaps Burgers'[39m, sessionId: [90mundefined[39m }
[intent-router] ðŸ” Starting early dish detection for text: Wybierz Klaps Burgers
[intent-router] ðŸ” Normalized text: wybierz klaps burgers
[intent-router] ðŸ” Session restaurant: NONE
[intent-router] ðŸ” Restaurant indicators in text: false
[intent-router] ðŸ” Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
[intent-router] ðŸ” Checking 9 restaurants for fuzzy match
[intent-router] ðŸª Restaurant detected in text (exact): Klaps Burgers
[loadMenuCatalog] ðŸ” Session: {
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
}
[loadMenuCatalog] ðŸ” lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[loadMenuCatalog] ðŸ” lastId: 569a7d29-57be-4224-bdf3-09c483415cea
[loadMenuCatalog] âœ… Loading menu for restaurant: 569a7d29-57be-4224-bdf3-09c483415cea (Klaps Burgers)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
[loadMenuCatalog] âœ… Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] âœ… Sample items: Kosmiczne Jaja Double, Wegetrix Double, Å»wirek i Muchomorek Standard
[intent-router] Catalog loaded: 21 items
[intent-router] ðŸ” Calling parseOrderItems...
[intent-router] ðŸ” Catalog items: Kosmiczne Jaja Double, Wegetrix Double, Å»wirek i Muchomorek Standard, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, GÅ‚odzilla, Kosmiczne Jaja Standard
[parseOrderItems] ðŸ“Š Summary:
  - requestedNames: [burger]
  - availableNames: []
  - unavailableNames: [burger]
  - matched.length: 0
  - clarifications.length: 0
[intent-router] âœ… Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "burger"
  ],
  "needsClarification": true,
  "unknownItems": []
}
[intent-router] ðŸ” parsed.any = false
[intent-router] ðŸ” parsed.groups.length = 0
âš ï¸ Unavailable items detected: burger in tym menu
ðŸ” Checking if text contains restaurant name (using cached list): "wybierz klaps burgers"
âœ… Text contains restaurant name: Klaps Burgers â€” skipping clarify_order
[intent-router] âŒ No dishes matched in catalog (parsed.any = false)
[intent-router] âŒ Continuing to KROK 4 (targetRestaurant check)...

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
[intent-router] ðŸ” KROK 4: Checking targetRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[intent-router] ðŸª KROK 4: Restaurant found in early detection: Klaps Burgers, checking keywords...
[intent-router] ðŸ” KROK 4: Lower text: "wybierz klaps burgers"
[intent-router] ðŸ” KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'pokaÅ¼ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta daÅ„'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ðŸ” KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] âœ… No specific keywords, returning select_restaurant
ðŸ” Debug session updated: {
  intent: [32m'select_restaurant'[39m,
  restaurant: [32m'Klaps Burgers'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}
âœ… SmartIntent Resolved: select_restaurant (0.00) via classic
ðŸ§  [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'select_restaurant'[39m,
  ruleConfidence: [33m0[39m,
  llmIntent: [1mnull[22m,
  llmConfidence: [33m0[39m,
  finalIntent: [32m'select_restaurant'[39m,
  finalConfidence: [33m0[39m,
  source: [32m'classic'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Klaps Burgers'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
ðŸ§  [DEBUG] Calling boostIntent with: {
  text: [32m'Wybierz Klaps Burgers'[39m,
  hybridIntent: [32m'select_restaurant'[39m,
  confidence: [33m0[39m,
  session: {
    expectedContext: [32m'select_restaurant'[39m,
    lastRestaurant: [90mundefined[39m,
    lastIntent: [32m'find_nearby'[39m
  }
}
ðŸ§  [DEBUG] boostIntent result: {
  originalIntent: [32m'select_restaurant'[39m,
  boostedIntent: [32m'select_restaurant'[39m,
  isContextLocked: [33mfalse[39m
}
ðŸ“‹ Parsed: { dish: [1mnull[22m, restaurant: [32m'Klaps Burgers'[39m }
ðŸ§  select_restaurant intent detected
ðŸ§  Hybrid Selection: no match (method: none)
âœ… Using restaurant from detectIntent: Klaps Burgers
âœ… Auto-showing menu for: Klaps Burgers

POST /api/brain 200 13708 - 890.969 ms
[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
âš ï¸ Skipping LLM reply generation (test mode or no key), using replyCore
âœ… Final response: intent=select_restaurant, confidence=0.9, fallback=false
ðŸ“¦ Final Response Preparation: MenuItems count = 6

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
[brainRouter] ðŸš€ Handler called

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
ðŸ§  [DEBUG] Handler called with: {
  sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m,
  text: [32m'ChcÄ™ burgery'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m,
    text: [32m'ChcÄ™ burgery'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m12[39m
}
ðŸ§  [DEBUG] Current session state: {
  sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastIntent: [32m'select_restaurant'[39m,
    lastRestaurant: {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary Å›lÄ…skie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ÅšlÄ…skie'[39m,
    lastUpdated: [33m1766043910798[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ]
  },
  hasExpectedContext: [33mfalse[39m,
  expectedContextValue: [1mnull[22m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Klaps Burgers'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ÅšlÄ…skie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'select_restaurant'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m
  ]
}
ðŸ§­ GeoContext Layer activated for: "Chc"

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
âš™ï¸ GeoContext: brak wynikÃ³w w "Chc"
âš™ï¸ GeoContext: brak wynikÃ³w w "Chc" â€” kontynuuj normalny flow

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
[brainRouter] ðŸ§  Calling detectIntent with: { text: [32m'ChcÄ™ burgery'[39m, sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m }
[brainRouter] ðŸ§  Current session: {
  expectedContext: [1mnull[22m,
  lastIntent: [32m'select_restaurant'[39m,
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary Å›lÄ…skie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043909942[39m }
  },
  last_location: [32m'Piekary ÅšlÄ…skie'[39m,
  lastUpdated: [33m1766043910798[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'MiÄ™dzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'AmerykaÅ„ska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. KsiÄ™dza Piotra Skargi 3'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'DwÃ³r Hubertus'[39m,
      address: [32m'ul. InwalidÃ³w Wojennych 72'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'ÅšlÄ…ska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. StanisÅ‚awa Maczka 22'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'a1a67286-2aaf-4cb7-ae05-50573652391c'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Double'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 400g, ser cheddar, saÅ‚ata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m46[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'009797c9-808b-4b8a-89b4-79d8d9ece27a'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Standard'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 200g, ser cheddar, saÅ‚ata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m36[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'fecf6c54-17f4-4bb6-8a50-6a5944a11728'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'GÅ‚odzilla'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, 100% woÅ‚owina 200g, grillowany boczek, ser camembert, nachos, papryka, saÅ‚ata rzymska, czerwona cebula, sos mango, czosnek'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m59[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'108af5f7-ea9e-46f2-8d06-d7837e181dce'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Grzybiarz z Piekaryhill'[39m,
      description: [32m'BuÅ‚ka, woÅ‚owina, boczek, majonez, saÅ‚ata, marynowana cebula, ser cheddar, grzyby, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m40[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'b5bde246-f3e9-4854-8bcf-c60787647ca0'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Double'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 400g, ser cheddar, grillowana dynia w pomaraÅ„czy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m49[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'c6b011fa-882d-4894-a84f-9a41acae5dbc'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Standard'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 200g, ser cheddar, grillowana dynia w pomaraÅ„czy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m39[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    }
  ]
}
ðŸ”¬ Starting Smart Intent Layer...
[intent-router] ðŸš€ detectIntent called with: { text: [32m'ChcÄ™ burgery'[39m, sessionId: [90mundefined[39m }
[intent-router] ðŸ” Starting early dish detection for text: ChcÄ™ burgery
[intent-router] ðŸ” Normalized text: chcÄ™ burgery
[intent-router] ðŸ” Session restaurant: NONE
[intent-router] ðŸ” Restaurant indicators in text: false
[intent-router] ðŸ” Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
[intent-router] ðŸ” Checking 9 restaurants for fuzzy match
[intent-router] ðŸª Restaurant detected in text (fuzzy): Klaps Burgers (matched: 1/2)
[loadMenuCatalog] ðŸ” Session: {
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
}
[loadMenuCatalog] ðŸ” lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[loadMenuCatalog] ðŸ” lastId: 569a7d29-57be-4224-bdf3-09c483415cea
[loadMenuCatalog] âœ… Loading menu for restaurant: 569a7d29-57be-4224-bdf3-09c483415cea (Klaps Burgers)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
[loadMenuCatalog] âœ… Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] âœ… Sample items: Kosmiczne Jaja Double, Wegetrix Double, Å»wirek i Muchomorek Standard
[intent-router] Catalog loaded: 21 items
[intent-router] ðŸ” Calling parseOrderItems...
[intent-router] ðŸ” Catalog items: Kosmiczne Jaja Double, Wegetrix Double, Å»wirek i Muchomorek Standard, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, GÅ‚odzilla, Kosmiczne Jaja Standard
[parseOrderItems] ðŸ“Š Summary:
  - requestedNames: [burger]
  - availableNames: []
  - unavailableNames: [burger]
  - matched.length: 0
  - clarifications.length: 0
[intent-router] âœ… Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "burger"
  ],
  "needsClarification": true,
  "unknownItems": []
}
[intent-router] ðŸ” parsed.any = false
[intent-router] ðŸ” parsed.groups.length = 0
âš ï¸ Unavailable items detected: burger in tym menu
ðŸ” Checking if text contains restaurant name (using cached list): "chcÄ™ burgery"
âœ… Text contains restaurant name: Klaps Burgers â€” skipping clarify_order
[intent-router] âŒ No dishes matched in catalog (parsed.any = false)
[intent-router] âŒ Continuing to KROK 4 (targetRestaurant check)...

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
[intent-router] ðŸ” KROK 4: Checking targetRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[intent-router] ðŸª KROK 4: Restaurant found in early detection: Klaps Burgers, checking keywords...
[intent-router] ðŸ” KROK 4: Lower text: "chce burgery"
[intent-router] ðŸ” KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'pokaÅ¼ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta daÅ„'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ðŸ” KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] âœ… No specific keywords, returning select_restaurant
ðŸ” Debug session updated: {
  intent: [32m'select_restaurant'[39m,
  restaurant: [32m'Klaps Burgers'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
âœ… SmartIntent Resolved: create_order (0.90) via llm
ðŸ§  [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'create_order'[39m,
  ruleConfidence: [33m0.9[39m,
  llmIntent: [32m'create_order'[39m,
  llmConfidence: [33m0.9[39m,
  finalIntent: [32m'create_order'[39m,
  finalConfidence: [33m0.9[39m,
  source: [32m'llm'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Klaps Burgers'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
ðŸ§  [DEBUG] Calling boostIntent with: {
  text: [32m'ChcÄ™ burgery'[39m,
  hybridIntent: [32m'create_order'[39m,
  confidence: [33m0.9[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastRestaurant: [32m'Klaps Burgers'[39m,
    lastIntent: [32m'select_restaurant'[39m
  }
}
ðŸ§  [DEBUG] boostIntent result: {
  originalIntent: [32m'create_order'[39m,
  boostedIntent: [32m'create_order'[39m,
  isContextLocked: [33mfalse[39m
}
ðŸ“‹ Parsed: { dish: [32m'burgery'[39m, restaurant: [1mnull[22m }
ðŸ§  create_order intent detected
âœ… Restaurant set: Klaps Burgers
ðŸ›’ Parsing order items from: "ChcÄ™ burgery" with 2-Phase Parsing

POST /api/brain 200 14018 - 2402.071 ms
[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger ogÃ³lny): powinien obsÅ‚uÅ¼yÄ‡ "ChcÄ™ burgery" po wyborze Klaps Burgers[22m[39m
âœ… Found dish via Category/Generic match (Phase 3): "Kosmiczne Jaja Double" (qty: 1)
ðŸ›’ Parsed 1 items: [
  {
    id: [32m'6201f101-584a-431b-ad84-253aa5640cc3'[39m,
    name: [32m'Kosmiczne Jaja Double'[39m,
    price: [33m46[39m,
    quantity: [33m1[39m
  }
]
âœ… Parsed order: [
  {
    id: [32m'6201f101-584a-431b-ad84-253aa5640cc3'[39m,
    name: [32m'Kosmiczne Jaja Double'[39m,
    price: [33m46[39m,
    quantity: [33m1[39m
  }
]
âœ… Pending order saved to session (fallback path):
   - expectedContext: confirm_order
   - pendingOrder items count: [33m1[39m
   - pendingOrder items: 1x Kosmiczne Jaja Double
   - total: 46.00 zÅ‚
   - items details: [
  {
    "id": "6201f101-584a-431b-ad84-253aa5640cc3",
    "name": "Kosmiczne Jaja Double",
    "price": 46,
    "quantity": 1
  }
]
â³ Waiting for user confirmation (expecting "tak", "dodaj", etc.)
âš ï¸ Skipping LLM reply generation (test mode or no key), using replyCore
âœ… Final response: intent=create_order, confidence=0.9, fallback=false
ðŸ“¦ Final Response Preparation: MenuItems count = 6

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowaÄ‡ "burgera Vegas" do "Smak Vegas"[22m[39m
[brainRouter] ðŸš€ Handler called

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowaÄ‡ "burgera Vegas" do "Smak Vegas"[22m[39m
ðŸ§  [DEBUG] Handler called with: {
  sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m,
  text: [32m'PoproszÄ™ burgera Vegas'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m,
    text: [32m'PoproszÄ™ burgera Vegas'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m22[39m
}
ðŸ§  [DEBUG] Current session state: {
  sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m,
  session: {
    expectedContext: [32m'confirm_order'[39m,
    lastIntent: [32m'create_order'[39m,
    lastRestaurant: {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary Å›lÄ…skie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ÅšlÄ…skie'[39m,
    lastUpdated: [33m1766043913169[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ],
    pendingOrder: { restaurant: [36m[Object][39m, items: [36m[Array][39m, total: [33m46[39m }
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'confirm_order'[39m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Klaps Burgers'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ÅšlÄ…skie'[39m,
  hasPendingOrder: [33mtrue[39m,
  lastIntent: [32m'create_order'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m,
    [32m'pendingOrder'[39m
  ]
}
ðŸ§­ GeoContext Layer activated for: "Vegas"

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowaÄ‡ "burgera Vegas" do "Smak Vegas"[22m[39m
âš™ï¸ GeoContext: brak wynikÃ³w w "Vegas"
âš™ï¸ GeoContext: brak wynikÃ³w w "Vegas" â€” kontynuuj normalny flow

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowaÄ‡ "burgera Vegas" do "Smak Vegas"[22m[39m
[brainRouter] ðŸ§  Calling detectIntent with: {
  text: [32m'PoproszÄ™ burgera Vegas'[39m,
  sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m
}
[brainRouter] ðŸ§  Current session: {
  expectedContext: [32m'confirm_order'[39m,
  lastIntent: [32m'create_order'[39m,
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary Å›lÄ…skie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043909942[39m }
  },
  last_location: [32m'Piekary ÅšlÄ…skie'[39m,
  lastUpdated: [33m1766043913169[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'MiÄ™dzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'AmerykaÅ„ska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. KsiÄ™dza Piotra Skargi 3'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'DwÃ³r Hubertus'[39m,
      address: [32m'ul. InwalidÃ³w Wojennych 72'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'ÅšlÄ…ska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. StanisÅ‚awa Maczka 22'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'a1a67286-2aaf-4cb7-ae05-50573652391c'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Double'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 400g, ser cheddar, saÅ‚ata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m46[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'009797c9-808b-4b8a-89b4-79d8d9ece27a'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Standard'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 200g, ser cheddar, saÅ‚ata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m36[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'fecf6c54-17f4-4bb6-8a50-6a5944a11728'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'GÅ‚odzilla'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, 100% woÅ‚owina 200g, grillowany boczek, ser camembert, nachos, papryka, saÅ‚ata rzymska, czerwona cebula, sos mango, czosnek'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m59[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'108af5f7-ea9e-46f2-8d06-d7837e181dce'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Grzybiarz z Piekaryhill'[39m,
      description: [32m'BuÅ‚ka, woÅ‚owina, boczek, majonez, saÅ‚ata, marynowana cebula, ser cheddar, grzyby, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m40[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'b5bde246-f3e9-4854-8bcf-c60787647ca0'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Double'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 400g, ser cheddar, grillowana dynia w pomaraÅ„czy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m49[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'c6b011fa-882d-4894-a84f-9a41acae5dbc'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Standard'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 200g, ser cheddar, grillowana dynia w pomaraÅ„czy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m39[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    }
  ],
  pendingOrder: {
    restaurant: {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      city: [90mundefined[39m
    },
    items: [ [36m[Object][39m ],
    total: [33m46[39m
  }
}
ðŸ”¬ Starting Smart Intent Layer...
[intent-router] ðŸš€ detectIntent called with: { text: [32m'PoproszÄ™ burgera Vegas'[39m, sessionId: [90mundefined[39m }
[intent-router] ðŸ” Starting early dish detection for text: PoproszÄ™ burgera Vegas
[intent-router] ðŸ” Normalized text: poproszÄ™ burgera vegas
[intent-router] ðŸ” Session restaurant: NONE
[intent-router] ðŸ” Restaurant indicators in text: false
[intent-router] ðŸ” Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowaÄ‡ "burgera Vegas" do "Smak Vegas"[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowaÄ‡ "burgera Vegas" do "Smak Vegas"[22m[39m
[intent-router] ðŸ” Checking 9 restaurants for fuzzy match
[intent-router] ðŸª Restaurant detected in text (fuzzy): Klaps Burgers (matched: 1/2)
[loadMenuCatalog] ðŸ” Session: {
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
}
[loadMenuCatalog] ðŸ” lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[loadMenuCatalog] ðŸ” lastId: 569a7d29-57be-4224-bdf3-09c483415cea
[loadMenuCatalog] âœ… Loading menu for restaurant: 569a7d29-57be-4224-bdf3-09c483415cea (Klaps Burgers)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowaÄ‡ "burgera Vegas" do "Smak Vegas"[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowaÄ‡ "burgera Vegas" do "Smak Vegas"[22m[39m
[loadMenuCatalog] âœ… Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] âœ… Sample items: Kosmiczne Jaja Double, Wegetrix Double, Å»wirek i Muchomorek Standard
[intent-router] Catalog loaded: 21 items
[intent-router] ðŸ” Calling parseOrderItems...
[intent-router] ðŸ” Catalog items: Kosmiczne Jaja Double, Wegetrix Double, Å»wirek i Muchomorek Standard, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, GÅ‚odzilla, Kosmiczne Jaja Standard
[parseOrderItems] ðŸ“Š Summary:
  - requestedNames: [burger]
  - availableNames: [smak vegas]
  - unavailableNames: [burger]
  - matched.length: 1
  - clarifications.length: 0
[intent-router] âœ… Parsed result: {
  "any": true,
  "groups": [
    {
      "restaurant_id": "569a7d29-57be-4224-bdf3-09c483415cea",
      "restaurant_name": "Klaps Burgers",
      "items": [
        {
          "menuItemId": "c77f76fe-f77d-4a91-858e-4ec34d8d2110",
          "name": "Smak Vegas",
          "price": 36,
          "quantity": 1
        }
      ]
    }
  ],
  "clarify": [],
  "available": [
    {
      "menuItemId": "c77f76fe-f77d-4a91-858e-4ec34d8d2110",
      "name": "Smak Vegas",
      "price": 36,
      "quantity": 1,
      "restaurant_id": "569a7d29-57be-4224-bdf3-09c483415cea",
      "restaurant_name": "Klaps Burgers",
      "matchScore": 1
    }
  ],
  "unavailable": [
    "burger"
  ],
  "needsClarification": true,
  "unknownItems": []
}
[intent-router] ðŸ” parsed.any = true
[intent-router] ðŸ” parsed.groups.length = 1
ðŸ” Debug session updated: {
  intent: [32m'create_order'[39m,
  restaurant: [32m'Klaps Burgers'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.82[39m
}
âœ… SmartIntent Resolved: create_order (0.00) via classic
ðŸ§  [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'create_order'[39m,
  ruleConfidence: [33m0[39m,
  llmIntent: [1mnull[22m,
  llmConfidence: [33m0[39m,
  finalIntent: [32m'create_order'[39m,
  finalConfidence: [33m0[39m,
  source: [32m'classic'[39m,
  hasRestaurant: [33mfalse[39m,
  restaurantName: [90mundefined[39m,
  hasParsedOrder: [33mtrue[39m,
  parsedOrderDetails: { any: [33mtrue[39m, groupsCount: [33m1[39m, groups: [ [36m[Object][39m ] }
}
ðŸ”’ SmartContext: skipping boost (parsedOrder exists)
ðŸ“‹ Parsed: { dish: [32m'burgera Vegas'[39m, restaurant: [1mnull[22m }
ðŸ§  create_order intent detected
âœ… Using parsedOrder from detectIntent()

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowaÄ‡ "burgera Vegas" do "Smak Vegas"[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowaÄ‡ "burgera Vegas" do "Smak Vegas"[22m[39m
âœ… Matched restaurant: "Klaps Burgers" â†’ Klaps Burgers

POST /api/brain 200 14127 - 1084.382 ms
[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowaÄ‡ "burgera Vegas" do "Smak Vegas"[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowaÄ‡ "burgera Vegas" do "Smak Vegas"[22m[39m
ðŸ” [create_order] Loaded 21 items for validation
ðŸ§  Saved/merged pending order to session: {
  items: [
    {
      id: [32m'c77f76fe-f77d-4a91-858e-4ec34d8d2110'[39m,
      name: [32m'Smak Vegas'[39m,
      price_pln: [33m36[39m,
      qty: [33m1[39m
    }
  ],
  restaurant: [32m'Klaps Burgers'[39m,
  restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
  total: [32m'36.00'[39m
}
âœ… Pending order saved to session:
   - expectedContext: confirm_order
   - pendingOrder items count: [33m1[39m
   - pendingOrder items: 1x Smak Vegas
   - total: 36.00 zÅ‚
   - items details: [
  {
    "id": "c77f76fe-f77d-4a91-858e-4ec34d8d2110",
    "name": "Smak Vegas",
    "price": 36,
    "quantity": 1
  }
]
â³ Waiting for user confirmation (expecting "tak", "dodaj", etc.)
âš ï¸ Skipping LLM reply generation (test mode or no key), using replyCore
âœ… Final response: intent=create_order, confidence=0.9, fallback=false
ðŸ“¦ Final Response Preparation: MenuItems count = 6

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (napÃ³j): powinien dodaÄ‡ napÃ³j do zamÃ³wienia (np. Pepsi)[22m[39m
[brainRouter] ðŸš€ Handler called

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (napÃ³j): powinien dodaÄ‡ napÃ³j do zamÃ³wienia (np. Pepsi)[22m[39m
ðŸ§  [DEBUG] Handler called with: {
  sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m,
  text: [32m'PoproszÄ™ dwie pepsi'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m,
    text: [32m'PoproszÄ™ dwie pepsi'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m19[39m
}
ðŸ§  [DEBUG] Current session state: {
  sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m,
  session: {
    expectedContext: [32m'confirm_order'[39m,
    lastIntent: [32m'create_order'[39m,
    lastRestaurant: {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary Å›lÄ…skie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ÅšlÄ…skie'[39m,
    lastUpdated: [33m1766043914167[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ],
    pendingOrder: { restaurant: [36m[Object][39m, items: [36m[Array][39m, total: [33m36[39m }
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'confirm_order'[39m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Klaps Burgers'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ÅšlÄ…skie'[39m,
  hasPendingOrder: [33mtrue[39m,
  lastIntent: [32m'create_order'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m,
    [32m'pendingOrder'[39m
  ]
}
ðŸ§­ GeoContext Layer activated for: "Poprosz"

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (napÃ³j): powinien dodaÄ‡ napÃ³j do zamÃ³wienia (np. Pepsi)[22m[39m
âš™ï¸ GeoContext: brak wynikÃ³w w "Poprosz"
âš™ï¸ GeoContext: brak wynikÃ³w w "Poprosz" â€” kontynuuj normalny flow

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (napÃ³j): powinien dodaÄ‡ napÃ³j do zamÃ³wienia (np. Pepsi)[22m[39m
[brainRouter] ðŸ§  Calling detectIntent with: {
  text: [32m'PoproszÄ™ dwie pepsi'[39m,
  sessionId: [32m'e2e_klaps_cascade_1766043909836'[39m
}
[brainRouter] ðŸ§  Current session: {
  expectedContext: [32m'confirm_order'[39m,
  lastIntent: [32m'create_order'[39m,
  lastRestaurant: {
    id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
    name: [32m'Klaps Burgers'[39m,
    address: [32m'ul. Piotra Skargi 15'[39m,
    city: [32m'Piekary ÅšlÄ…skie'[39m,
    lat: [33m50.38643[39m,
    lng: [33m18.95422[39m
  },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary Å›lÄ…skie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043909942[39m }
  },
  last_location: [32m'Piekary ÅšlÄ…skie'[39m,
  lastUpdated: [33m1766043914167[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'MiÄ™dzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'AmerykaÅ„ska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. KsiÄ™dza Piotra Skargi 3'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'DwÃ³r Hubertus'[39m,
      address: [32m'ul. InwalidÃ³w Wojennych 72'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'ÅšlÄ…ska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. StanisÅ‚awa Maczka 22'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'a1a67286-2aaf-4cb7-ae05-50573652391c'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Double'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 400g, ser cheddar, saÅ‚ata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m46[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'009797c9-808b-4b8a-89b4-79d8d9ece27a'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Standard'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 200g, ser cheddar, saÅ‚ata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m36[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'fecf6c54-17f4-4bb6-8a50-6a5944a11728'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'GÅ‚odzilla'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, 100% woÅ‚owina 200g, grillowany boczek, ser camembert, nachos, papryka, saÅ‚ata rzymska, czerwona cebula, sos mango, czosnek'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m59[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'108af5f7-ea9e-46f2-8d06-d7837e181dce'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Grzybiarz z Piekaryhill'[39m,
      description: [32m'BuÅ‚ka, woÅ‚owina, boczek, majonez, saÅ‚ata, marynowana cebula, ser cheddar, grzyby, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m40[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'b5bde246-f3e9-4854-8bcf-c60787647ca0'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Double'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 400g, ser cheddar, grillowana dynia w pomaraÅ„czy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m49[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'c6b011fa-882d-4894-a84f-9a41acae5dbc'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Standard'[39m,
      description: [32m'BuÅ‚ka maÅ›lana, woÅ‚owina 200g, ser cheddar, grillowana dynia w pomaraÅ„czy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'miÄ™sne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m39[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    }
  ],
  pendingOrder: {
    restaurant: {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      city: [32m'Piekary ÅšlÄ…skie'[39m
    },
    items: [ [36m[Object][39m ],
    total: [33m36[39m
  }
}
ðŸ”¬ Starting Smart Intent Layer...
[intent-router] ðŸš€ detectIntent called with: { text: [32m'PoproszÄ™ dwie pepsi'[39m, sessionId: [90mundefined[39m }
[intent-router] ðŸ” Starting early dish detection for text: PoproszÄ™ dwie pepsi
[intent-router] ðŸ” Normalized text: poproszÄ™ dwie pepsi
[intent-router] ðŸ” Session restaurant: NONE
[intent-router] ðŸ” Restaurant indicators in text: false
[intent-router] ðŸ” Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (napÃ³j): powinien dodaÄ‡ napÃ³j do zamÃ³wienia (np. Pepsi)[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (napÃ³j): powinien dodaÄ‡ napÃ³j do zamÃ³wienia (np. Pepsi)[22m[39m
[intent-router] ðŸ” Checking 9 restaurants for fuzzy match
[loadMenuCatalog] ðŸ” Session: default
[loadMenuCatalog] ðŸ” lastRestaurant: [90mundefined[39m
[loadMenuCatalog] ðŸ” lastId: [90mundefined[39m
[loadMenuCatalog] âš ï¸ Loading all menu items (no restaurant in session)

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (napÃ³j): powinien dodaÄ‡ napÃ³j do zamÃ³wienia (np. Pepsi)[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (napÃ³j): powinien dodaÄ‡ napÃ³j do zamÃ³wienia (np. Pepsi)[22m[39m
[loadMenuCatalog] âœ… Loaded 246 menu items from 9 restaurants
[loadMenuCatalog] âœ… Sample items: Pizza Å unkovÃ¡, Pizza Ekkluzivne, Pizza LÃ¡ska NebeskÃ¡
[intent-router] Catalog loaded: 246 items
[intent-router] ðŸ” Calling parseOrderItems...
[intent-router] ðŸ” Catalog items: Pizza Å unkovÃ¡, Pizza Ekkluzivne, Pizza LÃ¡ska NebeskÃ¡, Rumcajsowy Burger, Golonka confit, SaÅ‚atka z halloumi, Zupa pomidorowa, Kofola klasyczna, Hawajska, Coca-Cola, Coca-Cola Zero, Fanta PomaraÅ„czowa, Sprite, Coca-Cola, Fanta, Piwo Tyskie, Pizza Margherita 33cm, Pizza Pepperoni 33cm, Pizza Hawajska 33cm, Pizza Capricciosa 33cm, Pizza Vege 33cm, Bacon Burger, Better Than Drwal - WoÅ‚owina, Cheddar Burger, Vege Burger, Spicy Burger, Bowl Gyros-Halloumi, Bowl z DyniÄ…, Bowl Kurczak Zapiekany z Serem, Filet Grillowany, Pulled Pork Bowl Pikantny, Zapiekaniec, Cappy JabÅ‚ko, Krem z Cebuli i Czosnku, SaÅ‚atka Cezar Callzone, SaÅ‚atka Grillowany Kurczak, SaÅ‚atka Halloumi, SaÅ‚atka z Serem Camembert, SaÅ‚atka z Serem Feta, SaÅ‚atka z DyniÄ…, Szarlotka, Sernik z Musem Malinowym, Ciasto Marchewkowe, Pepsi 0.85L, Kawa Czarna, Kawa BiaÅ‚a, Flat White, Cappuccino, Latte, Sos Tzatziki, Sos Pikantny, Sos Jogurtowy, GÄ™sie Å¼oÅ‚Ä…dki, Camembert z Å¼urawinÄ…, Deska zakÄ…sek dla dwojga, Wodzionka, Å»ur Å›lÄ…ski w chlebie, Å»ur Å›lÄ…ski na talerzu, Krem borowikowy, Zupa pomidorowa, Barszcz z tortellini, Flaki z indyka, Burger woÅ‚owy z frytkami i surÃ³wkÄ…, Burger wegetariaÅ„ski z Camembertem, frytkami oraz zestawem surÃ³wek, Gyros z frytkami i tzatziki, Å»eberka wieprzowe z frytkami, Kotlety czopskie, Dzikie placki, WÄ…trÃ³bka drobiowa, Grillowany filet z kurczaka, Kurczak po parysku, Ä†wiartka kaczki, Rolada wieprzowa, Kotlet schabowy, PolÄ™dwica wieprzowa, Kotlet po szwajcarsku, Rolada woÅ‚owa, OzÃ³r woÅ‚owy, Miruna w panierce, Zupa z kaczki, Zupa Won Ton, Tagliatelle ze szpinakiem, suszonymi pomidorami i pÅ‚atkami migdaÅ‚Ã³w, RosÃ³Å‚ z makaronem, NaleÅ›niki z serem na sÅ‚odko z bitÄ… Å›mietanÄ…, Carbonara a'la Hubertus, Filet z Å‚ososia na szpinaku, Stek z halibuta smaÅ¼ony na maÅ›le, PstrÄ…g na zioÅ‚owo, Pierogi z miÄ™sem, Pierogi ruskie, Kluski z sosem pieczeniowym, SaÅ‚atka Hubertusa z pieczywem czosnkowym, SaÅ‚atka grecka z pieczywem czosnkowym, Kluski Å›lÄ…skie, Ziemniaki z wody, Bratkartoffel, Kapusta modra, Kapusta zasmaÅ¼ana, Nuggetsy z frytkami oraz surÃ³wkÄ… z marchewki, Cappy PomaraÅ„cza, Woda Mineralna, Tiramisu, Panna Cotta, Brownie, Lody waniliowe z sosem karmelowym, Kosmiczne Jaja Double, Wegetrix Double, Å»wirek i Muchomorek Standard, Zupa krabowa, Sajgonki 3 szt., Sajgonki z ryÅ¼em, Sajgonki z surÃ³wkÄ…, Sajgonki z ryÅ¼em i surÃ³wkÄ…, Pierogi Ho Cao z ryÅ¼em i surÃ³wkÄ…, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Krem z dyni z biaÅ‚Ä… czekoladÄ…, Siekany tatar z polÄ™dwicy woÅ‚owej, WÄ™dzony pstrÄ…g, Carpaccio z kaczki marynowanej w grzaÅ„cu, BUFFAL, Kartacze z dzikiem, SaÅ‚atka z dyniÄ… marynowanÄ… w musztardzie, Grzanka z krupniokiem, Tagliatelle z krewetkami, Makaron ryÅ¼owy z warzywami, Zupa dnia, RosÃ³Å‚ z makaronem, Tradycyjny schabowy, Schab po beskidzku, NaleÅ›nik z kurczakiem i warzywami, NaleÅ›nik ze szpinakiem i serem feta, Lody z gorÄ…cymi malinami i bitÄ… Å›mietanÄ…, Fondant czekoladowy z lodami i bitÄ… Å›mietanÄ…, Coca-Cola, Fanta, Sprite, Cappy (200 ml), Woda mineralna (330 ml), Filet z kurczaka tradycyjny (panierowany), Filet z kurczaka po hawajsku, Grillowany filet z kurczaka, Kroket (z kapustÄ… i grzybami/bÄ…dÅº z miÄ™sem) 1 szt., Placki ziemniaczane 4 szt., Kluski Å›lÄ…skie 7 szt., Rolada woÅ‚owa (na zamÃ³wienie), PieczeÅ„ wieprzowa, WÄ…trÃ³bka drobiowa, Gulasz wieprzowy po wÄ™giersku, Pierogi (ruskie lub z miÄ™sem) 6 szt., Jajecznica z 2 szt. jaj, Placki po wÄ™giersku z gulaszem wieprzowym, NaleÅ›nik z dÅ¼emem truskawkowym lub wiÅ›niowym, NaleÅ›nik z nutellÄ…, bananami, bitÄ… Å›mietanÄ…, Margherita, Capricciosa, Diavola, Quattro Formaggi, Vegetariana, Prosciutto e Funghi, Salami, Pollo, Spinaci, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, GÅ‚odzilla, Kosmiczne Jaja Standard, Zupa wietnamska, Zupa z kurczakiem, Zupa Å‚ajska, Pierogi SiuMai z ryÅ¼em i surÃ³wkÄ…, Kurczak z warzywami, Kurczak sÅ‚odko-kwaÅ›ny, Kurczak pikantny, Kurczak po chiÅ„sku, Kurczak po tajsku, Kurczak na gorÄ…cym pÃ³Å‚misku, Kurczak w cieÅ›cie sÅ‚odko-kwaÅ›ny, Kurczak w cieÅ›cie pikantny, Kurczak w cieÅ›cie curry, Kurczak w cieÅ›cie piÄ™ciu smakÃ³w, Wieprzowina z warzywami, Wieprzowina sÅ‚odko-kwaÅ›na, Wieprzowina pikantna, Wieprzowina Curry, Wieprzowina piÄ™ciu smakÃ³w, Wieprzowina po tajsku, WoÅ‚owina z warzywami, WoÅ‚owina pikantna, WoÅ‚owina Curry, WoÅ‚owina 5 smakÃ³w, WoÅ‚owina po tajsku, WoÅ‚owina na gorÄ…cym pÃ³Å‚misku, Kaczka z warzywami, Kaczka pikantna, Kaczka sÅ‚odko-kwaÅ›na, Kaczka po chiÅ„sku, Kaczka po tajsku, Kaczka na gorÄ…cym pÃ³Å‚misku, Krewetki z warzywami, Krewetki pikantne, Krewetki Curry, Krewetki po tajsku, Krewetki na gorÄ…cym pÃ³Å‚misku, Kalmary chrupiÄ…ce sÅ‚odko-kwaÅ›ne, Kalmary chrupiÄ…ce pikantne, Kalmary chrupiÄ…ce Curry, Kalmary chrupiÄ…ce w piÄ™ciu smakach, Kalmary po tajsku, Kalmary na gorÄ…cym pÃ³Å‚misku, Pita Rollo, Pita Rollo z serem, Pita Rollo same miÄ™so, Tortilla kebab, Tortilla kebab z serem, Kebab amerykaÅ„ski, Kebab box, Kebab box z serem, Nuggets box, Kebab talerz, Kebab w buÅ‚ce, Falafel, Frytki z serem, Frytki z Indii masala, SaÅ‚atka grecka, Sos, Baklava, Sok Cappy, Coca-Cola 0,85l, Coca-Cola 0,5l, Coca-Cola 0,3l, Pepsi / Mirinda / 7up, Monster Energy Drink, Ayran Turecki, Mango Sok, Oshee, Burn
[parseOrderItems] ðŸ“Š Summary:
  - requestedNames: []
  - availableNames: []
  - unavailableNames: []
  - matched.length: 0
  - clarifications.length: 0
[intent-router] âœ… Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [],
  "needsClarification": false,
  "unknownItems": []
}
[intent-router] ðŸ” parsed.any = false
[intent-router] ðŸ” parsed.groups.length = 0
[intent-router] âŒ No dishes matched in catalog (parsed.any = false)
[intent-router] âŒ Continuing to KROK 4 (targetRestaurant check)...

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (napÃ³j): powinien dodaÄ‡ napÃ³j do zamÃ³wienia (np. Pepsi)[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (napÃ³j): powinien dodaÄ‡ napÃ³j do zamÃ³wienia (np. Pepsi)[22m[39m
[intent-router] ðŸ” KROK 4: Checking targetRestaurant: [1mnull[22m
[intent-router] âŒ No targetRestaurant found, continuing to keyword detection
ðŸ” PRIORYTET 1: Sprawdzam restauracje w tekÅ›cie: PoproszÄ™ dwie pepsi
ðŸ” Znaleziono restauracji: [33m9[39m

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (napÃ³j): powinien dodaÄ‡ napÃ³j do zamÃ³wienia (np. Pepsi)[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (napÃ³j): powinien dodaÄ‡ napÃ³j do zamÃ³wienia (np. Pepsi)[22m[39m
ðŸ” Normalizowany tekst: poprosze dwie pepsi
ðŸ” Sprawdzam restauracjÄ™: Restauracja Stara Kamienica -> restauracja stara kamienica
ðŸ” Fuzzy match - name words: [ [32m'restauracja'[39m, [32m'stara'[39m, [32m'kamienica'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
ðŸ” Comparing: poprosze vs restauracja distance: [33m10[39m
ðŸ” Comparing: dwie vs restauracja distance: [33m11[39m
ðŸ” Comparing: pepsi vs restauracja distance: [33m10[39m
ðŸ” Comparing: poprosze vs stara distance: [33m7[39m
ðŸ” Comparing: dwie vs stara distance: [33m5[39m
ðŸ” Comparing: pepsi vs stara distance: [33m5[39m
ðŸ” Comparing: poprosze vs kamienica distance: [33m9[39m
ðŸ” Comparing: dwie vs kamienica distance: [33m7[39m
ðŸ” Comparing: pepsi vs kamienica distance: [33m8[39m
ðŸ” Matched words: [33m0[39m out of [33m3[39m threshold: [33m2[39m
ðŸ” Sprawdzam restauracjÄ™: Rezydencja Luxury Hotel -> rezydencja luxury hotel
ðŸ” Fuzzy match - name words: [ [32m'rezydencja'[39m, [32m'luxury'[39m, [32m'hotel'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
ðŸ” Comparing: poprosze vs rezydencja distance: [33m10[39m
ðŸ” Comparing: dwie vs rezydencja distance: [33m9[39m
ðŸ” Comparing: pepsi vs rezydencja distance: [33m9[39m
ðŸ” Comparing: poprosze vs luxury distance: [33m8[39m
ðŸ” Comparing: dwie vs luxury distance: [33m6[39m
ðŸ” Comparing: pepsi vs luxury distance: [33m6[39m
ðŸ” Comparing: poprosze vs hotel distance: [33m7[39m
ðŸ” Comparing: dwie vs hotel distance: [33m4[39m
ðŸ” Comparing: pepsi vs hotel distance: [33m5[39m
ðŸ” Matched words: [33m0[39m out of [33m3[39m threshold: [33m2[39m
ðŸ” Sprawdzam restauracjÄ™: Klaps Burgers -> klaps burgers
ðŸ” Fuzzy match - name words: [ [32m'klaps'[39m, [32m'burgers'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
ðŸ” Comparing: poprosze vs klaps distance: [33m7[39m
ðŸ” Comparing: dwie vs klaps distance: [33m5[39m
ðŸ” Comparing: pepsi vs klaps distance: [33m4[39m
ðŸ” Comparing: poprosze vs burgers distance: [33m7[39m
ðŸ” Comparing: dwie vs burgers distance: [33m6[39m
ðŸ” Comparing: pepsi vs burgers distance: [33m6[39m
ðŸ” Matched words: [33m0[39m out of [33m2[39m threshold: [33m1[39m
ðŸ” Sprawdzam restauracjÄ™: Vien-Thien -> vien thien
ðŸ” Fuzzy match - name words: [ [32m'vien'[39m, [32m'thien'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
ðŸ” Comparing: poprosze vs vien distance: [33m8[39m
ðŸ” Comparing: dwie vs vien distance: [33m3[39m
ðŸ” Comparing: pepsi vs vien distance: [33m5[39m
ðŸ” Comparing: poprosze vs thien distance: [33m8[39m
ðŸ” Comparing: dwie vs thien distance: [33m3[39m
ðŸ” Comparing: pepsi vs thien distance: [33m5[39m
ðŸ” Matched words: [33m0[39m out of [33m2[39m threshold: [33m1[39m
ðŸ” Sprawdzam restauracjÄ™: Bar Praha -> bar praha
ðŸ” Fuzzy match - name words: [ [32m'bar'[39m, [32m'praha'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
ðŸ” Comparing: poprosze vs bar distance: [33m7[39m
ðŸ” Comparing: dwie vs bar distance: [33m4[39m
ðŸ” Comparing: pepsi vs bar distance: [33m5[39m
ðŸ” Comparing: poprosze vs praha distance: [33m6[39m
ðŸ” Comparing: dwie vs praha distance: [33m5[39m
ðŸ” Comparing: pepsi vs praha distance: [33m4[39m
ðŸ” Matched words: [33m0[39m out of [33m2[39m threshold: [33m1[39m
ðŸ” Sprawdzam restauracjÄ™: Callzone -> callzone
ðŸ” Fuzzy match - name words: [ [32m'callzone'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
ðŸ” Comparing: poprosze vs callzone distance: [33m7[39m
ðŸ” Comparing: dwie vs callzone distance: [33m7[39m
ðŸ” Comparing: pepsi vs callzone distance: [33m8[39m
ðŸ” Matched words: [33m0[39m out of [33m1[39m threshold: [33m1[39m
ðŸ” Sprawdzam restauracjÄ™: DwÃ³r Hubertus -> dwor hubertus
ðŸ” Fuzzy match - name words: [ [32m'dwor'[39m, [32m'hubertus'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
ðŸ” Comparing: poprosze vs dwor distance: [33m7[39m
ðŸ” Comparing: dwie vs dwor distance: [33m2[39m
ðŸ” Comparing: pepsi vs dwor distance: [33m5[39m
ðŸ” Comparing: poprosze vs hubertus distance: [33m8[39m
ðŸ” Comparing: dwie vs hubertus distance: [33m7[39m
ðŸ” Comparing: pepsi vs hubertus distance: [33m7[39m
ðŸ” Matched words: [33m0[39m out of [33m2[39m threshold: [33m1[39m
ðŸ” Sprawdzam restauracjÄ™: Tasty King Kebab -> tasty king kebab
ðŸ” Fuzzy match - name words: [ [32m'tasty'[39m, [32m'king'[39m, [32m'kebab'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
ðŸ” Comparing: poprosze vs tasty distance: [33m7[39m
ðŸ” Comparing: dwie vs tasty distance: [33m5[39m
ðŸ” Comparing: pepsi vs tasty distance: [33m5[39m
ðŸ” Comparing: poprosze vs king distance: [33m8[39m
ðŸ” Comparing: dwie vs king distance: [33m4[39m
ðŸ” Comparing: pepsi vs king distance: [33m5[39m
ðŸ” Comparing: poprosze vs kebab distance: [33m8[39m
ðŸ” Comparing: dwie vs kebab distance: [33m5[39m
ðŸ” Comparing: pepsi vs kebab distance: [33m4[39m
ðŸ” Matched words: [33m0[39m out of [33m3[39m threshold: [33m2[39m
ðŸ” Sprawdzam restauracjÄ™: Pizzeria Monte Carlo -> pizzeria monte carlo
ðŸ” Fuzzy match - name words: [ [32m'pizzeria'[39m, [32m'monte'[39m, [32m'carlo'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
ðŸ” Comparing: poprosze vs pizzeria distance: [33m7[39m
ðŸ” Comparing: dwie vs pizzeria distance: [33m7[39m
ðŸ” Comparing: pepsi vs pizzeria distance: [33m6[39m
ðŸ” Comparing: poprosze vs monte distance: [33m6[39m
ðŸ” Comparing: dwie vs monte distance: [33m4[39m
ðŸ” Comparing: pepsi vs monte distance: [33m5[39m
ðŸ” Comparing: poprosze vs carlo distance: [33m7[39m
ðŸ” Comparing: dwie vs carlo distance: [33m5[39m
ðŸ” Comparing: pepsi vs carlo distance: [33m5[39m
ðŸ” Matched words: [33m0[39m out of [33m3[39m threshold: [33m2[39m
ðŸ” Debug session updated: {
  intent: [32m'create_order'[39m,
  restaurant: [1mnull[22m,
  sessionId: [1mnull[22m,
  confidence: [33m0.8[39m
}
âœ… SmartIntent Resolved: create_order (0.00) via classic
ðŸ§  [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'create_order'[39m,
  ruleConfidence: [33m0[39m,
  llmIntent: [1mnull[22m,
  llmConfidence: [33m0[39m,
  finalIntent: [32m'create_order'[39m,
  finalConfidence: [33m0[39m,
  source: [32m'classic'[39m,
  hasRestaurant: [33mfalse[39m,
  restaurantName: [90mundefined[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
ðŸ§  [DEBUG] Calling boostIntent with: {
  text: [32m'PoproszÄ™ dwie pepsi'[39m,
  hybridIntent: [32m'create_order'[39m,
  confidence: [33m0[39m,
  session: {
    expectedContext: [32m'confirm_order'[39m,
    lastRestaurant: [32m'Klaps Burgers'[39m,
    lastIntent: [32m'create_order'[39m
  }
}
â„¹ï¸ boostIntent: Skipping boost, already detected order intent: create_order
ðŸ§  [DEBUG] boostIntent result: {
  originalIntent: [32m'create_order'[39m,
  boostedIntent: [32m'create_order'[39m,
  isContextLocked: [33mfalse[39m
}
ðŸ“‹ Parsed: { dish: [32m'pepsi'[39m, restaurant: [1mnull[22m }
ðŸ§  create_order intent detected
ðŸ›’ Parsing order items from: "PoproszÄ™ dwie pepsi" with 2-Phase Parsing

POST /api/brain 200 14099 - 1180.497 ms
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (napÃ³j): powinien dodaÄ‡ napÃ³j do zamÃ³wienia (np. Pepsi)[22m[39m
âš ï¸ Parsed dish "pepsi" but not found in menu. Returning unknown_item.
âœ… Parsed order: [
  {
    id: [32m'unknown_item'[39m,
    name: [32m'pepsi'[39m,
    price: [33m0[39m,
    quantity: [33m2[39m,
    isUnknown: [33mtrue[39m
  }
]
âœ… Pending order saved to session (fallback path):
   - expectedContext: confirm_order
   - pendingOrder items count: [33m1[39m
   - pendingOrder items: 2x pepsi
   - total: 0.00 zÅ‚
   - items details: [
  {
    "id": "unknown_item",
    "name": "pepsi",
    "price": 0,
    "quantity": 2,
    "isUnknown": true
  }
]
â³ Waiting for user confirmation (expecting "tak", "dodaj", etc.)
âš ï¸ Skipping LLM reply generation (test mode or no key), using replyCore
âœ… Final response: intent=create_order, confidence=0.9, fallback=false
ðŸ“¦ Final Response Preparation: MenuItems count = 6

[90mstderr[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (napÃ³j): powinien dodaÄ‡ napÃ³j do zamÃ³wienia (np. Pepsi)[22m[39m
âš ï¸ No match for dish: "pepsi"

 [33mâ¯[39m api/brain/tests/brainRouter.e2e.test.js [2m ([22m[2m10 tests[22m [2m|[22m [31m1 failed[39m[2m)[22m[33m 21956[2mms[22m[39m
[31m   [33mâ¯[31m api/brain/tests/brainRouter.e2e.test.js[2m > [22mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers[39m
[31m     â†’ expected 'select_restaurant' to be 'create_order' // Object.is equality[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1m[7m Failed Tests 1 [27m[22mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[31m[1m[7m FAIL [27m[22m[39m api/brain/tests/brainRouter.e2e.test.js[2m > [22mðŸ§  BrainRouter E2E - Restaurant & Menu Flow[2m > [22mC. Intent create_order (ZÅ‚oÅ¼enie zamÃ³wienia)[2m > [22mpowinien dodaÄ‡ burgery do zamÃ³wienia w Klaps Burgers
[31m[1mAssertionError[22m: expected 'select_restaurant' to be 'create_order' // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- create_order[39m
[31m+ select_restaurant[39m

[36m [2mâ¯[22m api/brain/tests/brainRouter.e2e.test.js:[2m145:37[22m[39m
    [90m143| [39m            [34mexpect[39m(res[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m144| [39m            [34mexpect[39m(res[33m.[39mbody[33m.[39mok)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m145| [39m            [34mexpect[39m(res[33m.[39mbody[33m.[39mintent)[33m.[39m[34mtoBe[39m([32m'create_order'[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m146| [39m            [34mexpect[39m(res[33m.[39mbody[33m.[39mreply)[33m.[39m[34mtoMatch[39m([36m/dodaÅ‚am|burgery|2|dwa/i[39m)[33m;[39m
    [90m147| [39m        })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/1]âŽ¯[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m9 passed[39m[22m[90m (10)[39m
[2m   Start at [22m 08:44:52
[2m   Duration [22m 23.10s[2m (transform 255ms, setup 0ms, collect 570ms, tests 21.96s, environment 0ms, prepare 220ms)[22m

