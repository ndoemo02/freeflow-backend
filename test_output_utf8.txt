
> freeflow-backend@1.4.2 test:brain:e2e
> vitest run api/brain/tests/brainRouter.e2e.test.js


[7m[1m[36m RUN [39m[22m[27m [36mv1.6.1[39m [90mC:/Freeflow (Cursor vers. GITHUB)/freeflow-backend[39m

[90mstdout[2m | api\server-vercel.js:39:9[22m[39m
­čÜÇ Booting FreeFlow Serverless...

[90mstdout[2m | api\server-vercel.js:40:9[22m[39m
­čžá ENV OK

[90mstdout[2m | api\server-vercel.js:41:9[22m[39m
­čöĹ SUPABASE_URL: Ôťů

[90mstdout[2m | api\server-vercel.js:42:9[22m[39m
­čöĹ OPENAI_API_KEY: Ôťů

[90mstdout[2m | Server.<anonymous> (C:\Freeflow (Cursor vers. GITHUB)\freeflow-backend\api\server-vercel.js:530:13)[22m[39m
­čžá FreeFlow Brain running locally on http://localhost:3000

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mA. Intent find_nearby (Znajdowanie restauracji)[2m > [22m[2mpowinien znale┼║─ç restauracje w Piekarach ┼Ül─ůskich[22m[39m
Ôťů Supabase client initialized (singleton mode)

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mA. Intent find_nearby (Znajdowanie restauracji)[2m > [22m[2mpowinien znale┼║─ç restauracje w Piekarach ┼Ül─ůskich[22m[39m
[brainRouter] ­čÜÇ Handler called
[Supabase] Creating client with URL: https://ezemaacyyvbpjlagchds.supabase.co

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mA. Intent find_nearby (Znajdowanie restauracji)[2m > [22m[2mpowinien znale┼║─ç restauracje w Piekarach ┼Ül─ůskich[22m[39m
­čžá [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  text: [32m'Znajd┼║ restauracj─Ö w Piekarach ┼Ül─ůskich'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043135688'[39m,
    text: [32m'Znajd┼║ restauracj─Ö w Piekarach ┼Ül─ůskich'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m39[39m
}
­čžá [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  session: {
    expectedContext: [32m'neutral'[39m,
    lastIntent: [1mnull[22m,
    lastRestaurant: [1mnull[22m,
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: []
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'neutral'[39m,
  hasLastRestaurant: [33mfalse[39m,
  lastRestaurantName: [90mundefined[39m,
  hasLastLocation: [33mfalse[39m,
  lastLocation: [90mundefined[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [1mnull[22m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m
  ]
}
­čžş GeoContext Layer activated for: "Piekary ┼Ül─ůskie"

POST /api/brain 200 5715 - 1356.997 ms
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mA. Intent find_nearby (Znajdowanie restauracji)[2m > [22m[2mpowinien znale┼║─ç restauracje w Piekarach ┼Ül─ůskich[22m[39m
­čŚ║´ŞĆ Found 9 restaurants in "Piekary ┼Ül─ůskie"
­čĺż Cache SAVED for location: "Piekary ┼Ül─ůskie"
­čÜÇ GeoContext: Direct request detected -> Skipping confirmation

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mA. Intent find_nearby (Znajdowanie restauracji)[2m > [22m[2mpowinien obs┼éu┼╝y─ç zapytanie "Poka┼╝ restauracje w Piekarach ┼Ül─ůskich"[22m[39m
[brainRouter] ­čÜÇ Handler called

 [32mÔťô[39m api/brain/tests/brainRouter.e2e.test.js[2m > [22m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22mA. Intent find_nearby (Znajdowanie restauracji)[2m > [22mpowinien znale┼║─ç restauracje w Piekarach ┼Ül─ůskich[33m 1387[2mms[22m[39m
POST /api/brain 200 5715 - 315.502 ms
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mA. Intent find_nearby (Znajdowanie restauracji)[2m > [22m[2mpowinien obs┼éu┼╝y─ç zapytanie "Poka┼╝ restauracje w Piekarach ┼Ül─ůskich"[22m[39m
­čžá [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  text: [32m'Poka┼╝ restauracje w Piekarach ┼Ül─ůskich'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043135688'[39m,
    text: [32m'Poka┼╝ restauracje w Piekarach ┼Ül─ůskich'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m38[39m
}
­čžá [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  session: {
    expectedContext: [32m'select_restaurant'[39m,
    lastIntent: [32m'find_nearby'[39m,
    lastRestaurant: [1mnull[22m,
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary ┼Ťl─ůskie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ┼Ül─ůskie'[39m,
    lastUpdated: [33m1766043137069[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ]
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'select_restaurant'[39m,
  hasLastRestaurant: [33mfalse[39m,
  lastRestaurantName: [90mundefined[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ┼Ül─ůskie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'find_nearby'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m
  ]
}
­čžş GeoContext Layer activated for: "Piekary ┼Ül─ůskie"
­čĺż Cache HIT for location: "Piekary ┼Ül─ůskie" (age: 1s)
­čÜÇ GeoContext: Direct request detected -> Skipping confirmation

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Restauracja Stara Kamienica[22m[39m
[brainRouter] ­čÜÇ Handler called

 [32mÔťô[39m api/brain/tests/brainRouter.e2e.test.js[2m > [22m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22mA. Intent find_nearby (Znajdowanie restauracji)[2m > [22mpowinien obs┼éu┼╝y─ç zapytanie "Poka┼╝ restauracje w Piekarach ┼Ül─ůskich"[33m 322[2mms[22m[39m
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Restauracja Stara Kamienica[22m[39m
­čžá [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  text: [32m'Poka┼╝ menu Restauracja Stara Kamienica'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043135688'[39m,
    text: [32m'Poka┼╝ menu Restauracja Stara Kamienica'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m38[39m
}
­čžá [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  session: {
    expectedContext: [32m'select_restaurant'[39m,
    lastIntent: [32m'find_nearby'[39m,
    lastRestaurant: [1mnull[22m,
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary ┼Ťl─ůskie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ┼Ül─ůskie'[39m,
    lastUpdated: [33m1766043137396[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ]
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'select_restaurant'[39m,
  hasLastRestaurant: [33mfalse[39m,
  lastRestaurantName: [90mundefined[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ┼Ül─ůskie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'find_nearby'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m
  ]
}
[brainRouter] ­čžá Calling detectIntent with: {
  text: [32m'Poka┼╝ menu Restauracja Stara Kamienica'[39m,
  sessionId: [32m'e2e_piekary_1766043135688'[39m
}
[brainRouter] ­čžá Current session: {
  expectedContext: [32m'select_restaurant'[39m,
  lastIntent: [32m'find_nearby'[39m,
  lastRestaurant: [1mnull[22m,
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary ┼Ťl─ůskie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043136820[39m }
  },
  last_location: [32m'Piekary ┼Ül─ůskie'[39m,
  lastUpdated: [33m1766043137396[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Mi─Ödzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Ameryka┼äska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. Ksi─Ödza Piotra Skargi 3'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'Dw├│r Hubertus'[39m,
      address: [32m'ul. Inwalid├│w Wojennych 72'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'┼Ül─ůska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. Stanis┼éawa Maczka 22'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ]
}
­čöČ Starting Smart Intent Layer...
[intent-router] ­čÜÇ detectIntent called with: {
  text: [32m'Poka┼╝ menu Restauracja Stara Kamienica'[39m,
  sessionId: [90mundefined[39m
}
[intent-router] ­čöŹ Starting early dish detection for text: Poka┼╝ menu Restauracja Stara Kamienica
[intent-router] ­čöŹ Normalized text: poka┼╝ menu restauracja stara kamienica
[intent-router] ­čöŹ Session restaurant: NONE
[intent-router] ­čöŹ Restaurant indicators in text: true
[intent-router] ­čöŹ Searching for restaurant in text (reason: no session restaurant)

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Restauracja Stara Kamienica[22m[39m
[intent-router] ­čöŹ Checking 9 restaurants for fuzzy match
[intent-router] ­čĆ¬ Restaurant detected in text (exact): Restauracja Stara Kamienica
[loadMenuCatalog] ­čöŹ Session: {
  lastRestaurant: {
    id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
    name: [32m'Restauracja Stara Kamienica'[39m
  }
}
[loadMenuCatalog] ­čöŹ lastRestaurant: {
  id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
  name: [32m'Restauracja Stara Kamienica'[39m
}
[loadMenuCatalog] ­čöŹ lastId: 1fc1e782-bac6-47b2-978a-f6f2b38000cd
[loadMenuCatalog] Ôťů Loading menu for restaurant: 1fc1e782-bac6-47b2-978a-f6f2b38000cd (Restauracja Stara Kamienica)

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Restauracja Stara Kamienica[22m[39m
[loadMenuCatalog] Ôťů Loaded 25 menu items from 1 restaurants
[loadMenuCatalog] Ôťů Sample items: Zupa dnia, Ros├│┼é z makaronem, Tradycyjny schabowy
[intent-router] Catalog loaded: 25 items
[intent-router] ­čöŹ Calling parseOrderItems...
[intent-router] ­čöŹ Catalog items: Zupa dnia, Ros├│┼é z makaronem, Tradycyjny schabowy, Schab po beskidzku, Nale┼Ťnik z kurczakiem i warzywami, Nale┼Ťnik ze szpinakiem i serem feta, Lody z gor─ůcymi malinami i bit─ů ┼Ťmietan─ů, Fondant czekoladowy z lodami i bit─ů ┼Ťmietan─ů, Coca-Cola, Fanta, Sprite, Cappy (200 ml), Woda mineralna (330 ml), Filet z kurczaka tradycyjny (panierowany), Filet z kurczaka po hawajsku, Grillowany filet z kurczaka, Kroket (z kapust─ů i grzybami/b─ůd┼║ z mi─Ösem) 1 szt., Placki ziemniaczane 4 szt., Kluski ┼Ťl─ůskie 7 szt., Rolada wo┼éowa (na zam├│wienie), Piecze┼ä wieprzowa, W─ůtr├│bka drobiowa, Gulasz wieprzowy po w─Ögiersku, Pierogi (ruskie lub z mi─Ösem) 6 szt., Jajecznica z 2 szt. jaj, Placki po w─Ögiersku z gulaszem wieprzowym, Nale┼Ťnik z d┼╝emem truskawkowym lub wi┼Ťniowym, Nale┼Ťnik z nutell─ů, bananami, bit─ů ┼Ťmietan─ů
[parseOrderItems] ­čôŐ Summary:
  - requestedNames: []
  - availableNames: []
  - unavailableNames: []
  - matched.length: 0
  - clarifications.length: 0
[intent-router] Ôťů Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "poka┼╝ menu restauracja stara kamienica"
  ],
  "needsClarification": true,
  "unknownItems": [
    {
      "name": "poka┼╝ menu restauracja stara kamienica",
      "reason": "no_alias_match"
    }
  ]
}
[intent-router] ­čöŹ parsed.any = false
[intent-router] ­čöŹ parsed.groups.length = 0
ÔÜá´ŞĆ Unavailable items detected: poka┼╝ menu restauracja stara kamienica in tym menu
­čöŹ Checking if text contains restaurant name (using cached list): "poka┼╝ menu restauracja stara kamienica"
Ôťů Text contains restaurant name: Restauracja Stara Kamienica ÔÇö skipping clarify_order
[intent-router] ÔŁî No dishes matched in catalog (parsed.any = false)
[intent-router] ÔŁî Continuing to KROK 4 (targetRestaurant check)...

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Restauracja Stara Kamienica[22m[39m
[intent-router] ­čöŹ KROK 4: Checking targetRestaurant: {
  id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
  name: [32m'Restauracja Stara Kamienica'[39m
}
[intent-router] ­čĆ¬ KROK 4: Restaurant found in early detection: Restauracja Stara Kamienica, checking keywords...
[intent-router] ­čöŹ KROK 4: Lower text: "pokaz menu restauracja stara kamienica"
[intent-router] ­čöŹ KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'poka┼╝ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta da┼ä'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ­čöŹ KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] ÔÜá´ŞĆ KROK 4: Menu keyword found, returning menu_request
[intent-router] ÔÜá´ŞĆ KROK 4: This may override create_order from KROK 2!
­čöŹ Debug session updated: {
  intent: [32m'menu_request'[39m,
  restaurant: [32m'Restauracja Stara Kamienica'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}
Ôťů SmartIntent Resolved: menu_request (0.00) via classic
­čžá [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'menu_request'[39m,
  ruleConfidence: [33m0[39m,
  llmIntent: [1mnull[22m,
  llmConfidence: [33m0[39m,
  finalIntent: [32m'menu_request'[39m,
  finalConfidence: [33m0[39m,
  source: [32m'classic'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Restauracja Stara Kamienica'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
­čžá [DEBUG] Calling boostIntent with: {
  text: [32m'Poka┼╝ menu Restauracja Stara Kamienica'[39m,
  hybridIntent: [32m'menu_request'[39m,
  confidence: [33m0[39m,
  session: {
    expectedContext: [32m'select_restaurant'[39m,
    lastRestaurant: [90mundefined[39m,
    lastIntent: [32m'find_nearby'[39m
  }
}
­čžá [DEBUG] boostIntent result: {
  originalIntent: [32m'menu_request'[39m,
  boostedIntent: [32m'menu_request'[39m,
  isContextLocked: [33mfalse[39m
}
­čôő Parsed: { dish: [1mnull[22m, restaurant: [32m'Stara Kamienica'[39m }
­čžá menu_request intent detected

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Restauracja Stara Kamienica[22m[39m
Ôťů Matched restaurant: "Stara Kamienica" Ôćĺ Restauracja Stara Kamienica
Ôťů Restaurant set: Restauracja Stara Kamienica

POST /api/brain 200 13765 - 1136.129 ms
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Restauracja Stara Kamienica[22m[39m
Ôťů Menu loaded: 25 items (showing 6) from Restauracja Stara Kamienica
ÔÜá´ŞĆ Skipping LLM reply generation (test mode or no key), using replyCore
Ôťů Final response: intent=menu_request, confidence=0.9, fallback=false
­čôŽ Final Response Preparation: MenuItems count = 6

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Klaps Burgers[22m[39m
[brainRouter] ­čÜÇ Handler called

 [31m├Ś[39m api/brain/tests/brainRouter.e2e.test.js[2m > [22m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22mpowinien pokaza─ç menu dla Restauracja Stara Kamienica[33m 1148[2mms[22m[39m
[31m   Ôćĺ expected 'w restauracja stara kamienica dost─ÖpnÔÇŽ' to match /menu|karta|polecam|proponuj─Ö/i[39m
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Klaps Burgers[22m[39m
­čžá [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  text: [32m'Jakie jest menu w Klaps Burgers?'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043135688'[39m,
    text: [32m'Jakie jest menu w Klaps Burgers?'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m32[39m
}
­čžá [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastIntent: [32m'menu_request'[39m,
    lastRestaurant: {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary ┼Ťl─ůskie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ┼Ül─ůskie'[39m,
    lastUpdated: [33m1766043138257[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ]
  },
  hasExpectedContext: [33mfalse[39m,
  expectedContextValue: [1mnull[22m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Restauracja Stara Kamienica'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ┼Ül─ůskie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'menu_request'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m
  ]
}
­čžş GeoContext Layer activated for: "Klaps Burgers"

node.exe : [90mstderr[2m |
 api/brain/tests/brainRouter
.e2e.test.js[2m > [22m[2m
­čžá BrainRouter E2E - Resta
urant & Menu Flow[2m > [22
m[2mB. Intent menu_request 
(Menu konkretnej restauracji
)[2m > [22m[2mpowinien po
kaza─ç menu dla Klaps Burger
s[22m[39m
At C:\Users\frees\AppData\Ro
aming\npm\npm.ps1:24 char:5
+     & "node$exe"  "$basedi
r/node_modules/npm/bin/npm-c
li.js" $args
+     ~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~
    + CategoryInfo          
    : NotSpecified: ([90m  
  stderr[2m...rgers[22m   
 [39m:String) [], Remot    
eException
    + FullyQualifiedErrorId 
    : NativeCommandError
 
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Klaps Burgers"
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Klaps Burgers" ÔÇö k
ontynuuj normalny flow

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Klaps Burgers[22m[39m
[brainRouter] ­čžá Calling detectIntent with: {
  text: [32m'Jakie jest menu w Klaps Burgers?'[39m,
  sessionId: [32m'e2e_piekary_1766043135688'[39m
}
[brainRouter] ­čžá Current session: {
  expectedContext: [1mnull[22m,
  lastIntent: [32m'menu_request'[39m,
  lastRestaurant: {
    id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
    name: [32m'Restauracja Stara Kamienica'[39m,
    address: [32m'ul. Bytomska 61'[39m,
    city: [32m'Piekary ┼Ül─ůskie'[39m,
    lat: [33m50.3856[39m,
    lng: [33m18.94886[39m
  },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary ┼Ťl─ůskie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043136820[39m }
  },
  last_location: [32m'Piekary ┼Ül─ůskie'[39m,
  lastUpdated: [33m1766043138257[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Mi─Ödzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Ameryka┼äska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. Ksi─Ödza Piotra Skargi 3'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'Dw├│r Hubertus'[39m,
      address: [32m'ul. Inwalid├│w Wojennych 72'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'┼Ül─ůska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. Stanis┼éawa Maczka 22'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'8ed5ff4a-8f10-4b0b-bc6c-b6c801254f23'[39m,
      restaurant_id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Filet z kurczaka po hawajsku'[39m,
      description: [32m'Filet, ananas, ser, sos, ziemniaki, sur├│wka'[39m,
      category: [32m'Danie g┼é├│wne'[39m,
      base_type: [32m'kurczak'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m19[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-26T15:49:25.550641+00:00'[39m
    },
    {
      id: [32m'739cdfe1-328f-45a7-bad7-a490761bb43c'[39m,
      restaurant_id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Filet z kurczaka tradycyjny (panierowany)'[39m,
      description: [32m'Filet drobiowy panierowany, ziemniaki, sur├│wka'[39m,
      category: [32m'Danie g┼é├│wne'[39m,
      base_type: [32m'kurczak'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m15[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-26T15:49:25.550641+00:00'[39m
    },
    {
      id: [32m'e939262c-f11a-4f06-b513-204c82e2bf4c'[39m,
      restaurant_id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Fondant czekoladowy z lodami i bit─ů ┼Ťmietan─ů'[39m,
      description: [32m'Fondant czekoladowy, lody, bita ┼Ťmietana'[39m,
      category: [32m'Deser'[39m,
      base_type: [32m'fondant'[39m,
      meat_type: [32m'vege'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m22[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mtrue[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-26T15:45:53.945113+00:00'[39m
    },
    {
      id: [32m'2f1b8974-f6d0-46d8-8387-7679c54e9c28'[39m,
      restaurant_id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Grillowany filet z kurczaka'[39m,
      description: [32m'Grillowany filet, ziemniaki, sur├│wka'[39m,
      category: [32m'Danie g┼é├│wne'[39m,
      base_type: [32m'kurczak'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m15[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-26T15:49:25.550641+00:00'[39m
    },
    {
      id: [32m'3b95bad4-976f-4d8b-a333-bc912d79886d'[39m,
      restaurant_id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Gulasz wieprzowy po w─Ögiersku'[39m,
      description: [32m'Gulasz, ziemniaki, zestaw sur├│wek'[39m,
      category: [32m'Danie g┼é├│wne'[39m,
      base_type: [32m'gulasz'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m23[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-26T15:51:18.018618+00:00'[39m
    },
    {
      id: [32m'001a11cc-a541-4f59-8a56-c2c4eafe464d'[39m,
      restaurant_id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Jajecznica z 2 szt. jaj'[39m,
      description: [32m'Jajecznica, pieczywo'[39m,
      category: [32m'┼Üniadanie'[39m,
      base_type: [32m'jajecznica'[39m,
      meat_type: [32m'vege'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m11[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mtrue[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-26T15:52:04.270001+00:00'[39m
    }
  ]
}
­čöČ Starting Smart Intent Layer...
[intent-router] ­čÜÇ detectIntent called with: { text: [32m'Jakie jest menu w Klaps Burgers?'[39m, sessionId: [90mundefined[39m }
[intent-router] ­čöŹ Starting early dish detection for text: Jakie jest menu w Klaps Burgers?
[intent-router] ­čöŹ Normalized text: jakie jest menu w klaps burgers?
[intent-router] ­čöŹ Session restaurant: NONE
[intent-router] ­čöŹ Restaurant indicators in text: true
[intent-router] ­čöŹ Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mB. Int
ent menu_request (Menu konkr
etnej restauracji)[2m > [2
2m[2mpowinien pokaza─ç menu
 dla Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Klaps Burgers[22m[39m
[intent-router] ­čöŹ Checking 9 restaurants for fuzzy match
[intent-router] ­čĆ¬ Restaurant detected in text (exact): Klaps Burgers
[loadMenuCatalog] ­čöŹ Session: {
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
}
[loadMenuCatalog] ­čöŹ lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[loadMenuCatalog] ­čöŹ lastId: 569a7d29-57be-4224-bdf3-09c483415cea
[loadMenuCatalog] Ôťů Loading menu for restaurant: 569a7d29-57be-4224-bdf3-09c483415cea (Klaps Burgers)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mB. Int
ent menu_request (Menu konkr
etnej restauracji)[2m > [2
2m[2mpowinien pokaza─ç menu
 dla Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Klaps Burgers[22m[39m
[loadMenuCatalog] Ôťů Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] Ôťů Sample items: Kosmiczne Jaja Double, Wegetrix Double, ┼╗wirek i Muchomorek Standard
[intent-router] Catalog loaded: 21 items
[intent-router] ­čöŹ Calling parseOrderItems...
[intent-router] ­čöŹ Catalog items: Kosmiczne Jaja Double, Wegetrix Double, ┼╗wirek i Muchomorek Standard, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, G┼éodzilla, Kosmiczne Jaja Standard
[parseOrderItems] ­čôŐ Summary:
  - requestedNames: [burger]
  - availableNames: []
  - unavailableNames: [burger]
  - matched.length: 0
  - clarifications.length: 0
[intent-router] Ôťů Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "burger"
  ],
  "needsClarification": true,
  "unknownItems": []
}
[intent-router] ­čöŹ parsed.any = false
[intent-router] ­čöŹ parsed.groups.length = 0
ÔÜá´ŞĆ Unavailable items detected: burger in tym menu
­čöŹ Checking if text contains restaurant name (using cached list): "jakie jest menu w klaps burgers?"
Ôťů Text contains restaurant name: Klaps Burgers ÔÇö skipping clarify_order
[intent-router] ÔŁî No dishes matched in catalog (parsed.any = false)
[intent-router] ÔŁî Continuing to KROK 4 (targetRestaurant check)...

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mB. Int
ent menu_request (Menu konkr
etnej restauracji)[2m > [2
2m[2mpowinien pokaza─ç menu
 dla Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Klaps Burgers[22m[39m
[intent-router] ­čöŹ KROK 4: Checking targetRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[intent-router] ­čĆ¬ KROK 4: Restaurant found in early detection: Klaps Burgers, checking keywords...
[intent-router] ­čöŹ KROK 4: Lower text: "jakie jest menu w klaps burgers"
[intent-router] ­čöŹ KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'poka┼╝ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta da┼ä'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ­čöŹ KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] ÔÜá´ŞĆ KROK 4: Menu keyword found, returning menu_request
[intent-router] ÔÜá´ŞĆ KROK 4: This may override create_order from KROK 2!
­čöŹ Debug session updated: {
  intent: [32m'menu_request'[39m,
  restaurant: [32m'Klaps Burgers'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mB. Int
ent menu_request (Menu konkr
etnej restauracji)[2m > [2
2m[2mpowinien pokaza─ç menu
 dla Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Klaps Burgers[22m[39m
Ôťů SmartIntent Resolved: show_menu (0.90) via llm
­čžá [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'show_menu'[39m,
  ruleConfidence: [33m0.9[39m,
  llmIntent: [32m'show_menu'[39m,
  llmConfidence: [33m0.9[39m,
  finalIntent: [32m'show_menu'[39m,
  finalConfidence: [33m0.9[39m,
  source: [32m'llm'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Klaps Burgers'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
­čžá [DEBUG] Calling boostIntent with: {
  text: [32m'Jakie jest menu w Klaps Burgers?'[39m,
  hybridIntent: [32m'show_menu'[39m,
  confidence: [33m0.9[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastRestaurant: [32m'Restauracja Stara Kamienica'[39m,
    lastIntent: [32m'menu_request'[39m
  }
}
­čžá [DEBUG] boostIntent result: {
  originalIntent: [32m'show_menu'[39m,
  boostedIntent: [32m'show_menu'[39m,
  isContextLocked: [33mfalse[39m
}
­čôő Parsed: { dish: [1mnull[22m, restaurant: [32m'Klaps Burgers'[39m }
­čžá menu_request intent detected

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mB. Int
ent menu_request (Menu konkr
etnej restauracji)[2m > [2
2m[2mpowinien pokaza─ç menu
 dla Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Klaps Burgers[22m[39m
Ôťů Matched restaurant: "Klaps Burgers" Ôćĺ Klaps Burgers
Ôťů Restaurant set: Klaps Burgers

POST /api/brain 200 14274 - 3116.253 ms
[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mB. Int
ent menu_request (Menu konkr
etnej restauracji)[2m > [2
2m[2mpowinien pokaza─ç menu
 dla Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Klaps Burgers[22m[39m
Ôťů Menu loaded: 21 items (showing 6) from Klaps Burgers
ÔÜá´ŞĆ Skipping LLM reply generation (test mode or no key), using replyCore
Ôťů Final response: intent=show_menu, confidence=0.9, fallback=false
­čôŽ Final Response Preparation: MenuItems count = 6

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Pizzeria Monte Carlo[22m[39m
[brainRouter] ­čÜÇ Handler called

 [31m├Ś[39m api/brain/tests/brainRouter.e2e.test.js[2m > [22m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22mpowinien pokaza─ç menu dla Klaps Burgers[33m 3127[2mms[22m[39m
[31m   Ôćĺ expected 'show_menu' to be 'menu_request' // Object.is equality[39m
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Pizzeria Monte Carlo[22m[39m
­čžá [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  text: [32m'Poka┼╝ menu w Pizzeria Monte Carlo'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043135688'[39m,
    text: [32m'Poka┼╝ menu w Pizzeria Monte Carlo'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m33[39m
}
­čžá [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastIntent: [32m'show_menu'[39m,
    lastRestaurant: {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary ┼Ťl─ůskie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ┼Ül─ůskie'[39m,
    lastUpdated: [33m1766043141342[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ]
  },
  hasExpectedContext: [33mfalse[39m,
  expectedContextValue: [1mnull[22m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Klaps Burgers'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ┼Ül─ůskie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'show_menu'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m
  ]
}
­čžş GeoContext Layer activated for: "Pizzeria Monte Carlo"

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Pizzeria Monte Carlo[22m[39m
[brainRouter] ­čžá Calling detectIntent with: {
  text: [32m'Poka┼╝ menu w Pizzeria Monte Carlo'[39m,
  sessionId: [32m'e2e_piekary_1766043135688'[39m
}
[brainRouter] ­čžá Current session: {
  expectedContext: [1mnull[22m,
  lastIntent: [32m'show_menu'[39m,
  lastRestaurant: {
    id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
    name: [32m'Klaps Burgers'[39m,
    address: [32m'ul. Piotra Skargi 15'[39m,
    city: [32m'Piekary ┼Ül─ůskie'[39m,
    lat: [33m50.38643[39m,
    lng: [33m18.95422[39m
  },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary ┼Ťl─ůskie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043136820[39m }
  },
  last_location: [32m'Piekary ┼Ül─ůskie'[39m,
  lastUpdated: [33m1766043141342[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Mi─Ödzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Ameryka┼äska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. Ksi─Ödza Piotra Skargi 3'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'Dw├│r Hubertus'[39m,
      address: [32m'ul. Inwalid├│w Wojennych 72'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'┼Ül─ůska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. Stanis┼éawa Maczka 22'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'a1a67286-2aaf-4cb7-ae05-50573652391c'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Double'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 400g, ser cheddar, sa┼éata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m46[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'009797c9-808b-4b8a-89b4-79d8d9ece27a'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Standard'[39m,
[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mB. Int
ent menu_request (Menu konkr
etnej restauracji)[2m > [2
2m[2mpowinien pokaza─ç menu
 dla Pizzeria Monte Carlo[2
2m[39m
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Pizzeria Monte Carlo
"
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Pizzeria Monte Carlo
" ÔÇö kontynuuj normalny flo
w

      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 200g, ser cheddar, sa┼éata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m36[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'fecf6c54-17f4-4bb6-8a50-6a5944a11728'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'G┼éodzilla'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, 100% wo┼éowina 200g, grillowany boczek, ser camembert, nachos, papryka, sa┼éata rzymska, czerwona cebula, sos mango, czosnek'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m59[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'108af5f7-ea9e-46f2-8d06-d7837e181dce'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Grzybiarz z Piekaryhill'[39m,
      description: [32m'Bu┼éka, wo┼éowina, boczek, majonez, sa┼éata, marynowana cebula, ser cheddar, grzyby, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m40[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'b5bde246-f3e9-4854-8bcf-c60787647ca0'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Double'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 400g, ser cheddar, grillowana dynia w pomara┼äczy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m49[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'c6b011fa-882d-4894-a84f-9a41acae5dbc'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Standard'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 200g, ser cheddar, grillowana dynia w pomara┼äczy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m39[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    }
  ]
}
­čöČ Starting Smart Intent Layer...
[intent-router] ­čÜÇ detectIntent called with: { text: [32m'Poka┼╝ menu w Pizzeria Monte Carlo'[39m, sessionId: [90mundefined[39m }
[intent-router] ­čöŹ Starting early dish detection for text: Poka┼╝ menu w Pizzeria Monte Carlo
[intent-router] ­čöŹ Normalized text: poka┼╝ menu w pizzeria monte carlo
[intent-router] ­čöŹ Session restaurant: NONE
[intent-router] ­čöŹ Restaurant indicators in text: true
[intent-router] ­čöŹ Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mB. Int
ent menu_request (Menu konkr
etnej restauracji)[2m > [2
2m[2mpowinien pokaza─ç menu
 dla Pizzeria Monte Carlo[2
2m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Pizzeria Monte Carlo[22m[39m
[intent-router] ­čöŹ Checking 9 restaurants for fuzzy match
[intent-router] ­čĆ¬ Restaurant detected in text (exact): Pizzeria Monte Carlo
[loadMenuCatalog] ­čöŹ Session: {
  lastRestaurant: {
    id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
    name: [32m'Pizzeria Monte Carlo'[39m
  }
}
[loadMenuCatalog] ­čöŹ lastRestaurant: {
  id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
  name: [32m'Pizzeria Monte Carlo'[39m
}
[loadMenuCatalog] ­čöŹ lastId: 83566974-1017-4408-90ee-2571ccc06978
[loadMenuCatalog] Ôťů Loading menu for restaurant: 83566974-1017-4408-90ee-2571ccc06978 (Pizzeria Monte Carlo)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mB. Int
ent menu_request (Menu konkr
etnej restauracji)[2m > [2
2m[2mpowinien pokaza─ç menu
 dla Pizzeria Monte Carlo[2
2m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Pizzeria Monte Carlo[22m[39m
[loadMenuCatalog] Ôťů Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] Ôťů Sample items: Hawajska, Coca-Cola, Coca-Cola Zero
[intent-router] Catalog loaded: 21 items
[intent-router] ­čöŹ Calling parseOrderItems...
[intent-router] ­čöŹ Catalog items: Hawajska, Coca-Cola, Coca-Cola Zero, Fanta Pomara┼äczowa, Sprite, Cappy Jab┼éko, Cappy Pomara┼äcza, Woda Mineralna, Tiramisu, Panna Cotta, Brownie, Lody waniliowe z sosem karmelowym, Margherita, Capricciosa, Diavola, Quattro Formaggi, Vegetariana, Prosciutto e Funghi, Salami, Pollo, Spinaci
[parseOrderItems] ­čôŐ Summary:
  - requestedNames: []
  - availableNames: []
  - unavailableNames: []
  - matched.length: 0
  - clarifications.length: 0
[intent-router] Ôťů Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "poka┼╝ menu w pizzeria monte carlo"
  ],
  "needsClarification": true,
  "unknownItems": [
    {
      "name": "poka┼╝ menu w pizzeria monte carlo",
      "reason": "no_alias_match"
    }
  ]
}
[intent-router] ­čöŹ parsed.any = false
[intent-router] ­čöŹ parsed.groups.length = 0
ÔÜá´ŞĆ Unavailable items detected: poka┼╝ menu w pizzeria monte carlo in tym menu
­čöŹ Checking if text contains restaurant name (using cached list): "poka┼╝ menu w pizzeria monte carlo"
Ôťů Text contains restaurant name: Pizzeria Monte Carlo ÔÇö skipping clarify_order
[intent-router] ÔŁî No dishes matched in catalog (parsed.any = false)
[intent-router] ÔŁî Continuing to KROK 4 (targetRestaurant check)...

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mB. Int
ent menu_request (Menu konkr
etnej restauracji)[2m > [2
2m[2mpowinien pokaza─ç menu
 dla Pizzeria Monte Carlo[2
2m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Pizzeria Monte Carlo[22m[39m
[intent-router] ­čöŹ KROK 4: Checking targetRestaurant: {
  id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
  name: [32m'Pizzeria Monte Carlo'[39m
}
[intent-router] ­čĆ¬ KROK 4: Restaurant found in early detection: Pizzeria Monte Carlo, checking keywords...
[intent-router] ­čöŹ KROK 4: Lower text: "pokaz menu w pizzeria monte carlo"
[intent-router] ­čöŹ KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'poka┼╝ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta da┼ä'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ­čöŹ KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] ÔÜá´ŞĆ KROK 4: Menu keyword found, returning menu_request
[intent-router] ÔÜá´ŞĆ KROK 4: This may override create_order from KROK 2!
­čöŹ Debug session updated: {
  intent: [32m'menu_request'[39m,
  restaurant: [32m'Pizzeria Monte Carlo'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mB. Int
ent menu_request (Menu konkr
etnej restauracji)[2m > [2
2m[2mpowinien pokaza─ç menu
 dla Pizzeria Monte Carlo[2
2m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Pizzeria Monte Carlo[22m[39m
Ôťů SmartIntent Resolved: show_menu (0.90) via llm
­čžá [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'show_menu'[39m,
  ruleConfidence: [33m0.9[39m,
  llmIntent: [32m'show_menu'[39m,
  llmConfidence: [33m0.9[39m,
  finalIntent: [32m'show_menu'[39m,
  finalConfidence: [33m0.9[39m,
  source: [32m'llm'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Pizzeria Monte Carlo'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
­čžá [DEBUG] Calling boostIntent with: {
  text: [32m'Poka┼╝ menu w Pizzeria Monte Carlo'[39m,
  hybridIntent: [32m'show_menu'[39m,
  confidence: [33m0.9[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastRestaurant: [32m'Klaps Burgers'[39m,
    lastIntent: [32m'show_menu'[39m
  }
}
­čžá [DEBUG] boostIntent result: {
  originalIntent: [32m'show_menu'[39m,
  boostedIntent: [32m'show_menu'[39m,
  isContextLocked: [33mfalse[39m
}
­čôő Parsed: { dish: [1mnull[22m, restaurant: [32m'Pizzeria Monte Carlo'[39m }
­čžá menu_request intent detected

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mB. Int
ent menu_request (Menu konkr
etnej restauracji)[2m > [2
2m[2mpowinien pokaza─ç menu
 dla Pizzeria Monte Carlo[2
2m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Pizzeria Monte Carlo[22m[39m
Ôťů Matched restaurant: "Pizzeria Monte Carlo" Ôćĺ Pizzeria Monte Carlo
Ôťů Restaurant set: Pizzeria Monte Carlo

POST /api/brain 200 13045 - 3757.334 ms
[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mB. Int
ent menu_request (Menu konkr
etnej restauracji)[2m > [2
2m[2mpowinien pokaza─ç menu
 dla Pizzeria Monte Carlo[2
2m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22m[2mpowinien pokaza─ç menu dla Pizzeria Monte Carlo[22m[39m
Ôťů Menu loaded: 21 items (showing 6) from Pizzeria Monte Carlo
ÔÜá´ŞĆ Skipping LLM reply generation (test mode or no key), using replyCore
Ôťů Final response: intent=show_menu, confidence=0.9, fallback=false
­čôŽ Final Response Preparation: MenuItems count = 6

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç pizz─Ö margherit─Ö do zam├│wienia w Pizzeria Monte Carlo[22m[39m
[brainRouter] ­čÜÇ Handler called

 [31m├Ś[39m api/brain/tests/brainRouter.e2e.test.js[2m > [22m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22mB. Intent menu_request (Menu konkretnej restauracji)[2m > [22mpowinien pokaza─ç menu dla Pizzeria Monte Carlo[33m 3764[2mms[22m[39m
[31m   Ôćĺ expected 'show_menu' to be 'menu_request' // Object.is equality[39m
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç pizz─Ö margherit─Ö do zam├│wienia w Pizzeria Monte Carlo[22m[39m
­čžá [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  text: [32m'Wybieram Pizzeria Monte Carlo'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043135688'[39m,
    text: [32m'Wybieram Pizzeria Monte Carlo'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m29[39m
}
­čžá [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastIntent: [32m'show_menu'[39m,
    lastRestaurant: {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. Stanis┼éawa Maczka 22'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary ┼Ťl─ůskie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ┼Ül─ůskie'[39m,
    lastUpdated: [33m1766043145085[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ]
  },
  hasExpectedContext: [33mfalse[39m,
  expectedContextValue: [1mnull[22m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Pizzeria Monte Carlo'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ┼Ül─ůskie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'show_menu'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m
  ]
}
­čžş GeoContext Layer activated for: "Wybieram Pizzeria Monte Carlo"

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç pizz─Ö marg
herit─Ö do zam├│wienia w Piz
zeria Monte Carlo[22m[39m
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Wybieram Pizzeria Mo
nte Carlo"
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Wybieram Pizzeria Mo
nte Carlo" ÔÇö kontynuuj nor
malny flow

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç pizz─Ö margherit─Ö do zam├│wienia w Pizzeria Monte Carlo[22m[39m
[brainRouter] ­čžá Calling detectIntent with: {
  text: [32m'Wybieram Pizzeria Monte Carlo'[39m,
  sessionId: [32m'e2e_piekary_1766043135688'[39m
}
[brainRouter] ­čžá Current session: {
  expectedContext: [1mnull[22m,
  lastIntent: [32m'show_menu'[39m,
  lastRestaurant: {
    id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
    name: [32m'Pizzeria Monte Carlo'[39m,
    address: [32m'Ul. Stanis┼éawa Maczka 22'[39m,
    city: [32m'Piekary ┼Ül─ůskie'[39m,
    lat: [1mnull[22m,
    lng: [1mnull[22m
  },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary ┼Ťl─ůskie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043136820[39m }
  },
  last_location: [32m'Piekary ┼Ül─ůskie'[39m,
  lastUpdated: [33m1766043145085[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Mi─Ödzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Ameryka┼äska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. Ksi─Ödza Piotra Skargi 3'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'Dw├│r Hubertus'[39m,
      address: [32m'ul. Inwalid├│w Wojennych 72'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'┼Ül─ůska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. Stanis┼éawa Maczka 22'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'e472c234-04d2-4872-a635-761f00f9853c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Brownie'[39m,
      description: [32m'Czekoladowe ciasto z orzechami w┼éoskimi'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m14[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'1a7eeba7-8c23-4fdb-a7c8-fcccbfa0008d'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Capricciosa'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, pieczarki'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m33[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'91088af5-2a2a-4bb3-96af-8907fcd4471e'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Diavola'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, pikantne salami, papryczki jalape├▒o'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m34[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'2346a6d2-4f63-4c47-b217-f752cfa02a9b'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Hawajska'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, ananas'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m32[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'03ce8a1a-be58-407c-87df-48ab33817f5c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Margherita'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, bazylia'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m28[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'8492d2e8-fc47-4381-af16-8ef4e1aa7b04'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Panna Cotta'[39m,
      description: [32m'Z musem truskawkowym'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m15[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    }
  ]
}
­čöČ Starting Smart Intent Layer...
[intent-router] ­čÜÇ detectIntent called with: { text: [32m'Wybieram Pizzeria Monte Carlo'[39m, sessionId: [90mundefined[39m }
[intent-router] ­čöŹ Starting early dish detection for text: Wybieram Pizzeria Monte Carlo
[intent-router] ­čöŹ Normalized text: wybieram pizzeria monte carlo
[intent-router] ­čöŹ Session restaurant: NONE
[intent-router] ­čöŹ Restaurant indicators in text: true
[intent-router] ­čöŹ Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç pizz─Ö marg
herit─Ö do zam├│wienia w Piz
zeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç pizz─Ö margherit─Ö do zam├│wienia w Pizzeria Monte Carlo[22m[39m
[intent-router] ­čöŹ Checking 9 restaurants for fuzzy match
[intent-router] ­čĆ¬ Restaurant detected in text (exact): Pizzeria Monte Carlo
[loadMenuCatalog] ­čöŹ Session: {
  lastRestaurant: {
    id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
    name: [32m'Pizzeria Monte Carlo'[39m
  }
}
[loadMenuCatalog] ­čöŹ lastRestaurant: {
  id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
  name: [32m'Pizzeria Monte Carlo'[39m
}
[loadMenuCatalog] ­čöŹ lastId: 83566974-1017-4408-90ee-2571ccc06978
[loadMenuCatalog] Ôťů Loading menu for restaurant: 83566974-1017-4408-90ee-2571ccc06978 (Pizzeria Monte Carlo)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç pizz─Ö marg
herit─Ö do zam├│wienia w Piz
zeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç pizz─Ö margherit─Ö do zam├│wienia w Pizzeria Monte Carlo[22m[39m
[loadMenuCatalog] Ôťů Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] Ôťů Sample items: Hawajska, Coca-Cola, Coca-Cola Zero
[intent-router] Catalog loaded: 21 items
[intent-router] ­čöŹ Calling parseOrderItems...
[intent-router] ­čöŹ Catalog items: Hawajska, Coca-Cola, Coca-Cola Zero, Fanta Pomara┼äczowa, Sprite, Cappy Jab┼éko, Cappy Pomara┼äcza, Woda Mineralna, Tiramisu, Panna Cotta, Brownie, Lody waniliowe z sosem karmelowym, Margherita, Capricciosa, Diavola, Quattro Formaggi, Vegetariana, Prosciutto e Funghi, Salami, Pollo, Spinaci
[parseOrderItems] ­čôŐ Summary:
  - requestedNames: []
  - availableNames: []
  - unavailableNames: []
  - matched.length: 0
  - clarifications.length: 0
[intent-router] Ôťů Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "wybieram pizzeria monte carlo"
  ],
  "needsClarification": true,
  "unknownItems": [
    {
      "name": "wybieram pizzeria monte carlo",
      "reason": "no_alias_match"
    }
  ]
}
[intent-router] ­čöŹ parsed.any = false
[intent-router] ­čöŹ parsed.groups.length = 0
ÔÜá´ŞĆ Unavailable items detected: wybieram pizzeria monte carlo in tym menu
­čöŹ Checking if text contains restaurant name (using cached list): "wybieram pizzeria monte carlo"
Ôťů Text contains restaurant name: Pizzeria Monte Carlo ÔÇö skipping clarify_order
[intent-router] ÔŁî No dishes matched in catalog (parsed.any = false)
[intent-router] ÔŁî Continuing to KROK 4 (targetRestaurant check)...

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç pizz─Ö marg
herit─Ö do zam├│wienia w Piz
zeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç pizz─Ö margherit─Ö do zam├│wienia w Pizzeria Monte Carlo[22m[39m
[intent-router] ­čöŹ KROK 4: Checking targetRestaurant: {
  id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
  name: [32m'Pizzeria Monte Carlo'[39m
}
[intent-router] ­čĆ¬ KROK 4: Restaurant found in early detection: Pizzeria Monte Carlo, checking keywords...
[intent-router] ­čöŹ KROK 4: Lower text: "wybieram pizzeria monte carlo"
[intent-router] ­čöŹ KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'poka┼╝ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta da┼ä'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ­čöŹ KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] Ôťů Order keyword found, returning create_order
­čöŹ Debug session updated: {
  intent: [32m'create_order'[39m,
  restaurant: [32m'Pizzeria Monte Carlo'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}

POST /api/brain 200 12743 - 2113.036 ms
[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç pizz─Ö marg
herit─Ö do zam├│wienia w Piz
zeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç pizz─Ö margherit─Ö do zam├│wienia w Pizzeria Monte Carlo[22m[39m
Ôťů SmartIntent Resolved: confirm_order (0.90) via llm
­čžá [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'confirm_order'[39m,
  ruleConfidence: [33m0.9[39m,
  llmIntent: [32m'confirm_order'[39m,
  llmConfidence: [33m0.9[39m,
  finalIntent: [32m'confirm_order'[39m,
  finalConfidence: [33m0.9[39m,
  source: [32m'llm'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Pizzeria Monte Carlo'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
­čžá [DEBUG] Calling boostIntent with: {
  text: [32m'Wybieram Pizzeria Monte Carlo'[39m,
  hybridIntent: [32m'confirm_order'[39m,
  confidence: [33m0.9[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastRestaurant: [32m'Pizzeria Monte Carlo'[39m,
    lastIntent: [32m'show_menu'[39m
  }
}
­čžá [DEBUG] boostIntent result: {
  originalIntent: [32m'confirm_order'[39m,
  boostedIntent: [32m'confirm_order'[39m,
  isContextLocked: [33mfalse[39m
}
­čôő Parsed: { dish: [1mnull[22m, restaurant: [1mnull[22m }
Ôťů confirm_order intent detected
ÔÜá´ŞĆ No pending order to commit
ÔÜá´ŞĆ Skipping LLM reply generation (test mode or no key), using replyCore
Ôťů Final response: intent=confirm_order, confidence=0.9, fallback=false
­čôŽ Final Response Preparation: MenuItems count = 6

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç pizz─Ö marg
herit─Ö do zam├│wienia w Piz
zeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç pizz─Ö margherit─Ö do zam├│wienia w Pizzeria Monte Carlo[22m[39m
[brainRouter] ­čÜÇ Handler called

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç pizz─Ö marg
herit─Ö do zam├│wienia w Piz
zeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç pizz─Ö margherit─Ö do zam├│wienia w Pizzeria Monte Carlo[22m[39m
­čžá [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  text: [32m'Zam├│w jedn─ů du┼╝─ů pizz─Ö margherita'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043135688'[39m,
    text: [32m'Zam├│w jedn─ů du┼╝─ů pizz─Ö margherita'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m33[39m
}
­čžá [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastIntent: [32m'confirm_order'[39m,
    lastRestaurant: {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. Stanis┼éawa Maczka 22'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary ┼Ťl─ůskie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ┼Ül─ůskie'[39m,
    lastUpdated: [33m1766043147555[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ]
  },
  hasExpectedContext: [33mfalse[39m,
  expectedContextValue: [1mnull[22m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Pizzeria Monte Carlo'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ┼Ül─ůskie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'confirm_order'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m
  ]
}
­čžş GeoContext Layer activated for: "jedn─ů du┼╝─ů pizz─Ö margherita"

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç pizz─Ö margherit─Ö do zam├│wienia w Pizzeria Monte Carlo[22m[39m
[brainRouter] ­čžá Calling detectIntent with: {
  text: [32m'Zam├│w jedn─ů du┼╝─ů pizz─Ö margherita'[39m,
  sessionId: [32m'e2e_piekary_1766043135688'[39m
}
[brainRouter] ­čžá Current session: {
  expectedContext: [1mnull[22m,
  lastIntent: [32m'confirm_order'[39m,
  lastRestaurant: {
    id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
    name: [32m'Pizzeria Monte Carlo'[39m,
    address: [32m'Ul. Stanis┼éawa Maczka 22'[39m,
    city: [32m'Piekary ┼Ül─ůskie'[39m,
    lat: [1mnull[22m,
    lng: [1mnull[22m
  },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary ┼Ťl─ůskie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043136820[39m }
  },
  last_location: [32m'Piekary ┼Ül─ůskie'[39m,
  lastUpdated: [33m1766043147555[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Mi─Ödzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Ameryka┼äska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. Ksi─Ödza Piotra Skargi 3'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'Dw├│r Hubertus'[39m,
      address: [32m'ul. Inwalid├│w Wojennych 72'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'┼Ül─ůska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. Stanis┼éawa Maczka 22'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'e472c234-04d2-4872-a635-761f00f9853c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Brownie'[39m,
      description: [32m'Czekoladowe ciasto z orzechami w┼éoskimi'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m14[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'1a7eeba7-8c23-4fdb-a7c8-fcccbfa0008d'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Capricciosa'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, pieczarki'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m33[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'91088af5-2a2a-4bb3-96af-8907fcd4471e'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Diavola'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, pikantne salami, papryczki jalape├▒o'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m34[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'2346a6d2-4f63-4c47-b217-f752cfa02a9b'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Hawajska'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, ananas'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m32[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'03ce8a1a-be58-407c-87df-48ab33817f5c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Margherita'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, bazylia'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m28[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'8492d2e8-fc47-4381-af16-8ef4e1aa7b04'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Panna Cotta'[39m,
      description: [32m'Z musem truskawkowym'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m15[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    }
  ]
}
­čöČ Starting Smart Intent Layer...
[intent-router] ­čÜÇ detectIntent called with: { text: [32m'Zam├│w jedn─ů du┼╝─ů pizz─Ö margherita'[39m, sessionId: [90mundefined[39m }
[intent-router] ­čöŹ Starting early dish detection for text: Zam├│w jedn─ů du┼╝─ů pizz─Ö margherita
[intent-router] ­čöŹ Normalized text: zam├│w jedn─ů du┼╝─ů pizz─Ö margherita
[intent-router] ­čöŹ Session restaurant: NONE
[intent-router] ­čöŹ Restaurant indicators in text: true
[intent-router] ­čöŹ Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç pizz─Ö marg
herit─Ö do zam├│wienia w Piz
zeria Monte Carlo[22m[39m
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "jedn─ů du┼╝─ů pizz─Ö
 margherita"
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "jedn─ů du┼╝─ů pizz─Ö
 margherita" ÔÇö kontynuuj n
ormalny flow

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç pizz─Ö marg
herit─Ö do zam├│wienia w Piz
zeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç pizz─Ö margherit─Ö do zam├│wienia w Pizzeria Monte Carlo[22m[39m
[intent-router] ­čöŹ Checking 9 restaurants for fuzzy match
[loadMenuCatalog] ­čöŹ Session: default
[loadMenuCatalog] ­čöŹ lastRestaurant: [90mundefined[39m
[loadMenuCatalog] ­čöŹ lastId: [90mundefined[39m
[loadMenuCatalog] ÔÜá´ŞĆ Loading all menu items (no restaurant in session)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç pizz─Ö marg
herit─Ö do zam├│wienia w Piz
zeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç pizz─Ö margherit─Ö do zam├│wienia w Pizzeria Monte Carlo[22m[39m
[loadMenuCatalog] Ôťů Loaded 246 menu items from 9 restaurants
[loadMenuCatalog] Ôťů Sample items: Pizza ┼áunkov├í, Pizza Ekkluzivne, Pizza L├íska Nebesk├í
[intent-router] Catalog loaded: 246 items
[intent-router] ­čöŹ Calling parseOrderItems...
[intent-router] ­čöŹ Catalog items: Pizza ┼áunkov├í, Pizza Ekkluzivne, Pizza L├íska Nebesk├í, Rumcajsowy Burger, Golonka confit, Sa┼éatka z halloumi, Zupa pomidorowa, Kofola klasyczna, Hawajska, Coca-Cola, Coca-Cola Zero, Fanta Pomara┼äczowa, Sprite, Coca-Cola, Fanta, Piwo Tyskie, Pizza Margherita 33cm, Pizza Pepperoni 33cm, Pizza Hawajska 33cm, Pizza Capricciosa 33cm, Pizza Vege 33cm, Bacon Burger, Better Than Drwal - Wo┼éowina, Cheddar Burger, Vege Burger, Spicy Burger, Bowl Gyros-Halloumi, Bowl z Dyni─ů, Bowl Kurczak Zapiekany z Serem, Filet Grillowany, Pulled Pork Bowl Pikantny, Zapiekaniec, Cappy Jab┼éko, Krem z Cebuli i Czosnku, Sa┼éatka Cezar Callzone, Sa┼éatka Grillowany Kurczak, Sa┼éatka Halloumi, Sa┼éatka z Serem Camembert, Sa┼éatka z Serem Feta, Sa┼éatka z Dyni─ů, Szarlotka, Sernik z Musem Malinowym, Ciasto Marchewkowe, Pepsi 0.85L, Kawa Czarna, Kawa Bia┼éa, Flat White, Cappuccino, Latte, Sos Tzatziki, Sos Pikantny, Sos Jogurtowy, G─Ösie ┼╝o┼é─ůdki, Camembert z ┼╝urawin─ů, Deska zak─ůsek dla dwojga, Wodzionka, ┼╗ur ┼Ťl─ůski w chlebie, ┼╗ur ┼Ťl─ůski na talerzu, Krem borowikowy, Zupa pomidorowa, Barszcz z tortellini, Flaki z indyka, Burger wo┼éowy z frytkami i sur├│wk─ů, Burger wegetaria┼äski z Camembertem, frytkami oraz zestawem sur├│wek, Gyros z frytkami i tzatziki, ┼╗eberka wieprzowe z frytkami, Kotlety czopskie, Dzikie placki, W─ůtr├│bka drobiowa, Grillowany filet z kurczaka, Kurczak po parysku, ─ćwiartka kaczki, Rolada wieprzowa, Kotlet schabowy, Pol─Ödwica wieprzowa, Kotlet po szwajcarsku, Rolada wo┼éowa, Oz├│r wo┼éowy, Miruna w panierce, Zupa z kaczki, Zupa Won Ton, Tagliatelle ze szpinakiem, suszonymi pomidorami i p┼éatkami migda┼é├│w, Ros├│┼é z makaronem, Nale┼Ťniki z serem na s┼éodko z bit─ů ┼Ťmietan─ů, Carbonara a'la Hubertus, Filet z ┼éososia na szpinaku, Stek z halibuta sma┼╝ony na ma┼Ťle, Pstr─ůg na zio┼éowo, Pierogi z mi─Ösem, Pierogi ruskie, Kluski z sosem pieczeniowym, Sa┼éatka Hubertusa z pieczywem czosnkowym, Sa┼éatka grecka z pieczywem czosnkowym, Kluski ┼Ťl─ůskie, Ziemniaki z wody, Bratkartoffel, Kapusta modra, Kapusta zasma┼╝ana, Nuggetsy z frytkami oraz sur├│wk─ů z marchewki, Cappy Pomara┼äcza, Woda Mineralna, Tiramisu, Panna Cotta, Brownie, Lody waniliowe z sosem karmelowym, Kosmiczne Jaja Double, Wegetrix Double, ┼╗wirek i Muchomorek Standard, Zupa krabowa, Sajgonki 3 szt., Sajgonki z ry┼╝em, Sajgonki z sur├│wk─ů, Sajgonki z ry┼╝em i sur├│wk─ů, Pierogi Ho Cao z ry┼╝em i sur├│wk─ů, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Krem z dyni z bia┼é─ů czekolad─ů, Siekany tatar z pol─Ödwicy wo┼éowej, W─Ödzony pstr─ůg, Carpaccio z kaczki marynowanej w grza┼äcu, BUFFAL, Kartacze z dzikiem, Sa┼éatka z dyni─ů marynowan─ů w musztardzie, Grzanka z krupniokiem, Tagliatelle z krewetkami, Makaron ry┼╝owy z warzywami, Zupa dnia, Ros├│┼é z makaronem, Tradycyjny schabowy, Schab po beskidzku, Nale┼Ťnik z kurczakiem i warzywami, Nale┼Ťnik ze szpinakiem i serem feta, Lody z gor─ůcymi malinami i bit─ů ┼Ťmietan─ů, Fondant czekoladowy z lodami i bit─ů ┼Ťmietan─ů, Coca-Cola, Fanta, Sprite, Cappy (200 ml), Woda mineralna (330 ml), Filet z kurczaka tradycyjny (panierowany), Filet z kurczaka po hawajsku, Grillowany filet z kurczaka, Kroket (z kapust─ů i grzybami/b─ůd┼║ z mi─Ösem) 1 szt., Placki ziemniaczane 4 szt., Kluski ┼Ťl─ůskie 7 szt., Rolada wo┼éowa (na zam├│wienie), Piecze┼ä wieprzowa, W─ůtr├│bka drobiowa, Gulasz wieprzowy po w─Ögiersku, Pierogi (ruskie lub z mi─Ösem) 6 szt., Jajecznica z 2 szt. jaj, Placki po w─Ögiersku z gulaszem wieprzowym, Nale┼Ťnik z d┼╝emem truskawkowym lub wi┼Ťniowym, Nale┼Ťnik z nutell─ů, bananami, bit─ů ┼Ťmietan─ů, Margherita, Capricciosa, Diavola, Quattro Formaggi, Vegetariana, Prosciutto e Funghi, Salami, Pollo, Spinaci, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, G┼éodzilla, Kosmiczne Jaja Standard, Zupa wietnamska, Zupa z kurczakiem, Zupa ┼éajska, Pierogi SiuMai z ry┼╝em i sur├│wk─ů, Kurczak z warzywami, Kurczak s┼éodko-kwa┼Ťny, Kurczak pikantny, Kurczak po chi┼äsku, Kurczak po tajsku, Kurczak na gor─ůcym p├│┼émisku, Kurczak w cie┼Ťcie s┼éodko-kwa┼Ťny, Kurczak w cie┼Ťcie pikantny, Kurczak w cie┼Ťcie curry, Kurczak w cie┼Ťcie pi─Öciu smak├│w, Wieprzowina z warzywami, Wieprzowina s┼éodko-kwa┼Ťna, Wieprzowina pikantna, Wieprzowina Curry, Wieprzowina pi─Öciu smak├│w, Wieprzowina po tajsku, Wo┼éowina z warzywami, Wo┼éowina pikantna, Wo┼éowina Curry, Wo┼éowina 5 smak├│w, Wo┼éowina po tajsku, Wo┼éowina na gor─ůcym p├│┼émisku, Kaczka z warzywami, Kaczka pikantna, Kaczka s┼éodko-kwa┼Ťna, Kaczka po chi┼äsku, Kaczka po tajsku, Kaczka na gor─ůcym p├│┼émisku, Krewetki z warzywami, Krewetki pikantne, Krewetki Curry, Krewetki po tajsku, Krewetki na gor─ůcym p├│┼émisku, Kalmary chrupi─ůce s┼éodko-kwa┼Ťne, Kalmary chrupi─ůce pikantne, Kalmary chrupi─ůce Curry, Kalmary chrupi─ůce w pi─Öciu smakach, Kalmary po tajsku, Kalmary na gor─ůcym p├│┼émisku, Pita Rollo, Pita Rollo z serem, Pita Rollo same mi─Öso, Tortilla kebab, Tortilla kebab z serem, Kebab ameryka┼äski, Kebab box, Kebab box z serem, Nuggets box, Kebab talerz, Kebab w bu┼éce, Falafel, Frytki z serem, Frytki z Indii masala, Sa┼éatka grecka, Sos, Baklava, Sok Cappy, Coca-Cola 0,85l, Coca-Cola 0,5l, Coca-Cola 0,3l, Pepsi / Mirinda / 7up, Monster Energy Drink, Ayran Turecki, Mango Sok, Oshee, Burn
[parseOrderItems] ­čôŐ Summary:
  - requestedNames: [pizza margherita]
  - availableNames: [pizza margherita 33cm, zupa dnia, margherita]
  - unavailableNames: []
  - matched.length: 3
  - clarifications.length: 0
[intent-router] Ôťů Parsed result: {
  "any": true,
  "groups": [
    {
      "restaurant_id": "bd9f2244-7618-4071-aa96-52616a7b4c70",
      "restaurant_name": "Callzone",
      "items": [
        {
          "menuItemId": "e0825375-5306-47c9-9786-cb8ed45884ba",
          "name": "Pizza Margherita 33cm",
          "price": 33,
          "quantity": 1
        }
      ]
    },
    {
      "restaurant_id": "1fc1e782-bac6-47b2-978a-f6f2b38000cd",
      "restaurant_name": "Restauracja Stara Kamienica",
      "items": [
        {
          "menuItemId": "8dcb0a80-df84-4c1e-9035-ed3570ce66a8",
          "name": "Zupa dnia",
          "price": 9,
          "quantity": 1
        }
      ]
    },
    {
      "restaurant_id": "83566974-1017-4408-90ee-2571ccc06978",
      "restaurant_name": "Pizzeria Monte Carlo",
      "items": [
        {
          "menuItemId": "03ce8a1a-be58-407c-87df-48ab33817f5c",
          "name": "Margherita",
          "price": 28,
          "quantity": 1
        }
      ]
    }
  ],
  "clarify": [],
  "available": [
    {
      "menuItemId": "e0825375-5306-47c9-9786-cb8ed45884ba",
      "name": "Pizza Margherita 33cm",
      "price": 33,
      "quantity": 1,
      "restaurant_id": "bd9f2244-7618-4071-aa96-52616a7b4c70",
      "restaurant_name": "Callzone",
      "matchScore": 1
    },
    {
      "menuItemId": "8dcb0a80-df84-4c1e-9035-ed3570ce66a8",
      "name": "Zupa dnia",
      "price": 9,
      "quantity": 1,
      "restaurant_id": "1fc1e782-bac6-47b2-978a-f6f2b38000cd",
      "restaurant_name": "Restauracja Stara Kamienica",
      "matchScore": 1
    },
    {
      "menuItemId": "03ce8a1a-be58-407c-87df-48ab33817f5c",
      "name": "Margherita",
      "price": 28,
      "quantity": 1,
      "restaurant_id": "83566974-1017-4408-90ee-2571ccc06978",
      "restaurant_name": "Pizzeria Monte Carlo",
      "matchScore": 1
    }
  ],
  "unavailable": [],
  "needsClarification": false,
  "unknownItems": []
}
[intent-router] ­čöŹ parsed.any = true
[intent-router] ­čöŹ parsed.groups.length = 3
­čŹŻ´ŞĆ Ôťů EARLY DISH DETECTION SUCCESS! Dish detected: Pizza Margherita 33cm | Zupa dnia | Margherita
­čŹŻ´ŞĆ Ôťů Returning create_order immediately (HIGHEST PRIORITY)
­čŹŻ´ŞĆ Ôťů parsedOrder: {
  "any": true,
  "groups": [
    {
      "restaurant_id": "bd9f2244-7618-4071-aa96-52616a7b4c70",
      "restaurant_name": "Callzone",
      "items": [
        {
          "menuItemId": "e0825375-5306-47c9-9786-cb8ed45884ba",
          "name": "Pizza Margherita 33cm",
          "price": 33,
          "quantity": 1
        }
      ]
    },
    {
      "restaurant_id": "1fc1e782-bac6-47b2-978a-f6f2b38000cd",
      "restaurant_name": "Restauracja Stara Kamienica",
      "items": [
        {
          "menuItemId": "8dcb0a80-df84-4c1e-9035-ed3570ce66a8",
          "name": "Zupa dnia",
          "price": 9,
          "quantity": 1
        }
      ]
    },
    {
      "restaurant_id": "83566974-1017-4408-90ee-2571ccc06978",
      "restaurant_name": "Pizzeria Monte Carlo",
      "items": [
        {
          "menuItemId": "03ce8a1a-be58-407c-87df-48ab33817f5c",
          "name": "Margherita",
          "price": 28,
          "quantity": 1
        }
      ]
    }
  ],
  "clarify": [],
  "available": [
    {
      "menuItemId": "e0825375-5306-47c9-9786-cb8ed45884ba",
      "name": "Pizza Margherita 33cm",
      "price": 33,
      "quantity": 1,
      "restaurant_id": "bd9f2244-7618-4071-aa96-52616a7b4c70",
      "restaurant_name": "Callzone",
      "matchScore": 1
    },
    {
      "menuItemId": "8dcb0a80-df84-4c1e-9035-ed3570ce66a8",
      "name": "Zupa dnia",
      "price": 9,
      "quantity": 1,
      "restaurant_id": "1fc1e782-bac6-47b2-978a-f6f2b38000cd",
      "restaurant_name": "Restauracja Stara Kamienica",
      "matchScore": 1
    },
    {
      "menuItemId": "03ce8a1a-be58-407c-87df-48ab33817f5c",
      "name": "Margherita",
      "price": 28,
      "quantity": 1,
      "restaurant_id": "83566974-1017-4408-90ee-2571ccc06978",
      "restaurant_name": "Pizzeria Monte Carlo",
      "matchScore": 1
    }
  ],
  "unavailable": [],
  "needsClarification": false,
  "unknownItems": []
}
­čöŹ Debug session updated: {
  intent: [32m'create_order'[39m,
  restaurant: [32m'Callzone'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.85[39m
}
Ôťů SmartIntent Resolved: create_order (0.85) via classic
­čžá [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'create_order'[39m,
  ruleConfidence: [33m0.85[39m,
  llmIntent: [1mnull[22m,
  llmConfidence: [33m0[39m,
  finalIntent: [32m'create_order'[39m,
  finalConfidence: [33m0.85[39m,
  source: [32m'classic'[39m,
  hasRestaurant: [33mfalse[39m,
  restaurantName: [90mundefined[39m,
  hasParsedOrder: [33mtrue[39m,
  parsedOrderDetails: {
    any: [33mtrue[39m,
    groupsCount: [33m3[39m,
    groups: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ]
  }
}
­čöĺ SmartContext: skipping boost (parsedOrder exists)
­čôő Parsed: { dish: [32m'jedn─ů du┼╝─ů pizz─Ö margherita'[39m, restaurant: [1mnull[22m }
­čžá create_order intent detected
Ôťů Using parsedOrder from detectIntent()

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç pizz─Ö marg
herit─Ö do zam├│wienia w Piz
zeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç pizz─Ö margherit─Ö do zam├│wienia w Pizzeria Monte Carlo[22m[39m
Ôťů Matched restaurant: "Callzone" Ôćĺ Callzone

POST /api/brain 200 12997 - 1225.926 ms
[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç pizz─Ö marg
herit─Ö do zam├│wienia w Piz
zeria Monte Carlo[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç pizz─Ö margherit─Ö do zam├│wienia w Pizzeria Monte Carlo[22m[39m
­čöŹ [create_order] Loaded 35 items for validation
­čžá Saved/merged pending order to session: {
  items: [
    {
      id: [32m'e0825375-5306-47c9-9786-cb8ed45884ba'[39m,
      name: [32m'Pizza Margherita 33cm'[39m,
      price_pln: [33m33[39m,
      qty: [33m1[39m
    }
  ],
  restaurant: [32m'Callzone'[39m,
  restaurant_id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
  total: [32m'33.00'[39m
}
Ôťů Pending order saved to session:
   - expectedContext: confirm_order
   - pendingOrder items count: [33m1[39m
   - pendingOrder items: 1x Pizza Margherita 33cm
   - total: 33.00 z┼é
   - items details: [
  {
    "id": "e0825375-5306-47c9-9786-cb8ed45884ba",
    "name": "Pizza Margherita 33cm",
    "price": 33,
    "quantity": 1
  }
]
ÔĆ│ Waiting for user confirmation (expecting "tak", "dodaj", etc.)
ÔÜá´ŞĆ Skipping LLM reply generation (test mode or no key), using replyCore
Ôťů Final response: intent=create_order, confidence=0.9, fallback=false
­čôŽ Final Response Preparation: MenuItems count = 6

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç burgery do zam├│wienia w Klaps Burgers[22m[39m
[brainRouter] ­čÜÇ Handler called

 [32mÔťô[39m api/brain/tests/brainRouter.e2e.test.js[2m > [22m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22mpowinien doda─ç pizz─Ö margherit─Ö do zam├│wienia w Pizzeria Monte Carlo[33m 3353[2mms[22m[39m
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç burgery do zam├│wienia w Klaps Burgers[22m[39m
­čžá [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  text: [32m'Chc─Ö zam├│wi─ç w Klaps Burgers'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_piekary_1766043135688'[39m,
    text: [32m'Chc─Ö zam├│wi─ç w Klaps Burgers'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m28[39m
}
­čžá [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  session: {
    expectedContext: [32m'confirm_order'[39m,
    lastIntent: [32m'create_order'[39m,
    lastRestaurant: {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. Ksi─Ödza Piotra Skargi 3'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary ┼Ťl─ůskie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ┼Ül─ůskie'[39m,
    lastUpdated: [33m1766043148312[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ],
    pendingOrder: { restaurant: [36m[Object][39m, items: [36m[Array][39m, total: [33m33[39m }
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'confirm_order'[39m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Callzone'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ┼Ül─ůskie'[39m,
  hasPendingOrder: [33mtrue[39m,
  lastIntent: [32m'create_order'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m,
    [32m'pendingOrder'[39m
  ]
}
­čžş GeoContext Layer activated for: "Klaps Burgers"

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç burgery do 
zam├│wienia w Klaps Burgers
[22m[39m
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Klaps Burgers"
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Klaps Burgers" ÔÇö k
ontynuuj normalny flow

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç burgery do zam├│wienia w Klaps Burgers[22m[39m
[brainRouter] ­čžá Calling detectIntent with: {
  text: [32m'Chc─Ö zam├│wi─ç w Klaps Burgers'[39m,
  sessionId: [32m'e2e_piekary_1766043135688'[39m
}
[brainRouter] ­čžá Current session: {
  expectedContext: [32m'confirm_order'[39m,
  lastIntent: [32m'create_order'[39m,
  lastRestaurant: {
    id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
    name: [32m'Callzone'[39m,
    address: [32m'ul. Ksi─Ödza Piotra Skargi 3'[39m,
    city: [32m'Piekary ┼Ül─ůskie'[39m,
    lat: [33m50.38594[39m,
    lng: [33m18.95647[39m
  },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary ┼Ťl─ůskie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043136820[39m }
  },
  last_location: [32m'Piekary ┼Ül─ůskie'[39m,
  lastUpdated: [33m1766043148312[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Mi─Ödzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Ameryka┼äska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. Ksi─Ödza Piotra Skargi 3'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'Dw├│r Hubertus'[39m,
      address: [32m'ul. Inwalid├│w Wojennych 72'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'┼Ül─ůska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. Stanis┼éawa Maczka 22'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'e472c234-04d2-4872-a635-761f00f9853c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Brownie'[39m,
      description: [32m'Czekoladowe ciasto z orzechami w┼éoskimi'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m14[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'1a7eeba7-8c23-4fdb-a7c8-fcccbfa0008d'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Capricciosa'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, pieczarki'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m33[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'91088af5-2a2a-4bb3-96af-8907fcd4471e'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Diavola'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, pikantne salami, papryczki jalape├▒o'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m34[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'2346a6d2-4f63-4c47-b217-f752cfa02a9b'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Hawajska'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, ananas'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m32[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'03ce8a1a-be58-407c-87df-48ab33817f5c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Margherita'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, bazylia'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m28[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'8492d2e8-fc47-4381-af16-8ef4e1aa7b04'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Panna Cotta'[39m,
      description: [32m'Z musem truskawkowym'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m15[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    }
  ],
  pendingOrder: {
    restaurant: {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m
    },
    items: [ [36m[Object][39m ],
    total: [33m33[39m
  }
}
­čöČ Starting Smart Intent Layer...
[intent-router] ­čÜÇ detectIntent called with: { text: [32m'Chc─Ö zam├│wi─ç w Klaps Burgers'[39m, sessionId: [90mundefined[39m }
[intent-router] ­čöŹ Starting early dish detection for text: Chc─Ö zam├│wi─ç w Klaps Burgers
[intent-router] ­čöŹ Normalized text: chc─Ö zam├│wi─ç w klaps burgers
[intent-router] ­čöŹ Session restaurant: NONE
[intent-router] ­čöŹ Restaurant indicators in text: true
[intent-router] ­čöŹ Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç burgery do 
zam├│wienia w Klaps Burgers
[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç burgery do zam├│wienia w Klaps Burgers[22m[39m
[intent-router] ­čöŹ Checking 9 restaurants for fuzzy match
[intent-router] ­čĆ¬ Restaurant detected in text (exact): Klaps Burgers
[loadMenuCatalog] ­čöŹ Session: {
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
}
[loadMenuCatalog] ­čöŹ lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[loadMenuCatalog] ­čöŹ lastId: 569a7d29-57be-4224-bdf3-09c483415cea
[loadMenuCatalog] Ôťů Loading menu for restaurant: 569a7d29-57be-4224-bdf3-09c483415cea (Klaps Burgers)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç burgery do 
zam├│wienia w Klaps Burgers
[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç burgery do zam├│wienia w Klaps Burgers[22m[39m
[loadMenuCatalog] Ôťů Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] Ôťů Sample items: Kosmiczne Jaja Double, Wegetrix Double, ┼╗wirek i Muchomorek Standard
[intent-router] Catalog loaded: 21 items
[intent-router] ­čöŹ Calling parseOrderItems...
[intent-router] ­čöŹ Catalog items: Kosmiczne Jaja Double, Wegetrix Double, ┼╗wirek i Muchomorek Standard, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, G┼éodzilla, Kosmiczne Jaja Standard
[parseOrderItems] ­čôŐ Summary:
  - requestedNames: [burger]
  - availableNames: []
  - unavailableNames: [burger]
  - matched.length: 0
  - clarifications.length: 0
[intent-router] Ôťů Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "burger"
  ],
  "needsClarification": true,
  "unknownItems": []
}
[intent-router] ­čöŹ parsed.any = false
[intent-router] ­čöŹ parsed.groups.length = 0
ÔÜá´ŞĆ Unavailable items detected: burger in tym menu
­čöŹ Checking if text contains restaurant name (using cached list): "chc─Ö zam├│wi─ç w klaps burgers"
Ôťů Text contains restaurant name: Klaps Burgers ÔÇö skipping clarify_order
[intent-router] ÔŁî No dishes matched in catalog (parsed.any = false)
[intent-router] ÔŁî Continuing to KROK 4 (targetRestaurant check)...

POST /api/brain 200 13744 - 893.525 ms
[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç burgery do 
zam├│wienia w Klaps Burgers
[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç burgery do zam├│wienia w Klaps Burgers[22m[39m
[intent-router] ­čöŹ KROK 4: Checking targetRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[intent-router] ­čĆ¬ KROK 4: Restaurant found in early detection: Klaps Burgers, checking keywords...
[intent-router] ­čöŹ KROK 4: Lower text: "chce zamowic w klaps burgers"
[intent-router] ­čöŹ KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'poka┼╝ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta da┼ä'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ­čöŹ KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] Ôťů Order keyword found, returning create_order
­čöŹ Debug session updated: {
  intent: [32m'create_order'[39m,
  restaurant: [32m'Klaps Burgers'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}
Ôťů SmartIntent Resolved: create_order (0.00) via classic
­čžá [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'create_order'[39m,
  ruleConfidence: [33m0[39m,
  llmIntent: [1mnull[22m,
  llmConfidence: [33m0[39m,
  finalIntent: [32m'create_order'[39m,
  finalConfidence: [33m0[39m,
  source: [32m'classic'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Klaps Burgers'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
­čžá [DEBUG] Calling boostIntent with: {
  text: [32m'Chc─Ö zam├│wi─ç w Klaps Burgers'[39m,
  hybridIntent: [32m'create_order'[39m,
  confidence: [33m0[39m,
  session: {
    expectedContext: [32m'confirm_order'[39m,
    lastRestaurant: [32m'Callzone'[39m,
    lastIntent: [32m'create_order'[39m
  }
}
­čžá [DEBUG] boostIntent result: {
  originalIntent: [32m'create_order'[39m,
  boostedIntent: [32m'create_order'[39m,
  isContextLocked: [33mfalse[39m
}
­čôő Parsed: { dish: [32m'zam├│wi─ç w Klaps Burgers'[39m, restaurant: [1mnull[22m }
­čöä Context Override: "dodaj" treated as confirm_order (pending order exists)
Ôťů confirm_order intent detected
Ôťů Order committed to cart
ÔÜá´ŞĆ Skipping LLM reply generation (test mode or no key), using replyCore
Ôťů Final response: intent=confirm_order, confidence=0.9, fallback=false
­čôŽ Final Response Preparation: MenuItems count = 6

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç burgery do 
zam├│wienia w Klaps Burgers
[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç burgery do zam├│wienia w Klaps Burgers[22m[39m
[brainRouter] ­čÜÇ Handler called

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç burgery do 
zam├│wienia w Klaps Burgers
[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç burgery do zam├│wienia w Klaps Burgers[22m[39m
­čžá [DEBUG] Handler called with: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  text: [32m'Chc─Ö dwa burgery'[39m,
  method: [32m'POST'[39m,
  body: { sessionId: [32m'e2e_piekary_1766043135688'[39m, text: [32m'Chc─Ö dwa burgery'[39m },
  hasText: [33mtrue[39m,
  textLength: [33m16[39m
}
­čžá [DEBUG] Current session state: {
  sessionId: [32m'e2e_piekary_1766043135688'[39m,
  session: {
    lastIntent: [32m'create_order'[39m,
    lastRestaurant: {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. Ksi─Ödza Piotra Skargi 3'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary ┼Ťl─ůskie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ┼Ül─ůskie'[39m,
    lastUpdated: [33m1766043149685[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ],
    cart: { items: [36m[Array][39m, total: [33m33[39m },
    lastOrder: { restaurant: [36m[Object][39m, items: [36m[Array][39m, total: [33m33[39m }
  },
  hasExpectedContext: [33mfalse[39m,
  expectedContextValue: [90mundefined[39m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Callzone'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ┼Ül─ůskie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'create_order'[39m,
  sessionKeys: [
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m,
    [32m'cart'[39m,
    [32m'lastOrder'[39m
  ]
}
­čžş GeoContext Layer activated for: "Chc"

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç burgery do zam├│wienia w Klaps Burgers[22m[39m
[brainRouter] ­čžá Calling detectIntent with: { text: [32m'Chc─Ö dwa burgery'[39m, sessionId: [32m'e2e_piekary_1766043135688'[39m }
[brainRouter] ­čžá Current session: {
  lastIntent: [32m'create_order'[39m,
  lastRestaurant: {
    id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
    name: [32m'Callzone'[39m,
    address: [32m'ul. Ksi─Ödza Piotra Skargi 3'[39m,
    city: [32m'Piekary ┼Ül─ůskie'[39m,
    lat: [33m50.38594[39m,
    lng: [33m18.95647[39m
  },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary ┼Ťl─ůskie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043136820[39m }
  },
  last_location: [32m'Piekary ┼Ül─ůskie'[39m,
  lastUpdated: [33m1766043149685[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Mi─Ödzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Ameryka┼äska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. Ksi─Ödza Piotra Skargi 3'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'Dw├│r Hubertus'[39m,
      address: [32m'ul. Inwalid├│w Wojennych 72'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'┼Ül─ůska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. Stanis┼éawa Maczka 22'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'e472c234-04d2-4872-a635-761f00f9853c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Brownie'[39m,
      description: [32m'Czekoladowe ciasto z orzechami w┼éoskimi'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m14[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'1a7eeba7-8c23-4fdb-a7c8-fcccbfa0008d'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Capricciosa'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, pieczarki'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m33[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'91088af5-2a2a-4bb3-96af-8907fcd4471e'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Diavola'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, pikantne salami, papryczki jalape├▒o'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m34[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'2346a6d2-4f63-4c47-b217-f752cfa02a9b'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Hawajska'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, szynka, ananas'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m32[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    },
    {
      id: [32m'03ce8a1a-be58-407c-87df-48ab33817f5c'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Margherita'[39m,
      description: [32m'Sos pomidorowy, ser mozzarella, bazylia'[39m,
      category: [32m'Pizza'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m28[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:49:19.136917+00:00'[39m
    },
    {
      id: [32m'8492d2e8-fc47-4381-af16-8ef4e1aa7b04'[39m,
      restaurant_id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Panna Cotta'[39m,
      description: [32m'Z musem truskawkowym'[39m,
      category: [32m'Deser'[39m,
      base_type: [1mnull[22m,
      meat_type: [1mnull[22m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m15[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T14:53:24.683083+00:00'[39m
    }
  ],
  cart: { items: [ [36m[Object][39m ], total: [33m33[39m },
  lastOrder: {
    restaurant: {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m
    },
    items: [ [36m[Object][39m ],
    total: [33m33[39m
  }
}
­čöČ Starting Smart Intent Layer...
[intent-router] ­čÜÇ detectIntent called with: { text: [32m'Chc─Ö dwa burgery'[39m, sessionId: [90mundefined[39m }
[intent-router] ­čöŹ Starting early dish detection for text: Chc─Ö dwa burgery
[intent-router] ­čöŹ Normalized text: chc─Ö dwa burgery
[intent-router] ­čöŹ Session restaurant: NONE
[intent-router] ­čöŹ Restaurant indicators in text: false
[intent-router] ­čöŹ Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç burgery do 
zam├│wienia w Klaps Burgers
[22m[39m
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Chc"
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Chc" ÔÇö kontynuuj n
ormalny flow

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç burgery do 
zam├│wienia w Klaps Burgers
[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç burgery do zam├│wienia w Klaps Burgers[22m[39m
[intent-router] ­čöŹ Checking 9 restaurants for fuzzy match
[intent-router] ­čĆ¬ Restaurant detected in text (fuzzy): Klaps Burgers (matched: 1/2)
[loadMenuCatalog] ­čöŹ Session: {
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
}
[loadMenuCatalog] ­čöŹ lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[loadMenuCatalog] ­čöŹ lastId: 569a7d29-57be-4224-bdf3-09c483415cea
[loadMenuCatalog] Ôťů Loading menu for restaurant: 569a7d29-57be-4224-bdf3-09c483415cea (Klaps Burgers)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç burgery do 
zam├│wienia w Klaps Burgers
[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç burgery do zam├│wienia w Klaps Burgers[22m[39m
[loadMenuCatalog] Ôťů Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] Ôťů Sample items: Kosmiczne Jaja Double, Wegetrix Double, ┼╗wirek i Muchomorek Standard
[intent-router] Catalog loaded: 21 items
[intent-router] ­čöŹ Calling parseOrderItems...
[intent-router] ­čöŹ Catalog items: Kosmiczne Jaja Double, Wegetrix Double, ┼╗wirek i Muchomorek Standard, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, G┼éodzilla, Kosmiczne Jaja Standard
[parseOrderItems] ­čôŐ Summary:
  - requestedNames: [burger]
  - availableNames: []
  - unavailableNames: [burger]
  - matched.length: 0
  - clarifications.length: 0
[intent-router] Ôťů Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "burger"
  ],
  "needsClarification": true,
  "unknownItems": []
}
[intent-router] ­čöŹ parsed.any = false
[intent-router] ­čöŹ parsed.groups.length = 0
ÔÜá´ŞĆ Unavailable items detected: burger in tym menu
­čöŹ Checking if text contains restaurant name (using cached list): "chc─Ö dwa burgery"
Ôťů Text contains restaurant name: Klaps Burgers ÔÇö skipping clarify_order
[intent-router] ÔŁî No dishes matched in catalog (parsed.any = false)
[intent-router] ÔŁî Continuing to KROK 4 (targetRestaurant check)...

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç burgery do 
zam├│wienia w Klaps Burgers
[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç burgery do zam├│wienia w Klaps Burgers[22m[39m
[intent-router] ­čöŹ KROK 4: Checking targetRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[intent-router] ­čĆ¬ KROK 4: Restaurant found in early detection: Klaps Burgers, checking keywords...
[intent-router] ­čöŹ KROK 4: Lower text: "chce dwa burgery"
[intent-router] ­čöŹ KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'poka┼╝ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta da┼ä'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ­čöŹ KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] Ôťů No specific keywords, returning select_restaurant
­čöŹ Debug session updated: {
  intent: [32m'select_restaurant'[39m,
  restaurant: [32m'Klaps Burgers'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç burgery do 
zam├│wienia w Klaps Burgers
[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç burgery do zam├│wienia w Klaps Burgers[22m[39m
Ôťů SmartIntent Resolved: create_order (0.95) via llm
­čžá [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'create_order'[39m,
  ruleConfidence: [33m0.95[39m,
  llmIntent: [32m'create_order'[39m,
  llmConfidence: [33m0.95[39m,
  finalIntent: [32m'create_order'[39m,
  finalConfidence: [33m0.95[39m,
  source: [32m'llm'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Klaps Burgers'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
­čžá [DEBUG] Calling boostIntent with: {
  text: [32m'Chc─Ö dwa burgery'[39m,
  hybridIntent: [32m'create_order'[39m,
  confidence: [33m0.95[39m,
  session: {
    expectedContext: [90mundefined[39m,
    lastRestaurant: [32m'Callzone'[39m,
    lastIntent: [32m'create_order'[39m
  }
}
­čžá [DEBUG] boostIntent result: {
  originalIntent: [32m'create_order'[39m,
  boostedIntent: [32m'create_order'[39m,
  isContextLocked: [33mfalse[39m
}
­čôő Parsed: { dish: [32m'burgery'[39m, restaurant: [1mnull[22m }
­čžá create_order intent detected
Ôťů Restaurant set: Klaps Burgers
­čŤĺ Parsing order items from: "Chc─Ö dwa burgery" with 2-Phase Parsing

POST /api/brain 200 13278 - 3207.888 ms
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22m[2mpowinien doda─ç burgery do zam├│wienia w Klaps Burgers[22m[39m
ÔÜá´ŞĆ Parsed dish "burgery" but not found in menu. Returning unknown_item.
Ôťů Parsed order: [
  {
    id: [32m'unknown_item'[39m,
    name: [32m'burgery'[39m,
    price: [33m0[39m,
    quantity: [33m2[39m,
    isUnknown: [33mtrue[39m
  }
]
Ôťů Pending order saved to session (fallback path):
   - expectedContext: confirm_order
   - pendingOrder items count: [33m1[39m
   - pendingOrder items: 2x burgery
   - total: 0.00 z┼é
   - items details: [
  {
    "id": "unknown_item",
    "name": "burgery",
    "price": 0,
    "quantity": 2,
    "isUnknown": true
  }
]
ÔĆ│ Waiting for user confirmation (expecting "tak", "dodaj", etc.)
ÔÜá´ŞĆ Skipping LLM reply generation (test mode or no key), using replyCore
Ôťů Final response: intent=create_order, confidence=0.9, fallback=false
­čôŽ Final Response Preparation: MenuItems count = 6

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mC. Int
ent create_order (Z┼éo┼╝enie
 zam├│wienia)[2m > [22m[2
mpowinien doda─ç burgery do 
zam├│wienia w Klaps Burgers
[22m[39m
ÔÜá´ŞĆ No match for dish: "b
urgery"

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
[brainRouter] ­čÜÇ Handler called

 [32mÔťô[39m api/brain/tests/brainRouter.e2e.test.js[2m > [22m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22mC. Intent create_order (Z┼éo┼╝enie zam├│wienia)[2m > [22mpowinien doda─ç burgery do zam├│wienia w Klaps Burgers[33m 4113[2mms[22m[39m
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
­čžá [DEBUG] Handler called with: {
  sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m,
  text: [32m'Poka┼╝ restauracje w Piekarach ┼Ül─ůskich'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m,
    text: [32m'Poka┼╝ restauracje w Piekarach ┼Ül─ůskich'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m38[39m
}
­čžá [DEBUG] Current session state: {
  sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m,
  session: {
    expectedContext: [32m'neutral'[39m,
    lastIntent: [1mnull[22m,
    lastRestaurant: [1mnull[22m,
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: []
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'neutral'[39m,
  hasLastRestaurant: [33mfalse[39m,
  lastRestaurantName: [90mundefined[39m,
  hasLastLocation: [33mfalse[39m,
  lastLocation: [90mundefined[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [1mnull[22m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m
  ]
}
­čžş GeoContext Layer activated for: "Piekary ┼Ül─ůskie"

POST /api/brain 200 5715 - 318.070 ms
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
­čŚ║´ŞĆ Found 9 restaurants in "Piekary ┼Ül─ůskie"
­čĺż Cache SAVED for location: "Piekary ┼Ül─ůskie"
­čÜÇ GeoContext: Direct request detected -> Skipping confirmation

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
[brainRouter] ­čÜÇ Handler called

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
­čžá [DEBUG] Handler called with: {
  sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m,
  text: [32m'Wybierz Klaps Burgers'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m,
    text: [32m'Wybierz Klaps Burgers'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m21[39m
}
­čžá [DEBUG] Current session state: {
  sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m,
  session: {
    expectedContext: [32m'select_restaurant'[39m,
    lastIntent: [32m'find_nearby'[39m,
    lastRestaurant: [1mnull[22m,
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary ┼Ťl─ůskie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ┼Ül─ůskie'[39m,
    lastUpdated: [33m1766043153225[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ]
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'select_restaurant'[39m,
  hasLastRestaurant: [33mfalse[39m,
  lastRestaurantName: [90mundefined[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ┼Ül─ůskie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'find_nearby'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m
  ]
}
­čžş GeoContext Layer activated for: "Wybierz Klaps Burgers"

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 1 (burger o
g├│lny): powinien obs┼éu┼╝y─
ç "Chc─Ö burgery" po wyborze
 Klaps Burgers[22m[39m
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Wybierz Klaps Burger
s"
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Wybierz Klaps Burger
s" ÔÇö kontynuuj normalny fl
ow

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
[brainRouter] ­čžá Calling detectIntent with: {
  text: [32m'Wybierz Klaps Burgers'[39m,
  sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m
}
[brainRouter] ­čžá Current session: {
  expectedContext: [32m'select_restaurant'[39m,
  lastIntent: [32m'find_nearby'[39m,
  lastRestaurant: [1mnull[22m,
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary ┼Ťl─ůskie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043153058[39m }
  },
  last_location: [32m'Piekary ┼Ül─ůskie'[39m,
  lastUpdated: [33m1766043153225[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Mi─Ödzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Ameryka┼äska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. Ksi─Ödza Piotra Skargi 3'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'Dw├│r Hubertus'[39m,
      address: [32m'ul. Inwalid├│w Wojennych 72'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'┼Ül─ůska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. Stanis┼éawa Maczka 22'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ]
}
­čöČ Starting Smart Intent Layer...
[intent-router] ­čÜÇ detectIntent called with: { text: [32m'Wybierz Klaps Burgers'[39m, sessionId: [90mundefined[39m }
[intent-router] ­čöŹ Starting early dish detection for text: Wybierz Klaps Burgers
[intent-router] ­čöŹ Normalized text: wybierz klaps burgers
[intent-router] ­čöŹ Session restaurant: NONE
[intent-router] ­čöŹ Restaurant indicators in text: false
[intent-router] ­čöŹ Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 1 (burger o
g├│lny): powinien obs┼éu┼╝y─
ç "Chc─Ö burgery" po wyborze
 Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
[intent-router] ­čöŹ Checking 9 restaurants for fuzzy match
[intent-router] ­čĆ¬ Restaurant detected in text (exact): Klaps Burgers
[loadMenuCatalog] ­čöŹ Session: {
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
}
[loadMenuCatalog] ­čöŹ lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[loadMenuCatalog] ­čöŹ lastId: 569a7d29-57be-4224-bdf3-09c483415cea
[loadMenuCatalog] Ôťů Loading menu for restaurant: 569a7d29-57be-4224-bdf3-09c483415cea (Klaps Burgers)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 1 (burger o
g├│lny): powinien obs┼éu┼╝y─
ç "Chc─Ö burgery" po wyborze
 Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
[loadMenuCatalog] Ôťů Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] Ôťů Sample items: Kosmiczne Jaja Double, Wegetrix Double, ┼╗wirek i Muchomorek Standard
[intent-router] Catalog loaded: 21 items
[intent-router] ­čöŹ Calling parseOrderItems...
[intent-router] ­čöŹ Catalog items: Kosmiczne Jaja Double, Wegetrix Double, ┼╗wirek i Muchomorek Standard, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, G┼éodzilla, Kosmiczne Jaja Standard
[parseOrderItems] ­čôŐ Summary:
  - requestedNames: [burger]
  - availableNames: []
  - unavailableNames: [burger]
  - matched.length: 0
  - clarifications.length: 0
[intent-router] Ôťů Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "burger"
  ],
  "needsClarification": true,
  "unknownItems": []
}
[intent-router] ­čöŹ parsed.any = false
[intent-router] ­čöŹ parsed.groups.length = 0
ÔÜá´ŞĆ Unavailable items detected: burger in tym menu
­čöŹ Checking if text contains restaurant name (using cached list): "wybierz klaps burgers"
Ôťů Text contains restaurant name: Klaps Burgers ÔÇö skipping clarify_order
[intent-router] ÔŁî No dishes matched in catalog (parsed.any = false)
[intent-router] ÔŁî Continuing to KROK 4 (targetRestaurant check)...

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 1 (burger o
g├│lny): powinien obs┼éu┼╝y─
ç "Chc─Ö burgery" po wyborze
 Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
[intent-router] ­čöŹ KROK 4: Checking targetRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[intent-router] ­čĆ¬ KROK 4: Restaurant found in early detection: Klaps Burgers, checking keywords...
[intent-router] ­čöŹ KROK 4: Lower text: "wybierz klaps burgers"
[intent-router] ­čöŹ KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'poka┼╝ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta da┼ä'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ­čöŹ KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] Ôťů No specific keywords, returning select_restaurant
­čöŹ Debug session updated: {
  intent: [32m'select_restaurant'[39m,
  restaurant: [32m'Klaps Burgers'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}
Ôťů SmartIntent Resolved: select_restaurant (0.00) via classic
­čžá [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'select_restaurant'[39m,
  ruleConfidence: [33m0[39m,
  llmIntent: [1mnull[22m,
  llmConfidence: [33m0[39m,
  finalIntent: [32m'select_restaurant'[39m,
  finalConfidence: [33m0[39m,
  source: [32m'classic'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Klaps Burgers'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
­čžá [DEBUG] Calling boostIntent with: {
  text: [32m'Wybierz Klaps Burgers'[39m,
  hybridIntent: [32m'select_restaurant'[39m,
  confidence: [33m0[39m,
  session: {
    expectedContext: [32m'select_restaurant'[39m,
    lastRestaurant: [90mundefined[39m,
    lastIntent: [32m'find_nearby'[39m
  }
}
­čžá [DEBUG] boostIntent result: {
  originalIntent: [32m'select_restaurant'[39m,
  boostedIntent: [32m'select_restaurant'[39m,
  isContextLocked: [33mfalse[39m
}
­čôő Parsed: { dish: [1mnull[22m, restaurant: [32m'Klaps Burgers'[39m }
­čžá select_restaurant intent detected
­čžá Hybrid Selection: no match (method: none)
Ôťů Using restaurant from detectIntent: Klaps Burgers
Ôťů Auto-showing menu for: Klaps Burgers

POST /api/brain 200 13708 - 927.153 ms
[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 1 (burger o
g├│lny): powinien obs┼éu┼╝y─
ç "Chc─Ö burgery" po wyborze
 Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
ÔÜá´ŞĆ Skipping LLM reply generation (test mode or no key), using replyCore
Ôťů Final response: intent=select_restaurant, confidence=0.9, fallback=false
­čôŽ Final Response Preparation: MenuItems count = 6

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 1 (burger o
g├│lny): powinien obs┼éu┼╝y─
ç "Chc─Ö burgery" po wyborze
 Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
[brainRouter] ­čÜÇ Handler called

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 1 (burger o
g├│lny): powinien obs┼éu┼╝y─
ç "Chc─Ö burgery" po wyborze
 Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
­čžá [DEBUG] Handler called with: {
  sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m,
  text: [32m'Chc─Ö burgery'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m,
    text: [32m'Chc─Ö burgery'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m12[39m
}
­čžá [DEBUG] Current session state: {
  sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastIntent: [32m'select_restaurant'[39m,
    lastRestaurant: {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary ┼Ťl─ůskie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ┼Ül─ůskie'[39m,
    lastUpdated: [33m1766043154037[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ]
  },
  hasExpectedContext: [33mfalse[39m,
  expectedContextValue: [1mnull[22m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Klaps Burgers'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ┼Ül─ůskie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'select_restaurant'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m
  ]
}
­čžş GeoContext Layer activated for: "Chc"

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
[brainRouter] ­čžá Calling detectIntent with: { text: [32m'Chc─Ö burgery'[39m, sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m }
[brainRouter] ­čžá Current session: {
  expectedContext: [1mnull[22m,
  lastIntent: [32m'select_restaurant'[39m,
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary ┼Ťl─ůskie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043153058[39m }
  },
  last_location: [32m'Piekary ┼Ül─ůskie'[39m,
  lastUpdated: [33m1766043154037[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Mi─Ödzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Ameryka┼äska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. Ksi─Ödza Piotra Skargi 3'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'Dw├│r Hubertus'[39m,
      address: [32m'ul. Inwalid├│w Wojennych 72'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'┼Ül─ůska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. Stanis┼éawa Maczka 22'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'a1a67286-2aaf-4cb7-ae05-50573652391c'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Double'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 400g, ser cheddar, sa┼éata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m46[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'009797c9-808b-4b8a-89b4-79d8d9ece27a'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Standard'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 200g, ser cheddar, sa┼éata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m36[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'fecf6c54-17f4-4bb6-8a50-6a5944a11728'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'G┼éodzilla'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, 100% wo┼éowina 200g, grillowany boczek, ser camembert, nachos, papryka, sa┼éata rzymska, czerwona cebula, sos mango, czosnek'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m59[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'108af5f7-ea9e-46f2-8d06-d7837e181dce'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Grzybiarz z Piekaryhill'[39m,
      description: [32m'Bu┼éka, wo┼éowina, boczek, majonez, sa┼éata, marynowana cebula, ser cheddar, grzyby, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m40[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'b5bde246-f3e9-4854-8bcf-c60787647ca0'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Double'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 400g, ser cheddar, grillowana dynia w pomara┼äczy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m49[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'c6b011fa-882d-4894-a84f-9a41acae5dbc'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Standard'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 200g, ser cheddar, grillowana dynia w pomara┼äczy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m39[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    }
  ]
}
­čöČ Starting Smart Intent Layer...
[intent-router] ­čÜÇ detectIntent called with: { text: [32m'Chc─Ö burgery'[39m, sessionId: [90mundefined[39m }
[intent-router] ­čöŹ Starting early dish detection for text: Chc─Ö burgery
[intent-router] ­čöŹ Normalized text: chc─Ö burgery
[intent-router] ­čöŹ Session restaurant: NONE
[intent-router] ­čöŹ Restaurant indicators in text: false
[intent-router] ­čöŹ Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 1 (burger o
g├│lny): powinien obs┼éu┼╝y─
ç "Chc─Ö burgery" po wyborze
 Klaps Burgers[22m[39m
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Chc"
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Chc" ÔÇö kontynuuj n
ormalny flow

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 1 (burger o
g├│lny): powinien obs┼éu┼╝y─
ç "Chc─Ö burgery" po wyborze
 Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
[intent-router] ­čöŹ Checking 9 restaurants for fuzzy match
[intent-router] ­čĆ¬ Restaurant detected in text (fuzzy): Klaps Burgers (matched: 1/2)
[loadMenuCatalog] ­čöŹ Session: {
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
}
[loadMenuCatalog] ­čöŹ lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[loadMenuCatalog] ­čöŹ lastId: 569a7d29-57be-4224-bdf3-09c483415cea
[loadMenuCatalog] Ôťů Loading menu for restaurant: 569a7d29-57be-4224-bdf3-09c483415cea (Klaps Burgers)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 1 (burger o
g├│lny): powinien obs┼éu┼╝y─
ç "Chc─Ö burgery" po wyborze
 Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
[loadMenuCatalog] Ôťů Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] Ôťů Sample items: Kosmiczne Jaja Double, Wegetrix Double, ┼╗wirek i Muchomorek Standard
[intent-router] Catalog loaded: 21 items
[intent-router] ­čöŹ Calling parseOrderItems...
[intent-router] ­čöŹ Catalog items: Kosmiczne Jaja Double, Wegetrix Double, ┼╗wirek i Muchomorek Standard, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, G┼éodzilla, Kosmiczne Jaja Standard
[parseOrderItems] ­čôŐ Summary:
  - requestedNames: [burger]
  - availableNames: []
  - unavailableNames: [burger]
  - matched.length: 0
  - clarifications.length: 0
[intent-router] Ôťů Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "burger"
  ],
  "needsClarification": true,
  "unknownItems": []
}
[intent-router] ­čöŹ parsed.any = false
[intent-router] ­čöŹ parsed.groups.length = 0
ÔÜá´ŞĆ Unavailable items detected: burger in tym menu
­čöŹ Checking if text contains restaurant name (using cached list): "chc─Ö burgery"
Ôťů Text contains restaurant name: Klaps Burgers ÔÇö skipping clarify_order
[intent-router] ÔŁî No dishes matched in catalog (parsed.any = false)
[intent-router] ÔŁî Continuing to KROK 4 (targetRestaurant check)...

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 1 (burger o
g├│lny): powinien obs┼éu┼╝y─
ç "Chc─Ö burgery" po wyborze
 Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
[intent-router] ­čöŹ KROK 4: Checking targetRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[intent-router] ­čĆ¬ KROK 4: Restaurant found in early detection: Klaps Burgers, checking keywords...
[intent-router] ­čöŹ KROK 4: Lower text: "chce burgery"
[intent-router] ­čöŹ KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'poka┼╝ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta da┼ä'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ­čöŹ KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] Ôťů No specific keywords, returning select_restaurant
­čöŹ Debug session updated: {
  intent: [32m'select_restaurant'[39m,
  restaurant: [32m'Klaps Burgers'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 1 (burger o
g├│lny): powinien obs┼éu┼╝y─
ç "Chc─Ö burgery" po wyborze
 Klaps Burgers[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
Ôťů SmartIntent Resolved: create_order (0.90) via llm
­čžá [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'create_order'[39m,
  ruleConfidence: [33m0.9[39m,
  llmIntent: [32m'create_order'[39m,
  llmConfidence: [33m0.9[39m,
  finalIntent: [32m'create_order'[39m,
  finalConfidence: [33m0.9[39m,
  source: [32m'llm'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Klaps Burgers'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
­čžá [DEBUG] Calling boostIntent with: {
  text: [32m'Chc─Ö burgery'[39m,
  hybridIntent: [32m'create_order'[39m,
  confidence: [33m0.9[39m,
  session: {
    expectedContext: [1mnull[22m,
    lastRestaurant: [32m'Klaps Burgers'[39m,
    lastIntent: [32m'select_restaurant'[39m
  }
}
­čžá [DEBUG] boostIntent result: {
  originalIntent: [32m'create_order'[39m,
  boostedIntent: [32m'create_order'[39m,
  isContextLocked: [33mfalse[39m
}
­čôő Parsed: { dish: [32m'burgery'[39m, restaurant: [1mnull[22m }
­čžá create_order intent detected
Ôťů Restaurant set: Klaps Burgers
­čŤĺ Parsing order items from: "Chc─Ö burgery" with 2-Phase Parsing

POST /api/brain 200 13963 - 2344.151 ms
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[22m[39m
ÔÜá´ŞĆ Parsed dish "burgery" but not found in menu. Returning unknown_item.
Ôťů Parsed order: [
  {
    id: [32m'unknown_item'[39m,
    name: [32m'burgery'[39m,
    price: [33m0[39m,
    quantity: [33m1[39m,
    isUnknown: [33mtrue[39m
  }
]
Ôťů Pending order saved to session (fallback path):
   - expectedContext: confirm_order
   - pendingOrder items count: [33m1[39m
   - pendingOrder items: 1x burgery
   - total: 0.00 z┼é
   - items details: [
  {
[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 1 (burger o
g├│lny): powinien obs┼éu┼╝y─
ç "Chc─Ö burgery" po wyborze
 Klaps Burgers[22m[39m
ÔÜá´ŞĆ No match for dish: "b
urgery"

    "id": "unknown_item",
    "name": "burgery",
    "price": 0,
    "quantity": 1,
    "isUnknown": true
  }
]
ÔĆ│ Waiting for user confirmation (expecting "tak", "dodaj", etc.)
ÔÜá´ŞĆ Skipping LLM reply generation (test mode or no key), using replyCore
Ôťů Final response: intent=create_order, confidence=0.9, fallback=false
­čôŽ Final Response Preparation: MenuItems count = 6

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowa─ç "burgera Vegas" do "Smak Vegas"[22m[39m
[brainRouter] ­čÜÇ Handler called

 [31m├Ś[39m api/brain/tests/brainRouter.e2e.test.js[2m > [22m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22mTest 1 (burger og├│lny): powinien obs┼éu┼╝y─ç "Chc─Ö burgery" po wyborze Klaps Burgers[33m 3605[2mms[22m[39m
[31m   Ôćĺ expected 'rozumiem: 1x burgery (0.00 z┼é). razemÔÇŽ' to match /desperado|fiction|serano|halloween|g┼éÔÇŽ/[39m
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowa─ç "burgera Vegas" do "Smak Vegas"[22m[39m
­čžá [DEBUG] Handler called with: {
  sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m,
  text: [32m'Poprosz─Ö burgera Vegas'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m,
    text: [32m'Poprosz─Ö burgera Vegas'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m22[39m
}
­čžá [DEBUG] Current session state: {
  sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m,
  session: {
    expectedContext: [32m'confirm_order'[39m,
    lastIntent: [32m'create_order'[39m,
    lastRestaurant: {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary ┼Ťl─ůskie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ┼Ül─ůskie'[39m,
    lastUpdated: [33m1766043156085[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ],
    pendingOrder: { restaurant: [36m[Object][39m, items: [36m[Array][39m, total: [33m0[39m }
  },
  hasExpectedContext: [33mtrue[39m,
  expectedContextValue: [32m'confirm_order'[39m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Klaps Burgers'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ┼Ül─ůskie'[39m,
  hasPendingOrder: [33mtrue[39m,
  lastIntent: [32m'create_order'[39m,
  sessionKeys: [
    [32m'expectedContext'[39m,
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m,
    [32m'pendingOrder'[39m
  ]
}
­čžş GeoContext Layer activated for: "Vegas"

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 2 (konkretn
y burger z aliasem): powinie
n dopasowa─ç "burgera Vegas"
 do "Smak Vegas"[22m[39m
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Vegas"
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Vegas" ÔÇö kontynuuj
 normalny flow

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowa─ç "burgera Vegas" do "Smak Vegas"[22m[39m
[brainRouter] ­čžá Calling detectIntent with: {
  text: [32m'Poprosz─Ö burgera Vegas'[39m,
  sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m
}
[brainRouter] ­čžá Current session: {
  expectedContext: [32m'confirm_order'[39m,
  lastIntent: [32m'create_order'[39m,
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary ┼Ťl─ůskie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043153058[39m }
  },
  last_location: [32m'Piekary ┼Ül─ůskie'[39m,
  lastUpdated: [33m1766043156085[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Mi─Ödzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Ameryka┼äska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. Ksi─Ödza Piotra Skargi 3'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'Dw├│r Hubertus'[39m,
      address: [32m'ul. Inwalid├│w Wojennych 72'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'┼Ül─ůska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. Stanis┼éawa Maczka 22'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'a1a67286-2aaf-4cb7-ae05-50573652391c'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Double'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 400g, ser cheddar, sa┼éata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m46[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'009797c9-808b-4b8a-89b4-79d8d9ece27a'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Standard'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 200g, ser cheddar, sa┼éata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m36[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'fecf6c54-17f4-4bb6-8a50-6a5944a11728'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'G┼éodzilla'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, 100% wo┼éowina 200g, grillowany boczek, ser camembert, nachos, papryka, sa┼éata rzymska, czerwona cebula, sos mango, czosnek'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m59[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'108af5f7-ea9e-46f2-8d06-d7837e181dce'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Grzybiarz z Piekaryhill'[39m,
      description: [32m'Bu┼éka, wo┼éowina, boczek, majonez, sa┼éata, marynowana cebula, ser cheddar, grzyby, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m40[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'b5bde246-f3e9-4854-8bcf-c60787647ca0'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Double'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 400g, ser cheddar, grillowana dynia w pomara┼äczy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m49[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'c6b011fa-882d-4894-a84f-9a41acae5dbc'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Standard'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 200g, ser cheddar, grillowana dynia w pomara┼äczy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m39[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    }
  ],
  pendingOrder: {
    restaurant: {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      city: [90mundefined[39m
    },
    items: [ [36m[Object][39m ],
    total: [33m0[39m
  }
}
­čöČ Starting Smart Intent Layer...
[intent-router] ­čÜÇ detectIntent called with: { text: [32m'Poprosz─Ö burgera Vegas'[39m, sessionId: [90mundefined[39m }
[intent-router] ­čöŹ Starting early dish detection for text: Poprosz─Ö burgera Vegas
[intent-router] ­čöŹ Normalized text: poprosz─Ö burgera vegas
[intent-router] ­čöŹ Session restaurant: NONE
[intent-router] ­čöŹ Restaurant indicators in text: false
[intent-router] ­čöŹ Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 2 (konkretn
y burger z aliasem): powinie
n dopasowa─ç "burgera Vegas"
 do "Smak Vegas"[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowa─ç "burgera Vegas" do "Smak Vegas"[22m[39m
[intent-router] ­čöŹ Checking 9 restaurants for fuzzy match
[intent-router] ­čĆ¬ Restaurant detected in text (fuzzy): Klaps Burgers (matched: 1/2)
[loadMenuCatalog] ­čöŹ Session: {
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
}
[loadMenuCatalog] ­čöŹ lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[loadMenuCatalog] ­čöŹ lastId: 569a7d29-57be-4224-bdf3-09c483415cea
[loadMenuCatalog] Ôťů Loading menu for restaurant: 569a7d29-57be-4224-bdf3-09c483415cea (Klaps Burgers)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 2 (konkretn
y burger z aliasem): powinie
n dopasowa─ç "burgera Vegas"
 do "Smak Vegas"[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowa─ç "burgera Vegas" do "Smak Vegas"[22m[39m
[loadMenuCatalog] Ôťů Loaded 21 menu items from 1 restaurants
[loadMenuCatalog] Ôťů Sample items: Kosmiczne Jaja Double, Wegetrix Double, ┼╗wirek i Muchomorek Standard
[intent-router] Catalog loaded: 21 items
[intent-router] ­čöŹ Calling parseOrderItems...
[intent-router] ­čöŹ Catalog items: Kosmiczne Jaja Double, Wegetrix Double, ┼╗wirek i Muchomorek Standard, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, G┼éodzilla, Kosmiczne Jaja Standard
[parseOrderItems] ­čôŐ Summary:
  - requestedNames: [burger]
  - availableNames: []
  - unavailableNames: [burger]
  - matched.length: 0
  - clarifications.length: 0
[intent-router] Ôťů Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [
    "burger"
  ],
  "needsClarification": true,
  "unknownItems": []
}
[intent-router] ­čöŹ parsed.any = false
[intent-router] ­čöŹ parsed.groups.length = 0
ÔÜá´ŞĆ Unavailable items detected: burger in tym menu
­čöŹ Checking if text contains restaurant name (using cached list): "poprosz─Ö burgera vegas"
Ôťů Text contains restaurant name: Klaps Burgers ÔÇö skipping clarify_order
[intent-router] ÔŁî No dishes matched in catalog (parsed.any = false)
[intent-router] ÔŁî Continuing to KROK 4 (targetRestaurant check)...

POST /api/brain 200 14474 - 946.427 ms
[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 2 (konkretn
y burger z aliasem): powinie
n dopasowa─ç "burgera Vegas"
 do "Smak Vegas"[22m[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 2 (konkretny burger z aliasem): powinien dopasowa─ç "burgera Vegas" do "Smak Vegas"[22m[39m
[intent-router] ­čöŹ KROK 4: Checking targetRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m }
[intent-router] ­čĆ¬ KROK 4: Restaurant found in early detection: Klaps Burgers, checking keywords...
[intent-router] ­čöŹ KROK 4: Lower text: "poprosze burgera vegas"
[intent-router] ­čöŹ KROK 4: Menu keywords: [
  [32m'menu'[39m,             [32m'co moge zjesc'[39m,
  [32m'co maja'[39m,          [32m'pokaz menu'[39m,
  [32m'poka┼╝ menu'[39m,       [32m'co jest w menu'[39m,
  [32m'dania'[39m,            [32m'potrawy'[39m,
  [32m'co serwuja'[39m,       [32m'co podaja'[39m,
  [32m'karta dan'[39m,        [32m'karta da┼ä'[39m,
  [32m'co jest dostepne'[39m, [32m'co dostepne'[39m,
  [32m'co maja w menu'[39m
]
[intent-router] ­čöŹ KROK 4: Order keywords: [
  [32m'zamow'[39m,
  [32m'poprosze'[39m,
  [32m'prosze'[39m,
  [32m'chce zamowic'[39m,
  [32m'zloz zamowienie'[39m,
  [32m'zamowic cos'[39m,
  [32m'dodaj do zamowienia'[39m,
  [32m'zloz'[39m,
  [32m'wybieram'[39m,
  [32m'biore'[39m,
  [32m'wezme'[39m
]
[intent-router] Ôťů Order keyword found, returning create_order
­čöŹ Debug session updated: {
  intent: [32m'create_order'[39m,
  restaurant: [32m'Klaps Burgers'[39m,
  sessionId: [1mnull[22m,
  confidence: [33m0.9[39m
}
Ôťů SmartIntent Resolved: create_order (0.00) via classic
­čžá [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'create_order'[39m,
  ruleConfidence: [33m0[39m,
  llmIntent: [1mnull[22m,
  llmConfidence: [33m0[39m,
  finalIntent: [32m'create_order'[39m,
  finalConfidence: [33m0[39m,
  source: [32m'classic'[39m,
  hasRestaurant: [33mtrue[39m,
  restaurantName: [32m'Klaps Burgers'[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
­čžá [DEBUG] Calling boostIntent with: {
  text: [32m'Poprosz─Ö burgera Vegas'[39m,
  hybridIntent: [32m'create_order'[39m,
  confidence: [33m0[39m,
  session: {
    expectedContext: [32m'confirm_order'[39m,
    lastRestaurant: [32m'Klaps Burgers'[39m,
    lastIntent: [32m'create_order'[39m
  }
}
­čžá [DEBUG] boostIntent result: {
  originalIntent: [32m'create_order'[39m,
  boostedIntent: [32m'create_order'[39m,
  isContextLocked: [33mfalse[39m
}
­čôő Parsed: { dish: [32m'burgera Vegas'[39m, restaurant: [1mnull[22m }
­čöä Context Override: "dodaj" treated as confirm_order (pending order exists)
Ôťů confirm_order intent detected
Ôťů Order committed to cart
ÔÜá´ŞĆ Skipping LLM reply generation (test mode or no key), using replyCore
Ôťů Final response: intent=confirm_order, confidence=0.9, fallback=false
­čôŽ Final Response Preparation: MenuItems count = 6

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (nap├│j): powinien doda─ç nap├│j do zam├│wienia (np. Pepsi)[22m[39m
[brainRouter] ­čÜÇ Handler called

 [31m├Ś[39m api/brain/tests/brainRouter.e2e.test.js[2m > [22m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22mTest 2 (konkretny burger z aliasem): powinien dopasowa─ç "burgera Vegas" do "Smak Vegas"[33m 952[2mms[22m[39m
[31m   Ôćĺ expected 'confirm_order' to be 'create_order' // Object.is equality[39m
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (nap├│j): powinien doda─ç nap├│j do zam├│wienia (np. Pepsi)[22m[39m
­čžá [DEBUG] Handler called with: {
  sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m,
  text: [32m'Poprosz─Ö dwie pepsi'[39m,
  method: [32m'POST'[39m,
  body: {
    sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m,
    text: [32m'Poprosz─Ö dwie pepsi'[39m
  },
  hasText: [33mtrue[39m,
  textLength: [33m19[39m
}
­čžá [DEBUG] Current session state: {
  sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m,
  session: {
    lastIntent: [32m'create_order'[39m,
    lastRestaurant: {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m
    },
    lastRestaurantsList: [],
    lastRestaurants: [],
    lastRestaurantsTimestamp: [1mnull[22m,
    lastMenu: [],
    locationOverride: [1mnull[22m,
    history: [],
    locationCache: { [32m'piekary ┼Ťl─ůskie_all'[39m: [36m[Object][39m },
    last_location: [32m'Piekary ┼Ül─ůskie'[39m,
    lastUpdated: [33m1766043157457[39m,
    last_restaurants_list: [
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m, [36m[Object][39m,
      [36m[Object][39m
    ],
    last_menu: [ [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m, [36m[Object][39m ],
    cart: { items: [36m[Array][39m, total: [33m0[39m },
    lastOrder: { restaurant: [36m[Object][39m, items: [36m[Array][39m, total: [33m0[39m }
  },
  hasExpectedContext: [33mfalse[39m,
  expectedContextValue: [90mundefined[39m,
  hasLastRestaurant: [33mtrue[39m,
  lastRestaurantName: [32m'Klaps Burgers'[39m,
  hasLastLocation: [33mtrue[39m,
  lastLocation: [32m'Piekary ┼Ül─ůskie'[39m,
  hasPendingOrder: [33mfalse[39m,
  lastIntent: [32m'create_order'[39m,
  sessionKeys: [
    [32m'lastIntent'[39m,
    [32m'lastRestaurant'[39m,
    [32m'lastRestaurantsList'[39m,
    [32m'lastRestaurants'[39m,
    [32m'lastRestaurantsTimestamp'[39m,
    [32m'lastMenu'[39m,
    [32m'locationOverride'[39m,
    [32m'history'[39m,
    [32m'locationCache'[39m,
    [32m'last_location'[39m,
    [32m'lastUpdated'[39m,
    [32m'last_restaurants_list'[39m,
    [32m'last_menu'[39m,
    [32m'cart'[39m,
    [32m'lastOrder'[39m
  ]
}
­čžş GeoContext Layer activated for: "Poprosz"

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 3 (nap├│j):
 powinien doda─ç nap├│j do z
am├│wienia (np. Pepsi)[22m
[39m
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Poprosz"
ÔÜÖ´ŞĆ GeoContext: brak wyni
k├│w w "Poprosz" ÔÇö kontynu
uj normalny flow

[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (nap├│j): powinien doda─ç nap├│j do zam├│wienia (np. Pepsi)[22m[39m
[brainRouter] ­čžá Calling detectIntent with: {
  text: [32m'Poprosz─Ö dwie pepsi'[39m,
  sessionId: [32m'e2e_klaps_cascade_1766043152903'[39m
}
[brainRouter] ­čžá Current session: {
  lastIntent: [32m'create_order'[39m,
  lastRestaurant: { id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m, name: [32m'Klaps Burgers'[39m },
  lastRestaurantsList: [],
  lastRestaurants: [],
  lastRestaurantsTimestamp: [1mnull[22m,
  lastMenu: [],
  locationOverride: [1mnull[22m,
  history: [],
  locationCache: {
    [32m'piekary ┼Ťl─ůskie_all'[39m: { data: [36m[Array][39m, timestamp: [33m1766043153058[39m }
  },
  last_location: [32m'Piekary ┼Ül─ůskie'[39m,
  lastUpdated: [33m1766043157457[39m,
  last_restaurants_list: [
    {
      id: [32m'1fc1e782-bac6-47b2-978a-f6f2b38000cd'[39m,
      name: [32m'Restauracja Stara Kamienica'[39m,
      address: [32m'ul. Bytomska 61'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Polska'[39m,
      lat: [33m50.3856[39m,
      lng: [33m18.94886[39m
    },
    {
      id: [32m'4d27fbe3-20d0-4eb4-b003-1935be53af25'[39m,
      name: [32m'Rezydencja Luxury Hotel'[39m,
      address: [32m'ul. Stara 1'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Mi─Ödzynarodowa'[39m,
      lat: [33m50.39352[39m,
      lng: [33m18.94742[39m
    },
    {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      address: [32m'ul. Piotra Skargi 15'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Ameryka┼äska'[39m,
      lat: [33m50.38643[39m,
      lng: [33m18.95422[39m
    },
    {
      id: [32m'70842598-1632-43f6-8015-706d5adf182f'[39m,
      name: [32m'Vien-Thien'[39m,
      address: [32m'ul. Diamentowa 4'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Wietnamska'[39m,
      lat: [33m50.39883[39m,
      lng: [33m18.95574[39m
    },
    {
      id: [32m'8b00b05e-72f7-4a5f-b50c-5630a75d6312'[39m,
      name: [32m'Bar Praha'[39m,
      address: [32m'ul. Bytomska 139'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Czeska / Polska'[39m,
      lat: [33m50.38807[39m,
      lng: [33m18.93657[39m
    },
    {
      id: [32m'bd9f2244-7618-4071-aa96-52616a7b4c70'[39m,
      name: [32m'Callzone'[39m,
      address: [32m'ul. Ksi─Ödza Piotra Skargi 3'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Pizzeria'[39m,
      lat: [33m50.38594[39m,
      lng: [33m18.95647[39m
    },
    {
      id: [32m'af8448ef-974b-46c8-a4ae-b04b8dc7c9f8'[39m,
      name: [32m'Dw├│r Hubertus'[39m,
      address: [32m'ul. Inwalid├│w Wojennych 72'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'┼Ül─ůska / Europejska'[39m,
      lat: [33m50.39233[39m,
      lng: [33m18.94243[39m
    },
    {
      id: [32m'fc844513-2869-4f42-b04f-c21e1e4cceb7'[39m,
      name: [32m'Tasty King Kebab'[39m,
      address: [32m'ul. Bytomska 70'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [32m'Kebab'[39m,
      lat: [33m50.38587[39m,
      lng: [33m18.94712[39m
    },
    {
      id: [32m'83566974-1017-4408-90ee-2571ccc06978'[39m,
      name: [32m'Pizzeria Monte Carlo'[39m,
      address: [32m'Ul. Stanis┼éawa Maczka 22'[39m,
      city: [32m'Piekary ┼Ül─ůskie'[39m,
      cuisine_type: [1mnull[22m,
      lat: [1mnull[22m,
      lng: [1mnull[22m
    }
  ],
  last_menu: [
    {
      id: [32m'a1a67286-2aaf-4cb7-ae05-50573652391c'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Double'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 400g, ser cheddar, sa┼éata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m46[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'009797c9-808b-4b8a-89b4-79d8d9ece27a'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Desperado Standard'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 200g, ser cheddar, sa┼éata, grillowana papryka, pikantna salsa, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m36[39m,
      spicy: [33mtrue[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'fecf6c54-17f4-4bb6-8a50-6a5944a11728'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'G┼éodzilla'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, 100% wo┼éowina 200g, grillowany boczek, ser camembert, nachos, papryka, sa┼éata rzymska, czerwona cebula, sos mango, czosnek'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m59[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'108af5f7-ea9e-46f2-8d06-d7837e181dce'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Grzybiarz z Piekaryhill'[39m,
      description: [32m'Bu┼éka, wo┼éowina, boczek, majonez, sa┼éata, marynowana cebula, ser cheddar, grzyby, sos BBQ'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [1mnull[22m,
      price_pln: [33m40[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'b5bde246-f3e9-4854-8bcf-c60787647ca0'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Double'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 400g, ser cheddar, grillowana dynia w pomara┼äczy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'double'[39m,
      price_pln: [33m49[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    },
    {
      id: [32m'c6b011fa-882d-4894-a84f-9a41acae5dbc'[39m,
      restaurant_id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Halloween Standard'[39m,
      description: [32m'Bu┼éka ma┼Ťlana, wo┼éowina 200g, ser cheddar, grillowana dynia w pomara┼äczy, pestki dyni, czerwona cebula, roszponka, chutney dyniowy, sos mango'[39m,
      category: [32m'Burger'[39m,
      base_type: [32m'burger'[39m,
      meat_type: [32m'mi─Ösne'[39m,
      size_or_variant: [32m'standard'[39m,
      price_pln: [33m39[39m,
      spicy: [33mfalse[39m,
      is_vege: [33mfalse[39m,
      image_url: [1mnull[22m,
      available: [33mtrue[39m,
      created_at: [32m'2025-10-29T21:29:06.527172+00:00'[39m
    }
  ],
  cart: { items: [ [36m[Object][39m ], total: [33m0[39m },
  lastOrder: {
    restaurant: {
      id: [32m'569a7d29-57be-4224-bdf3-09c483415cea'[39m,
      name: [32m'Klaps Burgers'[39m,
      city: [90mundefined[39m
    },
    items: [ [36m[Object][39m ],
    total: [33m0[39m
  }
}
­čöČ Starting Smart Intent Layer...
[intent-router] ­čÜÇ detectIntent called with: { text: [32m'Poprosz─Ö dwie pepsi'[39m, sessionId: [90mundefined[39m }
[intent-router] ­čöŹ Starting early dish detection for text: Poprosz─Ö dwie pepsi
[intent-router] ­čöŹ Normalized text: poprosz─Ö dwie pepsi
[intent-router] ­čöŹ Session restaurant: NONE
[intent-router] ­čöŹ Restaurant indicators in text: false
[intent-router] ­čöŹ Searching for restaurant in text (reason: no session restaurant)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 3 (nap├│j):
 powinien doda─ç nap├│j do z
am├│wienia (np. Pepsi)[22m
[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (nap├│j): powinien doda─ç nap├│j do zam├│wienia (np. Pepsi)[22m[39m
[intent-router] ­čöŹ Checking 9 restaurants for fuzzy match
[loadMenuCatalog] ­čöŹ Session: default
[loadMenuCatalog] ­čöŹ lastRestaurant: [90mundefined[39m
[loadMenuCatalog] ­čöŹ lastId: [90mundefined[39m
[loadMenuCatalog] ÔÜá´ŞĆ Loading all menu items (no restaurant in session)

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 3 (nap├│j):
 powinien doda─ç nap├│j do z
am├│wienia (np. Pepsi)[22m
[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (nap├│j): powinien doda─ç nap├│j do zam├│wienia (np. Pepsi)[22m[39m
[loadMenuCatalog] Ôťů Loaded 246 menu items from 9 restaurants
[loadMenuCatalog] Ôťů Sample items: Pizza ┼áunkov├í, Pizza Ekkluzivne, Pizza L├íska Nebesk├í
[intent-router] Catalog loaded: 246 items
[intent-router] ­čöŹ Calling parseOrderItems...
[intent-router] ­čöŹ Catalog items: Pizza ┼áunkov├í, Pizza Ekkluzivne, Pizza L├íska Nebesk├í, Rumcajsowy Burger, Golonka confit, Sa┼éatka z halloumi, Zupa pomidorowa, Kofola klasyczna, Hawajska, Coca-Cola, Coca-Cola Zero, Fanta Pomara┼äczowa, Sprite, Coca-Cola, Fanta, Piwo Tyskie, Pizza Margherita 33cm, Pizza Pepperoni 33cm, Pizza Hawajska 33cm, Pizza Capricciosa 33cm, Pizza Vege 33cm, Bacon Burger, Better Than Drwal - Wo┼éowina, Cheddar Burger, Vege Burger, Spicy Burger, Bowl Gyros-Halloumi, Bowl z Dyni─ů, Bowl Kurczak Zapiekany z Serem, Filet Grillowany, Pulled Pork Bowl Pikantny, Zapiekaniec, Cappy Jab┼éko, Krem z Cebuli i Czosnku, Sa┼éatka Cezar Callzone, Sa┼éatka Grillowany Kurczak, Sa┼éatka Halloumi, Sa┼éatka z Serem Camembert, Sa┼éatka z Serem Feta, Sa┼éatka z Dyni─ů, Szarlotka, Sernik z Musem Malinowym, Ciasto Marchewkowe, Pepsi 0.85L, Kawa Czarna, Kawa Bia┼éa, Flat White, Cappuccino, Latte, Sos Tzatziki, Sos Pikantny, Sos Jogurtowy, G─Ösie ┼╝o┼é─ůdki, Camembert z ┼╝urawin─ů, Deska zak─ůsek dla dwojga, Wodzionka, ┼╗ur ┼Ťl─ůski w chlebie, ┼╗ur ┼Ťl─ůski na talerzu, Krem borowikowy, Zupa pomidorowa, Barszcz z tortellini, Flaki z indyka, Burger wo┼éowy z frytkami i sur├│wk─ů, Burger wegetaria┼äski z Camembertem, frytkami oraz zestawem sur├│wek, Gyros z frytkami i tzatziki, ┼╗eberka wieprzowe z frytkami, Kotlety czopskie, Dzikie placki, W─ůtr├│bka drobiowa, Grillowany filet z kurczaka, Kurczak po parysku, ─ćwiartka kaczki, Rolada wieprzowa, Kotlet schabowy, Pol─Ödwica wieprzowa, Kotlet po szwajcarsku, Rolada wo┼éowa, Oz├│r wo┼éowy, Miruna w panierce, Zupa z kaczki, Zupa Won Ton, Tagliatelle ze szpinakiem, suszonymi pomidorami i p┼éatkami migda┼é├│w, Ros├│┼é z makaronem, Nale┼Ťniki z serem na s┼éodko z bit─ů ┼Ťmietan─ů, Carbonara a'la Hubertus, Filet z ┼éososia na szpinaku, Stek z halibuta sma┼╝ony na ma┼Ťle, Pstr─ůg na zio┼éowo, Pierogi z mi─Ösem, Pierogi ruskie, Kluski z sosem pieczeniowym, Sa┼éatka Hubertusa z pieczywem czosnkowym, Sa┼éatka grecka z pieczywem czosnkowym, Kluski ┼Ťl─ůskie, Ziemniaki z wody, Bratkartoffel, Kapusta modra, Kapusta zasma┼╝ana, Nuggetsy z frytkami oraz sur├│wk─ů z marchewki, Cappy Pomara┼äcza, Woda Mineralna, Tiramisu, Panna Cotta, Brownie, Lody waniliowe z sosem karmelowym, Kosmiczne Jaja Double, Wegetrix Double, ┼╗wirek i Muchomorek Standard, Zupa krabowa, Sajgonki 3 szt., Sajgonki z ry┼╝em, Sajgonki z sur├│wk─ů, Sajgonki z ry┼╝em i sur├│wk─ů, Pierogi Ho Cao z ry┼╝em i sur├│wk─ů, Grzybiarz z Piekaryhill, MrDrwal, Onionator, Hot-dog by KLAPS, Krem z dyni z bia┼é─ů czekolad─ů, Siekany tatar z pol─Ödwicy wo┼éowej, W─Ödzony pstr─ůg, Carpaccio z kaczki marynowanej w grza┼äcu, BUFFAL, Kartacze z dzikiem, Sa┼éatka z dyni─ů marynowan─ů w musztardzie, Grzanka z krupniokiem, Tagliatelle z krewetkami, Makaron ry┼╝owy z warzywami, Zupa dnia, Ros├│┼é z makaronem, Tradycyjny schabowy, Schab po beskidzku, Nale┼Ťnik z kurczakiem i warzywami, Nale┼Ťnik ze szpinakiem i serem feta, Lody z gor─ůcymi malinami i bit─ů ┼Ťmietan─ů, Fondant czekoladowy z lodami i bit─ů ┼Ťmietan─ů, Coca-Cola, Fanta, Sprite, Cappy (200 ml), Woda mineralna (330 ml), Filet z kurczaka tradycyjny (panierowany), Filet z kurczaka po hawajsku, Grillowany filet z kurczaka, Kroket (z kapust─ů i grzybami/b─ůd┼║ z mi─Ösem) 1 szt., Placki ziemniaczane 4 szt., Kluski ┼Ťl─ůskie 7 szt., Rolada wo┼éowa (na zam├│wienie), Piecze┼ä wieprzowa, W─ůtr├│bka drobiowa, Gulasz wieprzowy po w─Ögiersku, Pierogi (ruskie lub z mi─Ösem) 6 szt., Jajecznica z 2 szt. jaj, Placki po w─Ögiersku z gulaszem wieprzowym, Nale┼Ťnik z d┼╝emem truskawkowym lub wi┼Ťniowym, Nale┼Ťnik z nutell─ů, bananami, bit─ů ┼Ťmietan─ů, Margherita, Capricciosa, Diavola, Quattro Formaggi, Vegetariana, Prosciutto e Funghi, Salami, Pollo, Spinaci, Wegetrix Standard, Milczenie Wola Standard, Milczenie Wola Double, Halloween Standard, Halloween Double, Smak Vegas, Klaps Fiction Standard, Klaps Fiction Double, Desperado Standard, Desperado Double, Rodzina Serano Standard, Rodzina Serano Double, G┼éodzilla, Kosmiczne Jaja Standard, Zupa wietnamska, Zupa z kurczakiem, Zupa ┼éajska, Pierogi SiuMai z ry┼╝em i sur├│wk─ů, Kurczak z warzywami, Kurczak s┼éodko-kwa┼Ťny, Kurczak pikantny, Kurczak po chi┼äsku, Kurczak po tajsku, Kurczak na gor─ůcym p├│┼émisku, Kurczak w cie┼Ťcie s┼éodko-kwa┼Ťny, Kurczak w cie┼Ťcie pikantny, Kurczak w cie┼Ťcie curry, Kurczak w cie┼Ťcie pi─Öciu smak├│w, Wieprzowina z warzywami, Wieprzowina s┼éodko-kwa┼Ťna, Wieprzowina pikantna, Wieprzowina Curry, Wieprzowina pi─Öciu smak├│w, Wieprzowina po tajsku, Wo┼éowina z warzywami, Wo┼éowina pikantna, Wo┼éowina Curry, Wo┼éowina 5 smak├│w, Wo┼éowina po tajsku, Wo┼éowina na gor─ůcym p├│┼émisku, Kaczka z warzywami, Kaczka pikantna, Kaczka s┼éodko-kwa┼Ťna, Kaczka po chi┼äsku, Kaczka po tajsku, Kaczka na gor─ůcym p├│┼émisku, Krewetki z warzywami, Krewetki pikantne, Krewetki Curry, Krewetki po tajsku, Krewetki na gor─ůcym p├│┼émisku, Kalmary chrupi─ůce s┼éodko-kwa┼Ťne, Kalmary chrupi─ůce pikantne, Kalmary chrupi─ůce Curry, Kalmary chrupi─ůce w pi─Öciu smakach, Kalmary po tajsku, Kalmary na gor─ůcym p├│┼émisku, Pita Rollo, Pita Rollo z serem, Pita Rollo same mi─Öso, Tortilla kebab, Tortilla kebab z serem, Kebab ameryka┼äski, Kebab box, Kebab box z serem, Nuggets box, Kebab talerz, Kebab w bu┼éce, Falafel, Frytki z serem, Frytki z Indii masala, Sa┼éatka grecka, Sos, Baklava, Sok Cappy, Coca-Cola 0,85l, Coca-Cola 0,5l, Coca-Cola 0,3l, Pepsi / Mirinda / 7up, Monster Energy Drink, Ayran Turecki, Mango Sok, Oshee, Burn
[parseOrderItems] ­čôŐ Summary:
  - requestedNames: []
  - availableNames: []
  - unavailableNames: []
  - matched.length: 0
  - clarifications.length: 0
[intent-router] Ôťů Parsed result: {
  "any": false,
  "groups": [],
  "clarify": [],
  "available": [],
  "unavailable": [],
  "needsClarification": false,
  "unknownItems": []
}
[intent-router] ­čöŹ parsed.any = false
[intent-router] ­čöŹ parsed.groups.length = 0
[intent-router] ÔŁî No dishes matched in catalog (parsed.any = false)
[intent-router] ÔŁî Continuing to KROK 4 (targetRestaurant check)...

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 3 (nap├│j):
 powinien doda─ç nap├│j do z
am├│wienia (np. Pepsi)[22m
[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (nap├│j): powinien doda─ç nap├│j do zam├│wienia (np. Pepsi)[22m[39m
[intent-router] ­čöŹ KROK 4: Checking targetRestaurant: [1mnull[22m
[intent-router] ÔŁî No targetRestaurant found, continuing to keyword detection
­čöŹ PRIORYTET 1: Sprawdzam restauracje w tek┼Ťcie: Poprosz─Ö dwie pepsi
­čöŹ Znaleziono restauracji: [33m9[39m

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 3 (nap├│j):
 powinien doda─ç nap├│j do z
am├│wienia (np. Pepsi)[22m
[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (nap├│j): powinien doda─ç nap├│j do zam├│wienia (np. Pepsi)[22m[39m
­čöŹ Normalizowany tekst: poprosze dwie pepsi
­čöŹ Sprawdzam restauracj─Ö: Restauracja Stara Kamienica -> restauracja stara kamienica
­čöŹ Fuzzy match - name words: [ [32m'restauracja'[39m, [32m'stara'[39m, [32m'kamienica'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
­čöŹ Comparing: poprosze vs restauracja distance: [33m10[39m
­čöŹ Comparing: dwie vs restauracja distance: [33m11[39m
­čöŹ Comparing: pepsi vs restauracja distance: [33m10[39m
­čöŹ Comparing: poprosze vs stara distance: [33m7[39m
­čöŹ Comparing: dwie vs stara distance: [33m5[39m
­čöŹ Comparing: pepsi vs stara distance: [33m5[39m
­čöŹ Comparing: poprosze vs kamienica distance: [33m9[39m
­čöŹ Comparing: dwie vs kamienica distance: [33m7[39m
­čöŹ Comparing: pepsi vs kamienica distance: [33m8[39m
­čöŹ Matched words: [33m0[39m out of [33m3[39m threshold: [33m2[39m
­čöŹ Sprawdzam restauracj─Ö: Rezydencja Luxury Hotel -> rezydencja luxury hotel
­čöŹ Fuzzy match - name words: [ [32m'rezydencja'[39m, [32m'luxury'[39m, [32m'hotel'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
­čöŹ Comparing: poprosze vs rezydencja distance: [33m10[39m
­čöŹ Comparing: dwie vs rezydencja distance: [33m9[39m
­čöŹ Comparing: pepsi vs rezydencja distance: [33m9[39m
­čöŹ Comparing: poprosze vs luxury distance: [33m8[39m
­čöŹ Comparing: dwie vs luxury distance: [33m6[39m
­čöŹ Comparing: pepsi vs luxury distance: [33m6[39m
­čöŹ Comparing: poprosze vs hotel distance: [33m7[39m
­čöŹ Comparing: dwie vs hotel distance: [33m4[39m
­čöŹ Comparing: pepsi vs hotel distance: [33m5[39m
­čöŹ Matched words: [33m0[39m out of [33m3[39m threshold: [33m2[39m
­čöŹ Sprawdzam restauracj─Ö: Klaps Burgers -> klaps burgers
­čöŹ Fuzzy match - name words: [ [32m'klaps'[39m, [32m'burgers'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
­čöŹ Comparing: poprosze vs klaps distance: [33m7[39m
­čöŹ Comparing: dwie vs klaps distance: [33m5[39m
­čöŹ Comparing: pepsi vs klaps distance: [33m4[39m
­čöŹ Comparing: poprosze vs burgers distance: [33m7[39m
­čöŹ Comparing: dwie vs burgers distance: [33m6[39m
­čöŹ Comparing: pepsi vs burgers distance: [33m6[39m
­čöŹ Matched words: [33m0[39m out of [33m2[39m threshold: [33m1[39m
­čöŹ Sprawdzam restauracj─Ö: Vien-Thien -> vien thien
­čöŹ Fuzzy match - name words: [ [32m'vien'[39m, [32m'thien'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
­čöŹ Comparing: poprosze vs vien distance: [33m8[39m
­čöŹ Comparing: dwie vs vien distance: [33m3[39m
­čöŹ Comparing: pepsi vs vien distance: [33m5[39m
­čöŹ Comparing: poprosze vs thien distance: [33m8[39m
­čöŹ Comparing: dwie vs thien distance: [33m3[39m
­čöŹ Comparing: pepsi vs thien distance: [33m5[39m
­čöŹ Matched words: [33m0[39m out of [33m2[39m threshold: [33m1[39m
­čöŹ Sprawdzam restauracj─Ö: Bar Praha -> bar praha
­čöŹ Fuzzy match - name words: [ [32m'bar'[39m, [32m'praha'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
­čöŹ Comparing: poprosze vs bar distance: [33m7[39m
­čöŹ Comparing: dwie vs bar distance: [33m4[39m
­čöŹ Comparing: pepsi vs bar distance: [33m5[39m
­čöŹ Comparing: poprosze vs praha distance: [33m6[39m
­čöŹ Comparing: dwie vs praha distance: [33m5[39m
­čöŹ Comparing: pepsi vs praha distance: [33m4[39m
­čöŹ Matched words: [33m0[39m out of [33m2[39m threshold: [33m1[39m
­čöŹ Sprawdzam restauracj─Ö: Callzone -> callzone
­čöŹ Fuzzy match - name words: [ [32m'callzone'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
­čöŹ Comparing: poprosze vs callzone distance: [33m7[39m
­čöŹ Comparing: dwie vs callzone distance: [33m7[39m
­čöŹ Comparing: pepsi vs callzone distance: [33m8[39m
­čöŹ Matched words: [33m0[39m out of [33m1[39m threshold: [33m1[39m
­čöŹ Sprawdzam restauracj─Ö: Dw├│r Hubertus -> dwor hubertus
­čöŹ Fuzzy match - name words: [ [32m'dwor'[39m, [32m'hubertus'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
­čöŹ Comparing: poprosze vs dwor distance: [33m7[39m
­čöŹ Comparing: dwie vs dwor distance: [33m2[39m
­čöŹ Comparing: pepsi vs dwor distance: [33m5[39m
­čöŹ Comparing: poprosze vs hubertus distance: [33m8[39m
­čöŹ Comparing: dwie vs hubertus distance: [33m7[39m
­čöŹ Comparing: pepsi vs hubertus distance: [33m7[39m
­čöŹ Matched words: [33m0[39m out of [33m2[39m threshold: [33m1[39m
­čöŹ Sprawdzam restauracj─Ö: Tasty King Kebab -> tasty king kebab
­čöŹ Fuzzy match - name words: [ [32m'tasty'[39m, [32m'king'[39m, [32m'kebab'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
­čöŹ Comparing: poprosze vs tasty distance: [33m7[39m
­čöŹ Comparing: dwie vs tasty distance: [33m5[39m
­čöŹ Comparing: pepsi vs tasty distance: [33m5[39m
­čöŹ Comparing: poprosze vs king distance: [33m8[39m
­čöŹ Comparing: dwie vs king distance: [33m4[39m
­čöŹ Comparing: pepsi vs king distance: [33m5[39m
­čöŹ Comparing: poprosze vs kebab distance: [33m8[39m
­čöŹ Comparing: dwie vs kebab distance: [33m5[39m
­čöŹ Comparing: pepsi vs kebab distance: [33m4[39m
­čöŹ Matched words: [33m0[39m out of [33m3[39m threshold: [33m2[39m
­čöŹ Sprawdzam restauracj─Ö: Pizzeria Monte Carlo -> pizzeria monte carlo
­čöŹ Fuzzy match - name words: [ [32m'pizzeria'[39m, [32m'monte'[39m, [32m'carlo'[39m ] text words: [ [32m'poprosze'[39m, [32m'dwie'[39m, [32m'pepsi'[39m ]
­čöŹ Comparing: poprosze vs pizzeria distance: [33m7[39m
­čöŹ Comparing: dwie vs pizzeria distance: [33m7[39m
­čöŹ Comparing: pepsi vs pizzeria distance: [33m6[39m
­čöŹ Comparing: poprosze vs monte distance: [33m6[39m
­čöŹ Comparing: dwie vs monte distance: [33m4[39m
­čöŹ Comparing: pepsi vs monte distance: [33m5[39m
­čöŹ Comparing: poprosze vs carlo distance: [33m7[39m
­čöŹ Comparing: dwie vs carlo distance: [33m5[39m
­čöŹ Comparing: pepsi vs carlo distance: [33m5[39m
­čöŹ Matched words: [33m0[39m out of [33m3[39m threshold: [33m2[39m
­čöŹ Debug session updated: {
  intent: [32m'create_order'[39m,
  restaurant: [1mnull[22m,
  sessionId: [1mnull[22m,
  confidence: [33m0.8[39m
}

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 3 (nap├│j):
 powinien doda─ç nap├│j do z
am├│wienia (np. Pepsi)[22m
[39m
<empty line>
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (nap├│j): powinien doda─ç nap├│j do zam├│wienia (np. Pepsi)[22m[39m
Ôťů SmartIntent Resolved: create_order (0.95) via llm
­čžá [DEBUG] Hybrid intent detection complete: {
  ruleIntent: [32m'create_order'[39m,
  ruleConfidence: [33m0.95[39m,
  llmIntent: [32m'create_order'[39m,
  llmConfidence: [33m0.95[39m,
  finalIntent: [32m'create_order'[39m,
  finalConfidence: [33m0.95[39m,
  source: [32m'llm'[39m,
  hasRestaurant: [33mfalse[39m,
  restaurantName: [90mundefined[39m,
  hasParsedOrder: [33mfalse[39m,
  parsedOrderDetails: [1mnull[22m
}
­čžá [DEBUG] Calling boostIntent with: {
  text: [32m'Poprosz─Ö dwie pepsi'[39m,
  hybridIntent: [32m'create_order'[39m,
  confidence: [33m0.95[39m,
  session: {
    expectedContext: [90mundefined[39m,
    lastRestaurant: [32m'Klaps Burgers'[39m,
    lastIntent: [32m'create_order'[39m
  }
}
­čžá [DEBUG] boostIntent result: {
  originalIntent: [32m'create_order'[39m,
  boostedIntent: [32m'create_order'[39m,
  isContextLocked: [33mfalse[39m
}
­čôő Parsed: { dish: [32m'pepsi'[39m, restaurant: [1mnull[22m }
­čžá create_order intent detected
­čŤĺ Parsing order items from: "Poprosz─Ö dwie pepsi" with 2-Phase Parsing

POST /api/brain 200 14265 - 3442.468 ms
[90mstdout[2m | api/brain/tests/brainRouter.e2e.test.js[2m > [22m[2m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22m[2mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22m[2mTest 3 (nap├│j): powinien doda─ç nap├│j do zam├│wienia (np. Pepsi)[22m[39m
ÔÜá´ŞĆ Parsed dish "pepsi" but not found in menu. Returning unknown_item.
Ôťů Parsed order: [
  {
    id: [32m'unknown_item'[39m,
    name: [32m'pepsi'[39m,
    price: [33m0[39m,
    quantity: [33m2[39m,
    isUnknown: [33mtrue[39m
  }
]
Ôťů Pending order saved to session (fallback path):
   - expectedContext: confirm_order
   - pendingOrder items count: [33m1[39m
   - pendingOrder items: 2x pepsi
   - total: 0.00 z┼é
   - items details: [
  {
    "id": "unknown_item",
    "name": "pepsi",
    "price": 0,
    "quantity": 2,
    "isUnknown": true
  }
]
ÔĆ│ Waiting for user confirmation (expecting "tak", "dodaj", etc.)
ÔÜá´ŞĆ Skipping LLM reply generation (test mode or no key), using replyCore
Ôťů Final response: intent=create_order, confidence=0.9, fallback=false
­čôŽ Final Response Preparation: MenuItems count = 6

[90mstderr[2m | api/brain/
tests/brainRouter.e2e.test.j
s[2m > [22m[2m­čžá BrainR
outer E2E - Restaurant & Men
u Flow[2m > [22m[2mD. Now
e testy kaskadowe w Klaps Bu
rgers (Dane produkcyjne)[2m
 > [22m[2mTest 3 (nap├│j):
 powinien doda─ç nap├│j do z
am├│wienia (np. Pepsi)[22m
[39m
ÔÜá´ŞĆ No match for dish: "p
epsi"

 [32mÔťô[39m api/brain/tests/brainRouter.e2e.test.js[2m > [22m­čžá BrainRouter E2E - Restaurant & Menu Flow[2m > [22mD. Nowe testy kaskadowe w Klaps Burgers (Dane produkcyjne)[2m > [22mTest 3 (nap├│j): powinien doda─ç nap├│j do zam├│wienia (np. Pepsi)[33m 3448[2mms[22m[39m

[31mÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»[
1m[7m Failed Tests 5 [27m
[22mÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»[3
9m

[31m[1m[7m FAIL [27m[22
m[39m api/brain/tests/brain
Router.e2e.test.js[2m > [2
2m­čžá BrainRouter E2E - Res
taurant & Menu Flow[2m > [
22mB. Intent menu_request (M
enu konkretnej restauracji)
[2m > [22mpowinien pokaza─ç
 menu dla Restauracja Stara 
Kamienica
[31m[1mAssertionError[22m
: expected 'w restauracja st
ara kamienica dost─ÖpnÔÇŽ' t
o match /menu|karta|polecam|
proponuj─Ö/i[39m

[32m- Expected:[39m 
/menu|karta|polecam|proponuj
─Ö/i

[31m+ Received:[39m 
"w restauracja stara kamieni
ca dost─Öpne m.in.: filet z 
kurczaka po hawajsku (19.00 
z┼é), filet z kurczaka trady
cyjny (panierowany) (15.00 z
┼é), fondant czekoladowy z l
odami i bit─ů ┼Ťmietan─ů (22
.00 z┼é), grillowany filet z
 kurczaka (15.00 z┼é), gulas
z wieprzowy po w─Ögiersku (2
3.00 z┼é), jajecznica z 2 sz
t. jaj (11.00 z┼é). co chcia
┼éby┼Ť zam├│wi─ç?"

[36m [2mÔŁ»[22m api/brain
/tests/brainRouter.e2e.test.
js:[2m80:50[22m[39m
    [90m 78| [39m         
   [90m// Sprawdzamy czy lo
gika nie utkn─Ö┼éa na wybier
aniu restaur[39mÔÇŽ
    [90m 79| [39m         
   [34mexpect[39m(res[33m
.[39mbody[33m.[39mreply)
[33m.[39mnot[33m.[39m[34
mtoMatch[39m([36m/kt├│r─ů 
wybierasz/i[39m)[33m;[39m
    [90m 80| [39m         
   [34mexpect[39m(res[33m
.[39mbody[33m.[39mreply[
33m.[39m[34mtoLowerCase[3
9m())[33m.[39m[34mtoMatch
[39m([36m/menu|karta|p[39
mÔÇŽ
    [90m   | [39m         
                            
            [31m^[39m
    [90m 81| [39m        }
)[33m;[39m
    [90m 82| [39m

[31m[2mÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»Ô
Ä»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ
»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»[1/
5]ÔÄ»[22m[39m

[31m[1m[7m FAIL [27m[22
m[39m api/brain/tests/brain
Router.e2e.test.js[2m > [2
2m­čžá BrainRouter E2E - Res
taurant & Menu Flow[2m > [
22mB. Intent menu_request (M
enu konkretnej restauracji)
[2m > [22mpowinien pokaza─ç
 menu dla Klaps Burgers
[31m[1mAssertionError[22m
: expected 'show_menu' to be
 'menu_request' // Object.is
 equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- menu_request[39m
[31m+ show_menu[39m

[36m [2mÔŁ»[22m api/brain
/tests/brainRouter.e2e.test.
js:[2m93:37[22m[39m
    [90m 91| [39m         
   [34mexpect[39m(res[33m
.[39mstatus)[33m.[39m[34
mtoBe[39m([34m200[39m)[3
3m;[39m
    [90m 92| [39m         
   [34mexpect[39m(res[33m
.[39mbody[33m.[39mok)[33
m.[39m[34mtoBe[39m([35mt
rue[39m)[33m;[39m
    [90m 93| [39m         
   [34mexpect[39m(res[33m
.[39mbody[33m.[39mintent)
[33m.[39m[34mtoBe[39m([
32m'menu_request'[39m)[33m
;[39m
    [90m   | [39m         
                           
[31m^[39m
    [90m 94| [39m        }
)[33m;[39m
    [90m 95| [39m

[31m[2mÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»Ô
Ä»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ
»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»[2/
5]ÔÄ»[22m[39m

[31m[1m[7m FAIL [27m[22
m[39m api/brain/tests/brain
Router.e2e.test.js[2m > [2
2m­čžá BrainRouter E2E - Res
taurant & Menu Flow[2m > [
22mB. Intent menu_request (M
enu konkretnej restauracji)
[2m > [22mpowinien pokaza─ç
 menu dla Pizzeria Monte Car
lo
[31m[1mAssertionError[22m
: expected 'show_menu' to be
 'menu_request' // Object.is
 equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- menu_request[39m
[31m+ show_menu[39m

[36m [2mÔŁ»[22m api/brain
/tests/brainRouter.e2e.test.
js:[2m106:37[22m[39m
    [90m104| [39m         
   [34mexpect[39m(res[33m
.[39mstatus)[33m.[39m[34
mtoBe[39m([34m200[39m)[3
3m;[39m
    [90m105| [39m         
   [34mexpect[39m(res[33m
.[39mbody[33m.[39mok)[33
m.[39m[34mtoBe[39m([35mt
rue[39m)[33m;[39m
    [90m106| [39m         
   [34mexpect[39m(res[33m
.[39mbody[33m.[39mintent)
[33m.[39m[34mtoBe[39m([
32m'menu_request'[39m)[33m
;[39m
    [90m   | [39m         
                           
[31m^[39m
    [90m107| [39m        }
)[33m;[39m
    [90m108| [39m    })[3
3m;[39m

[31m[2mÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»Ô
Ä»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ
»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»[3/
5]ÔÄ»[22m[39m

[31m[1m[7m FAIL [27m[22
m[39m api/brain/tests/brain
Router.e2e.test.js[2m > [2
2m­čžá BrainRouter E2E - Res
taurant & Menu Flow[2m > [
22mD. Nowe testy kaskadowe w
 Klaps Burgers (Dane produkc
yjne)[2m > [22mTest 1 (bur
ger og├│lny): powinien obs┼é
u┼╝y─ç "Chc─Ö burgery" po wy
borze Klaps Burgers
[31m[1mAssertionError[22m
: expected 'rozumiem: 1x bur
gery (0.00 z┼é). razemÔÇŽ' t
o match /desperado|fiction|s
erano|halloween|g┼éÔÇŽ/[39m

[32m- Expected:[39m 
/desperado|fiction|serano|ha
lloween|g┼éodzilla|smak vega
s|mrdrwal|onionator/

[31m+ Received:[39m 
"rozumiem: 1x burgery (0.00 
z┼é). razem 0.00 z┼é. doda─ç
 do koszyka?"

[36m [2mÔŁ»[22m api/brain
/tests/brainRouter.e2e.test.
js:[2m179:50[22m[39m
    [90m177| [39m         
   [90m// (Je┼Ťli parser ni
e znajdzie konkretnego, powi
nien przyna[39mÔÇŽ
    [90m178| [39m         
   [90m// ale user oczekuje
 nazwy pozycji z menu w odpo
wiedzi)[39m
    [90m179| [39m         
   [34mexpect[39m(res[33m
.[39mbody[33m.[39mreply[
33m.[39m[34mtoLowerCase[3
9m())[33m.[39m[34mtoMatch
[39m([36m/desperado|fi[39
mÔÇŽ
    [90m   | [39m         
                            
            [31m^[39m
    [90m180| [39m        }
)[33m;[39m
    [90m181| [39m

[31m[2mÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»Ô
Ä»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ
»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»[4/
5]ÔÄ»[22m[39m

[31m[1m[7m FAIL [27m[22
m[39m api/brain/tests/brain
Router.e2e.test.js[2m > [2
2m­čžá BrainRouter E2E - Res
taurant & Menu Flow[2m > [
22mD. Nowe testy kaskadowe w
 Klaps Burgers (Dane produkc
yjne)[2m > [22mTest 2 (kon
kretny burger z aliasem): po
winien dopasowa─ç "burgera V
egas" do "Smak Vegas"
[31m[1mAssertionError[22m
: expected 'confirm_order' t
o be 'create_order' // Objec
t.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- create_order[39m
[31m+ confirm_order[39m

[36m [2mÔŁ»[22m api/brain
/tests/brainRouter.e2e.test.
js:[2m189:37[22m[39m
    [90m187| [39m         
   [34mexpect[39m(res[33m
.[39mstatus)[33m.[39m[34
mtoBe[39m([34m200[39m)[3
3m;[39m
    [90m188| [39m         
   [34mexpect[39m(res[33m
.[39mbody[33m.[39mok)[33
m.[39m[34mtoBe[39m([35mt
rue[39m)[33m;[39m
    [90m189| [39m         
   [34mexpect[39m(res[33m
.[39mbody[33m.[39mintent)
[33m.[39m[34mtoBe[39m([
32m'create_order'[39m)[33m
;[39m
    [90m   | [39m         
                           
[31m^[39m
    [90m190| [39m         
   [34mexpect[39m(res[33m
.[39mbody[33m.[39mreply)
[33m.[39m[34mtoMatch[39m(
[36m/Smak Vegas/i[39m)[33
m;[39m
    [90m191| [39m        }
)[33m;[39m

[31m[2mÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»Ô
Ä»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ
»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»ÔÄ»[5/
5]ÔÄ»[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m5 failed[39m[22m[2m | [22m[1m[32m5 passed[39m[22m[90m (10)[39m
[2m   Start at [22m 08:32:14
[2m   Duration [22m 26.36s[2m (transform 284ms, setup 1ms, collect 535ms, tests 25.22s, environment 0ms, prepare 220ms)[22m

